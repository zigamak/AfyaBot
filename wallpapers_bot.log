2025-09-04 13:42:12,967 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 13:42:15,838 - __main__ - ERROR - Import error: No module named 'message_processor'
2025-09-04 13:42:55,583 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 13:42:57,068 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 13:42:59,940 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 13:43:00,173 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 13:43:02,215 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 13:43:02,539 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 13:43:02,540 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 13:43:03,014 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 13:43:03,015 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 13:43:03,353 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 13:43:03,354 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 13:43:03,354 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 13:43:03,354 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 13:43:03,355 - app - ERROR - Error initializing WebhookHandler: WebhookHandler.__init__() takes 2 positional arguments but 3 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\Wallpaper.ng\app.py", line 63, in <module>
    webhook_handler = WebhookHandler(config, message_processor)
TypeError: WebhookHandler.__init__() takes 2 positional arguments but 3 were given
2025-09-04 14:16:37,653 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 14:16:39,574 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:16:42,327 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:16:42,650 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:16:44,633 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:16:44,851 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:16:44,852 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:16:44,853 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 14:16:45,307 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:16:45,307 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:16:45,308 - app - ERROR - Error initializing handlers: MessageProcessor.__init__() takes 5 positional arguments but 7 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\Wallpaper.ng\app.py", line 57, in <module>
    message_processor = MessageProcessor(
        config,
    ...<4 lines>...
        location_service
    )
TypeError: MessageProcessor.__init__() takes 5 positional arguments but 7 were given
2025-09-04 14:17:51,362 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 14:17:52,685 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:17:54,490 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:17:54,747 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:17:56,856 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:17:57,097 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:17:57,098 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:17:57,098 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 14:17:57,480 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:17:57,480 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:17:57,816 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:17:57,816 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:17:57,816 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 14:17:57,817 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 14:17:57,817 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:17:59,822 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:18:00,077 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:18:02,276 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:18:02,498 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:18:02,498 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:18:02,499 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 14:18:02,499 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 14:18:02,500 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 14:18:02,500 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 14:18:02,536 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 14:18:02,537 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 14:18:25,591 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-04 14:18:25,591 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 14:18:25,592 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-04 14:18:25,592 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 14:18:25,592 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 14:18:26,193 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 14:18:26,206 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:18:26,658 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 14:18:26,670 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:18:26] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:19:48,631 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 14:19:49,910 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:19:56,217 - utils.data_manager - ERROR - Database error while ensuring columns in whatsapp_orders: connection to server at "ep-autumn-flower-a8gfew31-pooler.eastus2.azure.neon.tech" (52.167.188.143), port 5432 failed: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
SSL SYSCALL error: Connection reset by peer (0x00002746/10054)
connection to server at "ep-autumn-flower-a8gfew31-pooler.eastus2.azure.neon.tech" (52.167.188.143), port 5432 failed: ERROR:  connection is insecure (try using `sslmode=require`)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\Wallpaper.ng\utils\data_manager.py", line 80, in _ensure_database_columns
    with psycopg2.connect(**self.db_params) as conn:
         ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "ep-autumn-flower-a8gfew31-pooler.eastus2.azure.neon.tech" (52.167.188.143), port 5432 failed: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
SSL SYSCALL error: Connection reset by peer (0x00002746/10054)
connection to server at "ep-autumn-flower-a8gfew31-pooler.eastus2.azure.neon.tech" (52.167.188.143), port 5432 failed: ERROR:  connection is insecure (try using `sslmode=require`)

2025-09-04 14:19:58,132 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:19:58,352 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:19:58,353 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:19:58,353 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 14:19:58,740 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:19:58,740 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:19:59,115 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:19:59,115 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:19:59,115 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 14:19:59,116 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 14:19:59,116 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:20:00,908 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:20:01,162 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:20:03,912 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:20:04,138 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:20:04,139 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:20:04,139 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 14:20:04,140 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 14:20:04,140 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 14:20:04,141 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 14:20:04,156 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 14:20:04,156 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 14:20:05,934 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'share_current_location'}
2025-09-04 14:20:05,935 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 14:20:05,935 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 14:20:05,936 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 14:20:05,936 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 14:20:07,925 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjJERTM3RDVCRTZFRDMxOUU5MgA="}]}
2025-09-04 14:20:07,926 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:20:09,114 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVCN0U1OTQ1ODJCN0VCOTNFOQA="}]}
2025-09-04 14:20:09,115 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVCN0U1OTQ1ODJCN0VCOTNFOQA='}]}
2025-09-04 14:20:09,116 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:20:09] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:20:10,454 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:20:10] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:20:10,898 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:20:10] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:20:11,249 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:20:11] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:20:11,383 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:20:11] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:20:38,246 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "I want to know about the wallpapers you have and what's your delivery time"}
2025-09-04 14:20:38,246 - handlers.base_handler - INFO - AIHandler: Handling message 'i want to know about the wallpapers you have and what's your delivery time' in AI chat state for session 2348055614455. Original: 'I want to know about the wallpapers you have and what's your delivery time'
2025-09-04 14:20:41,646 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:20:41,655 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:20:42,971 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEMzk0MEQzNjA4RDIyMEYzMQA="}]}
2025-09-04 14:20:42,972 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjVEMzk0MEQzNjA4RDIyMEYzMQA='}]}
2025-09-04 14:20:42,972 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:20:42] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:18,897 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "I want to know about the wallpapers you have and what's your delivery time"}
2025-09-04 14:21:18,898 - handlers.base_handler - INFO - AIHandler: Handling message 'i want to know about the wallpapers you have and what's your delivery time' in AI chat state for session 2348055614455. Original: 'I want to know about the wallpapers you have and what's your delivery time'
2025-09-04 14:21:21,735 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:21:21,736 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:21:22,416 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:22] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:22,972 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI2MDJFRDUyQUZCMzQ5QTg4MgA="}]}
2025-09-04 14:21:22,972 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI2MDJFRDUyQUZCMzQ5QTg4MgA='}]}
2025-09-04 14:21:22,973 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:22] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:23,635 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:23] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:24,300 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:24] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:24,616 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:24] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:24,957 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:24] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:28,230 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:28] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:47,399 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Alright when do you take orders and when do you close'}
2025-09-04 14:21:47,400 - handlers.base_handler - INFO - AIHandler: Handling message 'alright when do you take orders and when do you close' in AI chat state for session 2348055614455. Original: 'Alright when do you take orders and when do you close'
2025-09-04 14:21:49,842 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:21:49,843 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:21:50,992 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI4MEQ4OTM1RTU3QkQ5MDBGOAA="}]}
2025-09-04 14:21:50,993 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI4MEQ4OTM1RTU3QkQ5MDBGOAA='}]}
2025-09-04 14:21:50,994 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:50] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:52,171 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:52] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:52,560 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:52] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:21:52,684 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:21:52] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:23:09,339 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you offer refunds or returns ?'}
2025-09-04 14:23:09,339 - handlers.base_handler - INFO - AIHandler: Handling message 'do you offer refunds or returns ?' in AI chat state for session 2348055614455. Original: 'Do you offer refunds or returns ?'
2025-09-04 14:23:12,473 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:23:12,474 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:23:13,685 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZFQURDQUI5M0Y4NTM2N0JFNAA="}]}
2025-09-04 14:23:13,685 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZFQURDQUI5M0Y4NTM2N0JFNAA='}]}
2025-09-04 14:23:13,686 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:23:13] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:23:15,224 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:23:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:23:15,242 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:23:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:23:15,464 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:23:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:07,776 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 14:26:09,569 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:26:12,002 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:26:12,288 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:26:14,403 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:26:14,623 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:26:14,624 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:26:14,624 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 14:26:15,094 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:26:15,095 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:26:15,546 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:26:15,546 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:26:15,546 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 14:26:15,546 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 14:26:15,547 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:26:17,343 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:26:17,550 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:26:19,311 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:26:19,515 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:26:19,515 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:26:19,516 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 14:26:19,516 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 14:26:19,517 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 14:26:19,517 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 14:26:19,553 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 14:26:19,553 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 14:26:19,813 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-04 14:26:19,814 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 14:26:19,814 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-04 14:26:19,815 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 14:26:19,815 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 14:26:21,064 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYzNkIwQUI0NTAxRjc0RTBCMAA="}]}
2025-09-04 14:26:21,065 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:26:21,582 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:21] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:22,566 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ3Qjc2NUE0MTk1QjA3RTVERAA="}]}
2025-09-04 14:26:22,567 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ3Qjc2NUE0MTk1QjA3RTVERAA='}]}
2025-09-04 14:26:22,568 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:22] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:23,863 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:23] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:24,213 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:24] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:24,616 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:24] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:52,502 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What do you know if nigeuran president'}
2025-09-04 14:26:52,503 - handlers.base_handler - INFO - AIHandler: Handling message 'what do you know if nigeuran president' in AI chat state for session 2348055614455. Original: 'What do you know if nigeuran president'
2025-09-04 14:26:54,787 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 400 model_error"
2025-09-04 14:26:54,791 - services.ai_service - ERROR - Azure OpenAI API error in Wallpaper.ng response generation: Error code: 400 - {'error': {'message': "The response was filtered due to the prompt triggering Azure OpenAI's content management policy. Please modify your prompt and retry. To learn more about our content filtering policies please read our documentation: https://go.microsoft.com/fwlink/?linkid=2198766", 'type': None, 'param': 'prompt', 'code': 'content_filter', 'status': 400, 'innererror': {'code': 'ResponsibleAIPolicyViolation', 'content_filter_result': {'hate': {'filtered': True, 'severity': 'high'}, 'jailbreak': {'filtered': False, 'detected': False}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}}}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\Wallpaper.ng\services\ai_service.py", line 145, in generate_wallpapers_response
    response = self.azure_client.chat.completions.create(
        model=self.deployment_name,
    ...<2 lines>...
        temperature=0.7
    )
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_utils\_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\resources\chat\completions\completions.py", line 925, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1239, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\openai\_base_client.py", line 1034, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "The response was filtered due to the prompt triggering Azure OpenAI's content management policy. Please modify your prompt and retry. To learn more about our content filtering policies please read our documentation: https://go.microsoft.com/fwlink/?linkid=2198766", 'type': None, 'param': 'prompt', 'code': 'content_filter', 'status': 400, 'innererror': {'code': 'ResponsibleAIPolicyViolation', 'content_filter_result': {'hate': {'filtered': True, 'severity': 'high'}, 'jailbreak': {'filtered': False, 'detected': False}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}}}
2025-09-04 14:26:54,800 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:26:56,424 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGNTg0MTg2MjFBQzUxN0YxNAA="}]}
2025-09-04 14:26:56,425 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRGNTg0MTg2MjFBQzUxN0YxNAA='}]}
2025-09-04 14:26:56,425 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:56] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:57,336 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:57,951 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:26:58,307 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:26:58] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:27:13,059 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "What's your delivery date"}
2025-09-04 14:27:13,060 - handlers.base_handler - INFO - AIHandler: Handling message 'what's your delivery date' in AI chat state for session 2348055614455. Original: 'What's your delivery date'
2025-09-04 14:27:15,127 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:27:15,131 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:27:16,422 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk1MkRCQjQyMjc0QTQ4QTk2QwA="}]}
2025-09-04 14:27:16,423 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk1MkRCQjQyMjc0QTQ4QTk2QwA='}]}
2025-09-04 14:27:16,423 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:27:16] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:27:17,740 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:27:17] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:27:18,087 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:27:18] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:27:18,216 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:27:18] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:28:11,610 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What do you know of Nigeura president'}
2025-09-04 14:28:11,610 - handlers.base_handler - INFO - AIHandler: Handling message 'what do you know of nigeura president' in AI chat state for session 2348055614455. Original: 'What do you know of Nigeura president'
2025-09-04 14:28:13,118 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:28:13,119 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:28:14,373 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZDNDU0NzVCMzZGNTFBODQzNAA="}]}
2025-09-04 14:28:14,374 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZDNDU0NzVCMzZGNTFBODQzNAA='}]}
2025-09-04 14:28:14,375 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:28:14] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:28:15,463 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:28:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:28:15,865 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:28:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:28:16,136 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:28:16] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:28:42,918 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 14:28:44,257 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:28:45,921 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:28:46,124 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:28:48,004 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:28:48,202 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:28:48,203 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:28:48,203 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 14:28:48,618 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:28:48,619 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:28:48,950 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 14:28:48,950 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 14:28:48,951 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 14:28:48,951 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 14:28:48,951 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 14:28:50,644 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 14:28:50,883 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 14:28:52,741 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 14:28:52,952 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 14:28:52,953 - services.payment_service - INFO - PaymentService initialized
2025-09-04 14:28:52,953 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 14:28:52,954 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 14:28:52,954 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 14:28:52,954 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 14:28:52,966 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 14:28:52,966 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 14:31:16,474 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hi'}
2025-09-04 14:31:16,474 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-09-04 14:31:16,474 - message_processor - INFO - Session 2347082345056: Global command 'hi' detected. Going to AI chat.
2025-09-04 14:31:16,475 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke'.
2025-09-04 14:31:16,475 - services.whatsapp_service - DEBUG - Created image message payload for 2347082345056
2025-09-04 14:31:18,163 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjc4MkYyQjVEMjBDNTBDMTcxRAA="}]}
2025-09-04 14:31:18,165 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-04 14:31:19,412 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZBQjc0OUJEODZBOEEzQUFDQQA="}]}
2025-09-04 14:31:19,413 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZBQjc0OUJEODZBOEEzQUFDQQA='}]}
2025-09-04 14:31:19,425 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:19] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:20,616 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:20] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:20,704 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:20] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:21,409 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:21] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:21,684 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:21] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:38,612 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'How much do they cost'}
2025-09-04 14:31:38,613 - handlers.base_handler - INFO - AIHandler: Handling message 'how much do they cost' in AI chat state for session 2347082345056. Original: 'How much do they cost'
2025-09-04 14:31:41,713 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:31:41,719 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-04 14:31:42,746 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjExMUE1MDM0MzdDNTdBMEIzQwA="}]}
2025-09-04 14:31:42,747 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjExMUE1MDM0MzdDNTdBMEIzQwA='}]}
2025-09-04 14:31:42,748 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:42] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:43,662 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:43] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:44,223 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:44] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:31:44,244 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:31:44] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:14,795 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'What is the best wallpaper'}
2025-09-04 14:32:14,796 - handlers.base_handler - INFO - AIHandler: Handling message 'what is the best wallpaper' in AI chat state for session 2347082345056. Original: 'What is the best wallpaper'
2025-09-04 14:32:17,255 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:32:17,256 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-04 14:32:18,442 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjUyQjJBNTQ0RDlEQTM5RkJBQgA="}]}
2025-09-04 14:32:18,443 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjUyQjJBNTQ0RDlEQTM5RkJBQgA='}]}
2025-09-04 14:32:18,443 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:18] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:19,515 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:19] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:19,978 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:19] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:20,084 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:20] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:48,536 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'How can I order'}
2025-09-04 14:32:48,537 - handlers.base_handler - INFO - AIHandler: Handling message 'how can i order' in AI chat state for session 2347082345056. Original: 'How can I order'
2025-09-04 14:32:52,474 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:32:52,475 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-04 14:32:53,598 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJDMjcwMUVFOTI3RTkyMzdDRAA="}]}
2025-09-04 14:32:53,609 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjJDMjcwMUVFOTI3RTkyMzdDRAA='}]}
2025-09-04 14:32:53,609 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:53] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:54,696 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:54] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:55,136 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:55] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:32:55,187 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:32:55] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:35:46,098 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello i am in calgary, canada which location is the best place to order from and whatsa the shipping fee from there'}
2025-09-04 14:35:46,099 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 14:35:46,099 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 14:35:46,099 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 14:35:46,100 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 14:35:47,334 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg0RjVEMEE4RjcxNkJERUREQwA="}]}
2025-09-04 14:35:47,335 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:35:48,382 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5MkQyRDAxNkVDNDNEMzlCMgA="}]}
2025-09-04 14:35:48,383 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5MkQyRDAxNkVDNDNEMzlCMgA='}]}
2025-09-04 14:35:48,384 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:35:48] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:35:49,372 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:35:49] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:35:49,874 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:35:49] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:35:50,172 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:35:50] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:35:50,853 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:35:50] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:35:56,345 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello i am in calgary, canada which location is the best place to order from and whatsa the shipping\xa0fee\xa0from\xa0there'}
2025-09-04 14:35:56,345 - handlers.base_handler - INFO - AIHandler: Handling message 'hello i am in calgary, canada which location is the best place to order from and whatsa the shippingï¿½feeï¿½fromï¿½there' in AI chat state for session 2348055614455. Original: 'Hello i am in calgary, canada which location is the best place to order from and whatsa the shippingï¿½feeï¿½fromï¿½there'
2025-09-04 14:35:59,337 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:35:59,338 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:36:00,453 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBOEM0RjQzREEzNTM3QUYwNQA="}]}
2025-09-04 14:36:00,453 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRBOEM0RjQzREEzNTM3QUYwNQA='}]}
2025-09-04 14:36:00,454 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:00] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:01,421 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:01] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:02,012 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:02] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:02,092 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:02] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:02,234 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:02] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:21,250 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'But calgary is not in nigeria'}
2025-09-04 14:36:21,251 - handlers.base_handler - INFO - AIHandler: Handling message 'but calgary is not in nigeria' in AI chat state for session 2348055614455. Original: 'But calgary is not in nigeria'
2025-09-04 14:36:23,414 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:36:23,415 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:36:24,642 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxMEZGNEI2NjFFMDgwMzQxQgA="}]}
2025-09-04 14:36:24,642 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkxMEZGNEI2NjFFMDgwMzQxQgA='}]}
2025-09-04 14:36:24,643 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:24] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:25,721 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:25] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:26,183 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:26] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:36:26,337 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:36:26] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:37:50,213 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Can you list the products you have?'}
2025-09-04 14:37:50,214 - handlers.base_handler - INFO - AIHandler: Handling message 'can you list the products you have?' in AI chat state for session 2348055614455. Original: 'Can you list the products you have?'
2025-09-04 14:37:54,803 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:37:54,805 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 14:37:56,202 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlERkY3OUI5NDEzNTg4RkE0RAA="}]}
2025-09-04 14:37:56,203 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlERkY3OUI5NDEzNTg4RkE0RAA='}]}
2025-09-04 14:37:56,204 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:37:56] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:37:57,230 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:37:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:37:57,671 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:37:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:37:57,808 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:37:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:49:15,317 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348055614455. Message type: sticker
2025-09-04 14:49:15,328 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:49:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:51:48,937 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Thank you'}
2025-09-04 14:51:48,941 - handlers.base_handler - INFO - AIHandler: Handling message 'thank you' in AI chat state for session 2347082345056. Original: 'Thank you'
2025-09-04 14:51:50,757 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 14:51:50,773 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-04 14:51:52,187 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcxNDI2NTM4NkE4ODY0NTE2QQA="}]}
2025-09-04 14:51:52,188 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjcxNDI2NTM4NkE4ODY0NTE2QQA='}]}
2025-09-04 14:51:52,189 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:51:52] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:51:53,623 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:51:53] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:51:53,772 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:51:53] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:51:53,941 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:51:53] "POST /webhook HTTP/1.1" 200 -
2025-09-04 14:53:34,808 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'Hi Lola'}
2025-09-04 14:53:34,812 - utils.session_manager - INFO - New session 2349038417663 initialized.
2025-09-04 14:53:34,815 - message_processor - INFO - Session 2349038417663: New session detected. Starting AI chat.
2025-09-04 14:53:34,816 - message_processor - INFO - Session 2349038417663: Starting AI chat for user 'NA'.
2025-09-04 14:53:34,818 - services.whatsapp_service - DEBUG - Created image message payload for 2349038417663
2025-09-04 14:53:35,834 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 14:53:35,835 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-04 14:53:36,423 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 14:53:36,424 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 14:53:36] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:00:40,725 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:00:40] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:13:19,806 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello\nCan you tell me the history of your business and how do i pay ?'}
2025-09-04 15:13:19,815 - handlers.base_handler - INFO - AIHandler: Handling message 'hello
can you tell me the history of your business and how do i pay ?' in AI chat state for session 2348055614455. Original: 'Hello
Can you tell me the history of your business and how do i pay ?'
2025-09-04 15:13:23,127 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 15:13:23,155 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:13:24,509 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1RjA1OEE5QTU5QUI4QkQ3QwA="}]}
2025-09-04 15:13:24,511 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1RjA1OEE5QTU5QUI4QkQ3QwA='}]}
2025-09-04 15:13:24,514 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:13:24] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:13:25,656 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:13:25] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:13:26,337 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:13:26] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:13:29,544 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:13:29] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:30:37,939 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you have a waitlist i can join?'}
2025-09-04 15:30:37,944 - handlers.base_handler - INFO - AIHandler: Handling message 'do you have a waitlist i can join?' in AI chat state for session 2348055614455. Original: 'Do you have a waitlist i can join?'
2025-09-04 15:30:41,063 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 15:30:41,080 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:30:42,777 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 15:30:42,778 - message_processor - INFO - Session 2348055614455: No response generated. Starting AI chat.
2025-09-04 15:30:42,778 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 15:30:42,779 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 15:30:43,706 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 15:30:43,707 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:30:44,574 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 15:30:44,576 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:30:44] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:49:47,328 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 15:49:49,670 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 15:49:52,260 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 15:49:52,523 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 15:49:54,517 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 15:49:54,723 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 15:49:54,723 - services.payment_service - INFO - PaymentService initialized
2025-09-04 15:49:54,723 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 15:49:55,187 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 15:49:55,188 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 15:49:55,528 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 15:49:55,529 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 15:49:55,529 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 15:49:55,529 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 15:49:55,530 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 15:49:57,293 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 15:49:57,522 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 15:49:59,740 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 15:50:00,059 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 15:50:00,059 - services.payment_service - INFO - PaymentService initialized
2025-09-04 15:50:00,060 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 15:50:00,060 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 15:50:00,060 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 15:50:00,061 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 15:50:00,100 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 15:50:00,100 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 15:50:01,418 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you have a waitlist i can\xa0join?'}
2025-09-04 15:50:01,418 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 15:50:01,418 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 15:50:01,419 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 15:50:01,419 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 15:50:02,981 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQwNzI2MDZBQTEzOTU5MjZCRQA="}]}
2025-09-04 15:50:02,993 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:50:04,113 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI1MjM4RjQ2RkM3ODJERkMyNQA="}]}
2025-09-04 15:50:04,113 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI1MjM4RjQ2RkM3ODJERkMyNQA='}]}
2025-09-04 15:50:04,114 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:04] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:05,464 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:05] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:05,714 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:05] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:05,820 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:05] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:05,823 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:05] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:06,433 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:06] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:11,706 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you have a waitlist i can\xa0join?'}
2025-09-04 15:50:11,706 - handlers.base_handler - INFO - AIHandler: Handling message 'do you have a waitlist i canï¿½join?' in AI chat state for session 2348055614455. Original: 'Do you have a waitlist i canï¿½join?'
2025-09-04 15:50:14,922 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 15:50:14,928 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:50:16,021 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzNDYzODQxNjBGRDBGOUYyRAA="}]}
2025-09-04 15:50:16,022 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAzNDYzODQxNjBGRDBGOUYyRAA='}]}
2025-09-04 15:50:16,023 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:16] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:17,349 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:17] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:17,479 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:17] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:17,640 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:17] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:50:17,849 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:50:17] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:55:03,078 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 15:55:04,602 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 15:55:07,275 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 15:55:07,509 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 15:55:47,239 - utils.data_manager - ERROR - Database error while loading user details: connection to server at "ep-autumn-flower-a8gfew31-pooler.eastus2.azure.neon.tech" (52.167.188.143), port 5432 failed: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\Wallpaper.ng\utils\data_manager.py", line 249, in load_user_details
    with psycopg2.connect(**self.db_params) as conn:
         ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "ep-autumn-flower-a8gfew31-pooler.eastus2.azure.neon.tech" (52.167.188.143), port 5432 failed: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

2025-09-04 15:55:47,251 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 15:55:47,252 - services.payment_service - INFO - PaymentService initialized
2025-09-04 15:55:47,252 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 15:55:47,737 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 15:55:47,737 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 15:55:48,079 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 15:55:48,080 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 15:55:48,080 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 15:55:48,080 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 15:55:48,080 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 15:55:49,902 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 15:55:50,131 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 15:55:52,131 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 15:55:52,346 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 15:55:52,347 - services.payment_service - INFO - PaymentService initialized
2025-09-04 15:55:52,347 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 15:55:52,348 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 15:55:52,348 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 15:55:52,349 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 15:55:52,388 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 15:55:52,389 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 15:55:57,291 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you have a waitlist i can\xa0join?'}
2025-09-04 15:55:57,292 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 15:55:57,292 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 15:55:57,292 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 15:55:57,293 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 15:55:58,440 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you have a waitlist i can\xa0join?'}
2025-09-04 15:55:58,440 - handlers.base_handler - INFO - AIHandler: Handling message 'do you have a waitlist i canï¿½join?' in AI chat state for session 2348055614455. Original: 'Do you have a waitlist i canï¿½join?'
2025-09-04 15:55:58,484 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNDMzI0QjBBMTE4NzBDNjYyNgA="}]}
2025-09-04 15:55:58,490 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:55:59,055 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:55:59] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:55:59,520 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMwREM5QUY5RkNDNDI5NTY0OAA="}]}
2025-09-04 15:55:59,521 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMwREM5QUY5RkNDNDI5NTY0OAA='}]}
2025-09-04 15:55:59,522 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:55:59] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:00,622 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:00] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:01,077 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:01] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:01,213 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:01] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:01,220 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:01] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:01,526 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 15:56:01,535 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:56:02,540 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEM0MwODY0MTlENTk0ODAxNQA="}]}
2025-09-04 15:56:02,541 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdEM0MwODY0MTlENTk0ODAxNQA='}]}
2025-09-04 15:56:02,541 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:02] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:03,553 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:03] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:03,932 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:03] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:56:04,052 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:56:04] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:58:16,149 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 15:58:17,967 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 15:58:19,757 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 15:58:19,966 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 15:58:21,936 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 15:58:22,621 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 15:58:22,622 - services.payment_service - INFO - PaymentService initialized
2025-09-04 15:58:22,622 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 15:58:23,010 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 15:58:23,011 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 15:58:23,361 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 15:58:23,361 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 15:58:23,362 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 15:58:23,362 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 15:58:23,362 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 15:58:25,661 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 15:58:25,877 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 15:58:27,967 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 15:58:28,176 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 15:58:28,177 - services.payment_service - INFO - PaymentService initialized
2025-09-04 15:58:28,177 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 15:58:28,178 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 15:58:28,178 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 15:58:28,178 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 15:58:28,196 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 15:58:28,196 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 15:58:33,869 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello what are your products and what do you sell them for?'}
2025-09-04 15:58:33,869 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 15:58:33,870 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 15:58:33,870 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 15:58:33,870 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 15:58:35,081 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFDNUZFODExNDc0NTRBMEEyOAA="}]}
2025-09-04 15:58:35,082 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:58:35,538 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:58:35] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:58:36,106 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3NUVEMzc1NTlGMDIzMjFGMwA="}]}
2025-09-04 15:58:36,107 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3NUVEMzc1NTlGMDIzMjFGMwA='}]}
2025-09-04 15:58:36,108 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:58:36] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:58:37,257 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:58:37] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:58:37,622 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:58:37] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:58:37,771 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:58:37] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:58:59,848 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello what are your products and what do you sell\xa0them\xa0for?'}
2025-09-04 15:58:59,848 - handlers.base_handler - INFO - AIHandler: Handling message 'hello what are your products and what do you sellï¿½themï¿½for?' in AI chat state for session 2348055614455. Original: 'Hello what are your products and what do you sellï¿½themï¿½for?'
2025-09-04 15:59:03,951 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 15:59:03,954 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:59:05,040 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZEQjY0NDk5Njc4NTgyN0QyOQA="}]}
2025-09-04 15:59:05,041 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZEQjY0NDk5Njc4NTgyN0QyOQA='}]}
2025-09-04 15:59:05,043 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:05] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:06,251 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:06] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:06,505 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:06] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:06,599 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:06] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:06,715 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:06] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:18,091 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:18] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:29,132 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 15:59:29,133 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:59:30,264 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMzQkJBRjkzOUJBODI2MEI5QwA="}]}
2025-09-04 15:59:30,265 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjMzQkJBRjkzOUJBODI2MEI5QwA='}]}
2025-09-04 15:59:30,266 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:30] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:31,197 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:31] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:31,573 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:31] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:31,605 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:31] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:49,619 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'i want to order 5 and use your standard deisgn'}
2025-09-04 15:59:49,620 - handlers.base_handler - INFO - AIHandler: Handling message 'i want to order 5 and use your standard deisgn' in AI chat state for session 2348055614455. Original: 'i want to order 5 and use your standard deisgn'
2025-09-04 15:59:53,011 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 15:59:53,013 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 15:59:53,975 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNEQ3ODM1MzBFOEZGQzUwMwA="}]}
2025-09-04 15:59:53,976 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhGNEQ3ODM1MzBFOEZGQzUwMwA='}]}
2025-09-04 15:59:53,977 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:53] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:54,999 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:54] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:55,423 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:55] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:55,500 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:55] "POST /webhook HTTP/1.1" 200 -
2025-09-04 15:59:55,573 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 15:59:55] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:00:17,627 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Howson Wright Lagos, Bank Transfer and Blue color'}
2025-09-04 16:00:17,627 - handlers.base_handler - INFO - AIHandler: Handling message 'howson wright lagos, bank transfer and blue color' in AI chat state for session 2348055614455. Original: 'Howson Wright Lagos, Bank Transfer and Blue color'
2025-09-04 16:00:20,693 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 16:00:20,694 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:00:21,965 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4N0I3NTcxNzA3QUZFODA0NAA="}]}
2025-09-04 16:00:21,966 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4N0I3NTcxNzA3QUZFODA0NAA='}]}
2025-09-04 16:00:21,967 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:00:21] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:00:23,153 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:00:23] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:00:23,445 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:00:23] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:00:23,599 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:00:23] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:00:57,966 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "Okay thank you \nI've paid"}
2025-09-04 16:00:57,966 - handlers.base_handler - INFO - AIHandler: Handling message 'okay thank you 
i've paid' in AI chat state for session 2348055614455. Original: 'Okay thank you 
I've paid'
2025-09-04 16:01:00,659 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 16:01:00,660 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:01:01,665 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3QzE3NjAwRUY3NjE1Mzc3MwA="}]}
2025-09-04 16:01:01,666 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU3QzE3NjAwRUY3NjE1Mzc3MwA='}]}
2025-09-04 16:01:01,667 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:01:01] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:01:02,688 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:01:02] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:01:03,183 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:01:03] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:01:03,197 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:01:03] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:04:54,256 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 16:04:56,443 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:04:59,106 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:04:59,313 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:05:01,117 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:05:01,315 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:05:01,316 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:05:01,317 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 16:05:01,943 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:05:01,943 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:05:02,505 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:05:02,505 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:05:02,506 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 16:05:02,506 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 16:05:02,506 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:05:04,114 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:05:04,315 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:05:06,124 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:05:06,324 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:05:06,325 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:05:06,325 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 16:05:06,326 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 16:05:06,326 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 16:05:06,326 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 16:05:06,344 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 16:05:06,344 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 16:05:10,577 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello DO you deliver to abuja'}
2025-09-04 16:05:10,577 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 16:05:10,578 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 16:05:10,578 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 16:05:10,578 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 16:05:11,865 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRFRURGQjBBMTk5MTgxRjJEOAA="}]}
2025-09-04 16:05:11,866 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:05:13,044 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg4QkY3OTAxMjExMkUzMERCNwA="}]}
2025-09-04 16:05:13,046 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg4QkY3OTAxMjExMkUzMERCNwA='}]}
2025-09-04 16:05:13,048 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:05:13] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:05:14,166 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:05:14] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:05:14,676 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:05:14] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:05:15,047 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:05:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:05:15,245 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:05:15] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:07:23,430 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 16:07:25,537 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:07:27,134 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:07:27,333 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:07:29,124 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:07:29,325 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:07:29,326 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:07:29,326 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 16:07:29,915 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:07:29,915 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:07:30,392 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:07:30,392 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:07:30,393 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 16:07:30,393 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 16:07:30,393 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:07:31,985 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:07:32,183 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:07:33,984 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:07:34,184 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:07:34,185 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:07:34,185 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 16:07:34,186 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 16:07:34,186 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 16:07:34,186 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 16:07:34,199 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 16:07:34,199 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 16:07:53,388 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Zigamak Test): {'type': 'text', 'text': 'Hello DO you deliver to abuja'}
2025-09-04 16:07:53,388 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 16:07:53,388 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 16:07:53,389 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Zigamak Test'.
2025-09-04 16:07:53,389 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 16:07:54,504 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQzMzQwRTI4RDU1OEM2Q0U4QwA="}]}
2025-09-04 16:07:54,504 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:07:55,157 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:07:55] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:07:55,585 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1RTAxMDNEQTExMjdFQ0NDMAA="}]}
2025-09-04 16:07:55,586 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU1RTAxMDNEQTExMjdFQ0NDMAA='}]}
2025-09-04 16:07:55,587 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:07:55] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:07:56,705 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:07:56] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:07:57,115 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:07:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:07:57,826 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:07:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:08:34,459 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 16:08:35,984 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:08:37,583 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:08:37,802 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:08:39,705 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:08:39,904 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:08:39,904 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:08:39,905 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 16:08:40,338 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:08:40,338 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:08:40,673 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:08:40,674 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:08:40,674 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 16:08:40,674 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 16:08:40,675 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:08:42,323 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:08:42,523 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:08:44,353 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:08:44,554 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:08:44,555 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:08:44,555 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 16:08:44,556 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 16:08:44,556 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 16:08:44,557 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 16:08:44,584 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 16:08:44,584 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 16:08:45,016 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What colors are available'}
2025-09-04 16:08:45,016 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 16:08:45,017 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 16:08:45,017 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga'.
2025-09-04 16:08:45,017 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 16:08:46,380 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJDOTk3NTQ5MkY4MkJBNzM1NgA="}]}
2025-09-04 16:08:46,381 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:08:46,834 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:08:46] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:08:47,534 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhERDA3NkU0MTAwMDE1NjU0NAA="}]}
2025-09-04 16:08:47,535 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhERDA3NkU0MTAwMDE1NjU0NAA='}]}
2025-09-04 16:08:47,536 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:08:47] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:08:48,626 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:08:48] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:08:49,095 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:08:49] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:08:49,323 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:08:49] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:08:54,193 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What colors are available'}
2025-09-04 16:08:54,193 - handlers.base_handler - INFO - AIHandler: Handling message 'what colors are available' in AI chat state for session 2348055614455. Original: 'What colors are available'
2025-09-04 16:08:57,462 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 16:08:57,470 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:08:58,681 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QjkzNUMzRUE4MzE1OEZCRAA="}]}
2025-09-04 16:08:58,682 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QjkzNUMzRUE4MzE1OEZCRAA='}]}
2025-09-04 16:08:58,683 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:08:58] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:08:59,918 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:08:59] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:09:00,393 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:09:00] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:09:00,436 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:09:00] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:09:00,946 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:09:00] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:11:19,732 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 16:11:21,583 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:11:23,432 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:11:23,632 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:11:25,439 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:11:25,633 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:11:25,634 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:11:25,634 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 16:11:26,161 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:11:26,162 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:11:26,617 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:11:26,618 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:11:26,618 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 16:11:26,618 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 16:11:26,619 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:11:28,283 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:11:28,482 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:11:30,293 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:11:30,493 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:11:30,494 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:11:30,494 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 16:11:30,494 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 16:11:30,495 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 16:11:30,495 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 16:11:30,508 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 16:11:30,509 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 16:11:38,131 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What colors are available'}
2025-09-04 16:11:38,132 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 16:11:38,132 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 16:11:38,132 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'What colors are available'.
2025-09-04 16:11:38,133 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 16:11:39,394 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZCOEIzQjhEMzYwREI3OUQzMgA="}]}
2025-09-04 16:11:40,026 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:11:40] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:11:42,816 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 16:11:42,818 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:11:43,943 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE1N0E4RTU5QkFBQzRCMEU3QQA="}]}
2025-09-04 16:11:43,944 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE1N0E4RTU5QkFBQzRCMEU3QQA='}]}
2025-09-04 16:11:43,945 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:11:43] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:11:45,244 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:11:45] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:11:45,515 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:11:45] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:11:45,672 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:11:45] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:12:01,730 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello DO you deliver to abuja'}
2025-09-04 16:12:01,731 - handlers.base_handler - INFO - AIHandler: Handling message 'hello do you deliver to abuja' in AI chat state for session 2348055614455. Original: 'Hello DO you deliver to abuja'
2025-09-04 16:12:03,953 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 16:12:03,954 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 16:12:05,573 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc2QkQzRjFFRjdDRkRBRjkzOQA="}]}
2025-09-04 16:12:05,574 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc2QkQzRjFFRjdDRkRBRjkzOQA='}]}
2025-09-04 16:12:05,574 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:12:05] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:12:06,830 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:12:06] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:12:08,361 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:12:08] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:12:08,363 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:12:08] "POST /webhook HTTP/1.1" 200 -
2025-09-04 16:15:28,890 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 16:15:31,025 - __main__ - ERROR - Import error: No module named 'handlers.payment_handler'
2025-09-04 16:15:48,918 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 16:15:50,997 - __main__ - ERROR - Import error: No module named 'handlers.product_sync_handler'
2025-09-04 16:17:08,579 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 16:17:10,173 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:17:11,913 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:17:12,111 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:17:13,922 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:17:14,122 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:17:14,123 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:17:14,123 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 16:17:14,600 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:17:14,601 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:17:15,069 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 16:17:15,070 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 16:17:15,070 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 16:17:15,071 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 16:17:15,071 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 16:17:16,672 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 16:17:16,871 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 16:17:18,672 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 16:17:18,872 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 16:17:18,873 - services.payment_service - INFO - PaymentService initialized
2025-09-04 16:17:18,873 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 16:17:18,874 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 16:17:18,874 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 16:17:18,874 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 16:17:18,892 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 16:17:18,893 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 16:22:34,614 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 16:22:34] "POST /webhook HTTP/1.1" 200 -
2025-09-04 18:11:35,969 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 18:11:39,063 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 18:11:44,061 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 18:11:44,299 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 18:11:46,132 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 18:11:46,342 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 18:11:46,343 - services.payment_service - INFO - PaymentService initialized
2025-09-04 18:11:46,343 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 18:11:46,829 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 18:11:46,830 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 18:11:47,162 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 18:11:47,162 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 18:11:47,163 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 18:11:47,164 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 18:11:47,164 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 18:11:49,008 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 18:11:49,474 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 18:11:51,848 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 18:11:52,062 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 18:11:52,062 - services.payment_service - INFO - PaymentService initialized
2025-09-04 18:11:52,063 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 18:11:52,063 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 18:11:52,063 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 18:11:52,064 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 18:11:52,099 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 18:11:52,099 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 18:12:40,170 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello \nHow far is your pickup point from where I am'}
2025-09-04 18:12:40,170 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 18:12:40,171 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 18:12:40,171 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello 
How far is your pickup point from where I am'.
2025-09-04 18:12:40,171 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 18:12:41,042 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 18:12:43,303 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 18:12:43,312 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 18:12:43,891 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-04 18:12:43,893 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 18:12:43] "POST /webhook HTTP/1.1" 200 -
2025-09-04 18:12:52,544 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 18:12:53,706 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 18:12:55,350 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 18:12:55,562 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 18:12:57,530 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 18:12:57,734 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 18:12:57,734 - services.payment_service - INFO - PaymentService initialized
2025-09-04 18:12:57,735 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 18:12:58,103 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 18:12:58,104 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 18:12:58,434 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 18:12:58,434 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 18:12:58,434 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 18:12:58,435 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 18:12:58,435 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 18:13:00,250 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 18:13:00,461 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 18:13:02,581 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 18:13:02,835 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 18:13:02,836 - services.payment_service - INFO - PaymentService initialized
2025-09-04 18:13:02,836 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 18:13:02,837 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 18:13:02,837 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 18:13:02,838 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 18:13:02,850 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 18:13:02,850 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 18:13:05,293 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello \nHow far is your pickup point from where I am'}
2025-09-04 18:13:05,293 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 18:13:05,294 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 18:13:05,294 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello 
How far is your pickup point from where I am'.
2025-09-04 18:13:05,294 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 18:13:06,742 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFFMTJCQUQ1OTcyOTgyMkY3QwA="}]}
2025-09-04 18:13:08,536 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 18:13:08] "POST /webhook HTTP/1.1" 200 -
2025-09-04 18:13:09,613 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 18:13:09,615 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 18:13:10,850 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBQ0M4MTMwMEUyMkFBMUVFMAA="}]}
2025-09-04 18:13:10,851 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBQ0M4MTMwMEUyMkFBMUVFMAA='}]}
2025-09-04 18:13:10,851 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 18:13:10] "POST /webhook HTTP/1.1" 200 -
2025-09-04 18:13:11,970 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 18:13:11] "POST /webhook HTTP/1.1" 200 -
2025-09-04 18:13:12,622 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 18:13:12] "POST /webhook HTTP/1.1" 200 -
2025-09-04 18:36:57,212 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348055614455. Message type: sticker
2025-09-04 18:36:57,212 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 18:36:57] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:05:19,878 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 20:05:21,833 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 20:05:24,568 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 20:05:24,808 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 20:05:26,948 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 20:05:27,195 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 20:05:27,196 - services.payment_service - INFO - PaymentService initialized
2025-09-04 20:05:27,196 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 20:05:27,644 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 20:05:27,644 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 20:05:27,979 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-04 20:05:27,980 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-04 20:05:27,980 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 20:05:27,980 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 20:05:27,981 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 20:05:29,888 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 20:05:30,128 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 20:05:32,268 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 20:05:32,508 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 20:05:32,508 - services.payment_service - INFO - PaymentService initialized
2025-09-04 20:05:32,509 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 20:05:32,509 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 20:05:32,509 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 20:05:32,510 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 20:05:32,547 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 20:05:32,547 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 20:22:05,106 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What colors are available'}
2025-09-04 20:22:05,111 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 20:22:05,113 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-04 20:22:05,114 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'What colors are available'.
2025-09-04 20:22:05,115 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 20:22:06,736 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjBDMzEzMTBGMEM0RERBMEY5OAA="}]}
2025-09-04 20:22:10,077 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-04 20:22:10,095 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 20:22:10,461 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:22:10] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:22:11,965 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5NzY3MkFGNzAwREYzREU5NQA="}]}
2025-09-04 20:22:11,966 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ5NzY3MkFGNzAwREYzREU5NQA='}]}
2025-09-04 20:22:11,967 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:22:11] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:22:13,327 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:22:13] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:22:13,717 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:22:13] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:22:31,345 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:22:31] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:33:41,444 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-04 20:33:45,497 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 20:33:48,203 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 20:33:48,443 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 20:33:50,573 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 20:33:50,823 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 20:33:50,824 - services.payment_service - INFO - PaymentService initialized
2025-09-04 20:33:50,824 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-04 20:33:50,825 - services.ai_service - WARNING - AI features disabled in Wallpaper.ng AIService - missing Gemini API configuration.
2025-09-04 20:33:50,825 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-09-04 20:33:50,825 - services.ai_service - WARNING - AI features disabled in Wallpaper.ng AIService - missing Gemini API configuration.
2025-09-04 20:33:50,825 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-09-04 20:33:50,825 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-04 20:33:50,826 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-04 20:33:50,826 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-04 20:33:52,723 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-04 20:33:52,962 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-04 20:33:55,114 - utils.data_manager - INFO - Successfully loaded 58 user details from database
2025-09-04 20:33:55,460 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-04 20:33:55,460 - services.payment_service - INFO - PaymentService initialized
2025-09-04 20:33:55,460 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-04 20:33:55,461 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-04 20:33:55,461 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-04 20:33:55,462 - app - INFO - WebhookHandler initialized with message processor.
2025-09-04 20:33:55,482 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-04 20:33:55,483 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-04 20:34:48,143 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-04 20:34:48,143 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-04 20:34:48,143 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-04 20:34:48,143 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-04 20:34:48,144 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-04 20:34:49,483 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUxODdFNzk2MkQxRDI0QTU2RAA="}]}
2025-09-04 20:34:49,484 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 20:34:51,003 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkwNzJFMkJBQ0ZCN0QxQTMwRgA="}]}
2025-09-04 20:34:51,004 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjkwNzJFMkJBQ0ZCN0QxQTMwRgA='}]}
2025-09-04 20:34:51,005 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:34:51] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:34:52,356 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:34:52] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:34:52,735 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:34:52] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:34:52,737 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:34:52] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:34:56,689 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:34:56] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:35:11,672 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Whats the colors that you have'}
2025-09-04 20:35:11,673 - handlers.base_handler - INFO - AIHandler: Handling message 'whats the colors that you have' in AI chat state for session 2348055614455. Original: 'Whats the colors that you have'
2025-09-04 20:35:11,673 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-04 20:35:12,862 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2ODdDNzE1NUY2MTMxNkIwNgA="}]}
2025-09-04 20:35:12,863 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ2ODdDNzE1NUY2MTMxNkIwNgA='}]}
2025-09-04 20:35:12,864 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:35:12] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:35:14,145 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:35:14] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:35:14,515 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:35:14] "POST /webhook HTTP/1.1" 200 -
2025-09-04 20:35:14,517 - werkzeug - INFO - 127.0.0.1 - - [04/Sep/2025 20:35:14] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:24:06,235 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-08 14:24:09,504 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-08 14:24:11,289 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-08 14:24:11,494 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-08 14:24:13,300 - utils.data_manager - INFO - Successfully loaded 59 user details from database
2025-09-08 14:24:13,502 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-08 14:24:13,504 - services.payment_service - INFO - PaymentService initialized
2025-09-08 14:24:13,504 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-08 14:24:14,071 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-08 14:24:14,072 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-08 14:24:14,455 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-08 14:24:14,456 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-08 14:24:14,456 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-08 14:24:14,456 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-08 14:24:14,457 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-08 14:24:16,060 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-08 14:24:16,260 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-08 14:24:18,160 - utils.data_manager - INFO - Successfully loaded 59 user details from database
2025-09-08 14:24:18,361 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-09-08 14:24:18,361 - services.payment_service - INFO - PaymentService initialized
2025-09-08 14:24:18,362 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-08 14:24:18,362 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-08 14:24:18,362 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-08 14:24:18,363 - app - INFO - WebhookHandler initialized with message processor.
2025-09-08 14:24:18,389 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-08 14:24:18,390 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-08 14:25:54,898 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hi'}
2025-09-08 14:25:54,899 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-09-08 14:25:54,899 - message_processor - INFO - Session 2347082345056: Global command 'hi' detected. Going to AI chat.
2025-09-08 14:25:54,899 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke' with message 'Hi'.
2025-09-08 14:25:54,900 - services.whatsapp_service - DEBUG - Created image message payload for 2347082345056
2025-09-08 14:25:56,391 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjdDM0I4RERDNzhBQkYzMkM2NQA="}]}
2025-09-08 14:25:56,391 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:25:57,432 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBDMkMxMkRGNDJFMTNGNkQ1MQA="}]}
2025-09-08 14:25:57,433 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjBDMkMxMkRGNDJFMTNGNkQ1MQA='}]}
2025-09-08 14:25:57,434 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:25:57] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:25:58,865 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:25:58] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:25:59,098 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:25:59] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:25:59,363 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:25:59] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:25:59,422 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:25:59] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:26:47,326 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-08 14:26:47,327 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-08 14:26:47,328 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-08 14:26:47,328 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-08 14:26:47,328 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-08 14:26:48,691 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFGMDE1MDREMTkwMzAxNDJDNAA="}]}
2025-09-08 14:26:48,692 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-08 14:26:49,931 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE0M0IxODVFMUZCQzM4MkY4OQA="}]}
2025-09-08 14:26:49,931 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE0M0IxODVFMUZCQzM4MkY4OQA='}]}
2025-09-08 14:26:49,932 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:26:49] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:26:51,150 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:26:51] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:26:51,562 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:26:51] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:26:51,948 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:26:51] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:26:52,104 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:26:52] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:27:02,091 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'WHatsa your delivery rate?'}
2025-09-08 14:27:02,092 - handlers.base_handler - INFO - AIHandler: Handling message 'whatsa your delivery rate?' in AI chat state for session 2348055614455. Original: 'WHatsa your delivery rate?'
2025-09-08 14:27:04,771 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:27:04,773 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-08 14:27:06,150 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3NTczQzU5QjJEQ0FBNURDMgA="}]}
2025-09-08 14:27:06,150 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ3NTczQzU5QjJEQ0FBNURDMgA='}]}
2025-09-08 14:27:06,151 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:27:06] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:27:07,458 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:27:07] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:27:07,574 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:27:07] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:27:07,640 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:27:07] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:28:36,781 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'Yo'}
2025-09-08 14:28:36,781 - utils.session_manager - INFO - New session 2349038417663 initialized.
2025-09-08 14:28:36,781 - message_processor - INFO - Session 2349038417663: New session detected. Starting AI chat.
2025-09-08 14:28:36,782 - message_processor - INFO - Session 2349038417663: Starting AI chat for user 'NA' with message 'Yo'.
2025-09-08 14:28:36,782 - services.whatsapp_service - DEBUG - Created image message payload for 2349038417663
2025-09-08 14:28:37,639 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-08 14:28:38,991 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:28:38,992 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-08 14:28:39,740 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-08 14:28:39,741 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:28:39] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:28:52,732 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'Trying to find about your product'}
2025-09-08 14:28:52,733 - handlers.base_handler - INFO - AIHandler: Handling message 'trying to find about your product' in AI chat state for session 2349038417663. Original: 'Trying to find about your product'
2025-09-08 14:28:54,400 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:28:54,401 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-08 14:28:55,159 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-08 14:28:55,160 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:28:55] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:29:36,336 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'How is your pricing'}
2025-09-08 14:29:36,336 - handlers.base_handler - INFO - AIHandler: Handling message 'how is your pricing' in AI chat state for session 2347082345056. Original: 'How is your pricing'
2025-09-08 14:29:38,598 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:29:38,599 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:29:39,704 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkY1OEVCMDEyM0FDNDEyRTJFMwA="}]}
2025-09-08 14:29:39,705 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkY1OEVCMDEyM0FDNDEyRTJFMwA='}]}
2025-09-08 14:29:39,707 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:29:39] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:29:40,542 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:29:40] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:29:41,140 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:29:41] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:29:41,351 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:29:41] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:29:55,920 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Is there a waitlist?'}
2025-09-08 14:29:55,921 - handlers.base_handler - INFO - AIHandler: Handling message 'is there a waitlist?' in AI chat state for session 2347082345056. Original: 'Is there a waitlist?'
2025-09-08 14:29:58,192 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:29:58,194 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:29:59,300 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkYyMDg5RDMwM0EzQTMwQTE0RQA="}]}
2025-09-08 14:29:59,301 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkYyMDg5RDMwM0EzQTMwQTE0RQA='}]}
2025-09-08 14:29:59,301 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:29:59] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:30:00,124 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:30:00] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:30:00,711 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:30:00] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:30:00,731 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:30:00] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:30:14,922 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Thank you'}
2025-09-08 14:30:14,922 - handlers.base_handler - INFO - AIHandler: Handling message 'thank you' in AI chat state for session 2347082345056. Original: 'Thank you'
2025-09-08 14:30:16,540 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:30:16,541 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:30:17,541 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZEQUM0OUVGMjNEQTEzQjE4MwA="}]}
2025-09-08 14:30:17,542 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjZEQUM0OUVGMjNEQTEzQjE4MwA='}]}
2025-09-08 14:30:17,543 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:30:17] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:30:18,425 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:30:18] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:30:18,964 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:30:18] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:30:18,990 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:30:18] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:31:19,390 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'Hey'}
2025-09-08 14:31:19,391 - handlers.base_handler - INFO - AIHandler: Handling message 'hey' in AI chat state for session 2349038417663. Original: 'Hey'
2025-09-08 14:31:20,874 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:31:20,876 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-08 14:31:21,740 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-08 14:31:21,741 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:31:21] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:32:13,020 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hello'}
2025-09-08 14:32:13,021 - message_processor - INFO - Session 2347082345056: Global command 'hello' detected. Going to AI chat.
2025-09-08 14:32:13,021 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke' with message 'Hello'.
2025-09-08 14:32:13,022 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:32:13,022 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2347082345056: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'What would you like to know about our wallpapers and interior solutions?'}}
2025-09-08 14:32:14,039 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU0NjFBOUIxQ0JCNEM3MUFBOQA="}]}
2025-09-08 14:32:14,040 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjU0NjFBOUIxQ0JCNEM3MUFBOQA='}]}
2025-09-08 14:32:14,041 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:32:14] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:32:15,092 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:32:15] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:32:15,575 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:32:15] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:32:15,671 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:32:15] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:24,790 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'What type of wallpapers do you have'}
2025-09-08 14:33:24,791 - handlers.base_handler - INFO - AIHandler: Handling message 'what type of wallpapers do you have' in AI chat state for session 2347082345056. Original: 'What type of wallpapers do you have'
2025-09-08 14:33:28,450 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:33:28,451 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:33:29,541 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU4Qjk1MzY0MDAwODUzQjg2MwA="}]}
2025-09-08 14:33:29,542 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkU4Qjk1MzY0MDAwODUzQjg2MwA='}]}
2025-09-08 14:33:29,543 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:29] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:30,415 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:30] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:30,931 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:30] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:31,211 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:31] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:51,190 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Can you deliver to Lagos'}
2025-09-08 14:33:51,191 - handlers.base_handler - INFO - AIHandler: Handling message 'can you deliver to lagos' in AI chat state for session 2347082345056. Original: 'Can you deliver to Lagos'
2025-09-08 14:33:53,932 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:33:53,933 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:33:54,980 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkE3RUNCMzVGOEVBNzMxRjlDQwA="}]}
2025-09-08 14:33:54,982 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkE3RUNCMzVGOEVBNzMxRjlDQwA='}]}
2025-09-08 14:33:54,983 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:54] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:55,969 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:55] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:56,403 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:56] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:33:56,662 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:33:56] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:35:29,926 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Thank you'}
2025-09-08 14:35:29,927 - handlers.base_handler - INFO - AIHandler: Handling message 'thank you' in AI chat state for session 2347082345056. Original: 'Thank you'
2025-09-08 14:35:31,508 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 14:35:31,510 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-08 14:35:32,498 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ5MUI4QUFGREZENDJDQUMzMQA="}]}
2025-09-08 14:35:32,499 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkQ5MUI4QUFGREZENDJDQUMzMQA='}]}
2025-09-08 14:35:32,500 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:35:32] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:35:33,430 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:35:33] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:35:34,019 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:35:34] "POST /webhook HTTP/1.1" 200 -
2025-09-08 14:35:34,280 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 14:35:34] "POST /webhook HTTP/1.1" 200 -
2025-09-08 16:29:27,488 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello good after can you remember the last question i asked?'}
2025-09-08 16:29:27,495 - utils.session_manager - INFO - Session 2348055614455 timed out after 7342.72 seconds (timeout limit: 3000s). Resetting.
2025-09-08 16:29:27,498 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-08 16:29:27,498 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello good after can you remember the last question i asked?'.
2025-09-08 16:29:27,501 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-08 16:29:28,303 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-08 16:29:29,743 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-08 16:29:29,752 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-08 16:29:30,293 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-09-08 16:29:30,296 - werkzeug - INFO - 127.0.0.1 - - [08/Sep/2025 16:29:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:31:56,875 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 00:32:00,840 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 00:32:02,866 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-11 00:32:03,154 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-11 00:32:04,998 - utils.data_manager - INFO - Successfully loaded 59 user details from database
2025-09-11 00:32:05,234 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 00:32:05,235 - services.payment_service - INFO - PaymentService initialized
2025-09-11 00:32:05,236 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 00:32:06,370 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 00:32:06,371 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 00:32:07,479 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 00:32:07,480 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 00:32:07,483 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 00:32:07,484 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 00:32:07,485 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 00:32:09,191 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-11 00:32:09,385 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-11 00:32:11,344 - utils.data_manager - INFO - Successfully loaded 59 user details from database
2025-09-11 00:32:11,546 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 00:32:11,547 - services.payment_service - INFO - PaymentService initialized
2025-09-11 00:32:11,548 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 00:32:11,550 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 00:32:11,551 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 00:32:11,552 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 00:32:11,641 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 00:32:11,643 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 00:34:05,874 - handlers.webhook_handler - INFO - WhatsApp webhook verified successfully!
2025-09-11 00:34:05,877 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:34:05] "GET /webhook?hub.mode=subscribe&hub.challenge=411489648&hub.verify_token=123456 HTTP/1.1" 200 -
2025-09-11 00:34:43,557 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-11 00:34:43,558 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 00:34:43,558 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-11 00:34:43,559 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-11 00:34:43,560 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 00:34:45,726 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhFMTFGNTE4QjJERUQ4MkU2OAA="}]}
2025-09-11 00:34:45,777 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 00:34:46,795 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1Mjc2QTlCQ0NDRjc0NDk1QwA="}]}
2025-09-11 00:34:46,796 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM1Mjc2QTlCQ0NDRjc0NDk1QwA='}]}
2025-09-11 00:34:46,798 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:34:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:34:48,978 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:34:48] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:34:49,241 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:34:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:34:49,369 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:34:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:34:49,813 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:34:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:05,034 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Can i know what you deliver'}
2025-09-11 00:35:05,035 - handlers.base_handler - INFO - AIHandler: Handling message 'can i know what you deliver' in AI chat state for session 2348055614455. Original: 'Can i know what you deliver'
2025-09-11 00:35:08,040 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 00:35:08,049 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 00:35:09,016 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwNzBCNjk3MDUxQzBEQjVBQwA="}]}
2025-09-11 00:35:09,018 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjcwNzBCNjk3MDUxQzBEQjVBQwA='}]}
2025-09-11 00:35:09,019 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:10,249 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:10] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:10,777 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:10] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:10,930 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:10] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:28,786 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'DO you deliver to abuja and how do i pay?'}
2025-09-11 00:35:28,787 - handlers.base_handler - INFO - AIHandler: Handling message 'do you deliver to abuja and how do i pay?' in AI chat state for session 2348055614455. Original: 'DO you deliver to abuja and how do i pay?'
2025-09-11 00:35:30,525 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 00:35:30,527 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 00:35:31,475 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBQzNEQjk0QTkzMjdEMjFFMwA="}]}
2025-09-11 00:35:31,476 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkFBQzNEQjk0QTkzMjdEMjFFMwA='}]}
2025-09-11 00:35:31,478 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:32,879 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:33,297 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 00:35:33,417 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 00:35:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 18:58:07,484 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 18:58:11,486 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 18:58:13,630 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-11 18:58:13,837 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-11 18:58:15,923 - utils.data_manager - INFO - Successfully loaded 59 user details from database
2025-09-11 18:58:16,140 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 18:58:16,141 - services.payment_service - INFO - PaymentService initialized
2025-09-11 18:58:16,141 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 18:58:16,671 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 18:58:16,671 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 18:58:17,099 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 18:58:17,099 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 18:58:17,099 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 18:58:17,099 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 18:58:17,100 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 18:58:18,908 - utils.data_manager - DEBUG - customers_note column already exists in whatsapp_orders table.
2025-09-11 18:58:19,120 - utils.data_manager - DEBUG - service_charge column already exists in whatsapp_orders table.
2025-09-11 18:58:21,199 - utils.data_manager - INFO - Successfully loaded 59 user details from database
2025-09-11 18:58:21,409 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 18:58:21,409 - services.payment_service - INFO - PaymentService initialized
2025-09-11 18:58:21,410 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 18:58:21,410 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 18:58:21,411 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 18:58:21,411 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 18:58:21,441 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 18:58:21,441 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 18:59:25,250 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-11 18:59:25,251 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 18:59:25,251 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-11 18:59:25,251 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-11 18:59:25,252 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 18:59:26,846 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjU2NTc0QTVGRkU0MEQ1OUJCRAA="}]}
2025-09-11 18:59:26,847 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 18:59:27,751 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIyNERBMTM2RkE0RDVBRDBCOAA="}]}
2025-09-11 18:59:27,752 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIyNERBMTM2RkE0RDVBRDBCOAA='}]}
2025-09-11 18:59:27,754 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 18:59:27] "POST /webhook HTTP/1.1" 200 -
2025-09-11 18:59:28,667 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 18:59:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 18:59:29,800 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 18:59:29] "POST /webhook HTTP/1.1" 200 -
2025-09-11 18:59:29,814 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 18:59:29] "POST /webhook HTTP/1.1" 200 -
2025-09-11 18:59:30,095 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 18:59:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 18:59:34,755 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 18:59:34] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:00:20,846 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hi'}
2025-09-11 19:00:20,847 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-09-11 19:00:20,847 - message_processor - INFO - Session 2347082345056: Global command 'hi' detected. Going to AI chat.
2025-09-11 19:00:20,847 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke' with message 'Hi'.
2025-09-11 19:00:20,848 - services.whatsapp_service - DEBUG - Created image message payload for 2347082345056
2025-09-11 19:00:21,889 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkE0RDlFNzY5NUQ1RkI4RkJGNwA="}]}
2025-09-11 19:00:21,890 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-11 19:00:22,956 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRDOUMwRjNFQjM2RDM0NUJGMwA="}]}
2025-09-11 19:00:22,957 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkRDOUMwRjNFQjM2RDM0NUJGMwA='}]}
2025-09-11 19:00:22,958 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:00:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:00:24,570 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:00:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:00:24,658 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:00:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:00:25,288 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:00:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:00:52,700 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:00:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:01:11,281 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Who is speaking please'}
2025-09-11 19:01:11,282 - handlers.base_handler - INFO - AIHandler: Handling message 'who is speaking please' in AI chat state for session 2347082345056. Original: 'Who is speaking please'
2025-09-11 19:01:13,530 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 19:01:13,539 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-11 19:01:14,449 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZBMDA1N0IyRDU0MjNDQTI0NgA="}]}
2025-09-11 19:01:14,450 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkZBMDA1N0IyRDU0MjNDQTI0NgA='}]}
2025-09-11 19:01:14,451 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:01:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:01:15,581 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:01:15] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:01:16,057 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:01:16] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:01:16,657 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:01:16] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:02:31,712 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'How can I join the waitlist'}
2025-09-11 19:02:31,713 - handlers.base_handler - INFO - AIHandler: Handling message 'how can i join the waitlist' in AI chat state for session 2347082345056. Original: 'How can I join the waitlist'
2025-09-11 19:02:34,570 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 19:02:34,571 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-11 19:02:36,184 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjY3NEIzOTQ0QzE5NTEzRjUwRgA="}]}
2025-09-11 19:02:36,187 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjY3NEIzOTQ0QzE5NTEzRjUwRgA='}]}
2025-09-11 19:02:36,189 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:02:36] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:02:37,191 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:02:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:02:37,891 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:02:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:02:38,265 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:02:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:02:53,979 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:02:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:04:35,665 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:04:35] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:05:56,754 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:05:56] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:07:16,086 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:07:16] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:08:41,077 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:08:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:08:41,692 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:08:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:10:26,118 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:10:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:10:45,114 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:10:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:10:54,116 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:10:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:14:26,347 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:14:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:20:07,843 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:20:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:25:17,851 - handlers.webhook_handler - INFO - Processing message from 2349038133656 (User: Shugar): {'type': 'text', 'text': 'Thank you'}
2025-09-11 19:25:17,852 - utils.session_manager - INFO - New session 2349038133656 initialized.
2025-09-11 19:25:17,852 - message_processor - INFO - Session 2349038133656: New session detected. Starting AI chat.
2025-09-11 19:25:17,852 - message_processor - INFO - Session 2349038133656: Starting AI chat for user 'Shugar' with message 'Thank you'.
2025-09-11 19:25:17,853 - services.whatsapp_service - DEBUG - Created image message payload for 2349038133656
2025-09-11 19:25:19,237 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038133656","wa_id":"2349038133656"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODEzMzY1NhUCABEYEkU0MTVFMDg1NDdERjJGMzc5OQA="}]}
2025-09-11 19:25:20,603 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 19:25:20,604 - services.whatsapp_service - DEBUG - Created text message payload for 2349038133656
2025-09-11 19:25:21,627 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:25:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:25:21,645 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038133656","wa_id":"2349038133656"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODEzMzY1NhUCABEYEjBGRjQ4NkI3NDJGQzM3M0ExQQA="}]}
2025-09-11 19:25:21,647 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349038133656', 'wa_id': '2349038133656'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzODEzMzY1NhUCABEYEjBGRjQ4NkI3NDJGQzM3M0ExQQA='}]}
2025-09-11 19:25:21,647 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:25:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:25:25,333 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:25:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:25:32,741 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:25:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:25:33,324 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:25:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:27:57,500 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:27:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:29:20,105 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:29:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:34:28,460 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Who am i speaking to?'}
2025-09-11 19:34:28,461 - handlers.base_handler - INFO - AIHandler: Handling message 'who am i speaking to?' in AI chat state for session 2348055614455. Original: 'Who am i speaking to?'
2025-09-11 19:34:29,937 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 19:34:29,938 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 19:34:31,219 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk2NTY4MTM5MkM3QTI3QTY5MQA="}]}
2025-09-11 19:34:31,220 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk2NTY4MTM5MkM3QTI3QTY5MQA='}]}
2025-09-11 19:34:31,221 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:34:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:34:32,284 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:34:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:34:33,014 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:34:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:34:33,107 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:34:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:34:40,430 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:34:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:37:22,994 - utils.session_manager - INFO - New session 2348085485565 initialized.
2025-09-11 19:37:22,994 - message_processor - INFO - Session 2348085485565: New session detected. Starting AI chat.
2025-09-11 19:37:22,998 - services.whatsapp_service - DEBUG - Created image message payload for 2348085485565
2025-09-11 19:37:23,379 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:37:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:37:24,254 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348085485565","wa_id":"2348085485565"}],"messages":[{"id":"wamid.HBgNMjM0ODA4NTQ4NTU2NRUCABEYEkU4M0M3REI5MkUwRDgzRTVGNwA="}]}
2025-09-11 19:37:25,875 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 19:37:25,876 - services.whatsapp_service - DEBUG - Created text message payload for 2348085485565
2025-09-11 19:37:26,906 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348085485565","wa_id":"2348085485565"}],"messages":[{"id":"wamid.HBgNMjM0ODA4NTQ4NTU2NRUCABEYEjRFOTIwQzFENUU2MjUwRUVDOQA="}]}
2025-09-11 19:37:26,907 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348085485565', 'wa_id': '2348085485565'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA4NTQ4NTU2NRUCABEYEjRFOTIwQzFENUU2MjUwRUVDOQA='}]}
2025-09-11 19:37:26,909 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:37:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:37:27,595 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:37:27] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:37:27,934 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:37:27] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:37:30,511 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:37:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:40:28,043 - utils.session_manager - INFO - New session 2349035397603 initialized.
2025-09-11 19:40:28,049 - message_processor - INFO - Session 2349035397603: New session detected. Starting AI chat.
2025-09-11 19:40:28,060 - services.whatsapp_service - DEBUG - Created image message payload for 2349035397603
2025-09-11 19:40:30,750 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349035397603","wa_id":"2349035397603"}],"messages":[{"id":"wamid.HBgNMjM0OTAzNTM5NzYwMxUCABEYEkE0NEFGODlDRkI1RUJBNjNCOAA="}]}
2025-09-11 19:40:32,461 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 19:40:32,462 - services.whatsapp_service - DEBUG - Created text message payload for 2349035397603
2025-09-11 19:40:33,488 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:40:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:40:34,032 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349035397603","wa_id":"2349035397603"}],"messages":[{"id":"wamid.HBgNMjM0OTAzNTM5NzYwMxUCABEYEkU2RjBEQjMyMjU2MzdFNUY1OAA="}]}
2025-09-11 19:40:34,033 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349035397603', 'wa_id': '2349035397603'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzNTM5NzYwMxUCABEYEkU2RjBEQjMyMjU2MzdFNUY1OAA='}]}
2025-09-11 19:40:34,034 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:40:34] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:40:38,992 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:40:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:40:58,829 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:40:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:40:59,423 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348150557526. Message type: reaction
2025-09-11 19:40:59,423 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:40:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:41:11,926 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:41:11] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:41:12,527 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:41:12] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:41:13,185 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:41:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:41:56,177 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:41:56] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:42:20,482 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:42:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:42:23,248 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:42:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:43:08,018 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:43:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:43:25,575 - utils.session_manager - INFO - New session 2348084838908 initialized.
2025-09-11 19:43:25,578 - message_processor - INFO - Session 2348084838908: New session detected. Starting AI chat.
2025-09-11 19:43:25,597 - services.whatsapp_service - DEBUG - Created image message payload for 2348084838908
2025-09-11 19:43:26,866 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348084838908","wa_id":"2348084838908"}],"messages":[{"id":"wamid.HBgNMjM0ODA4NDgzODkwOBUCABEYEjYyRDBCMTUyNDhBMjk0OUIwRQA="}]}
2025-09-11 19:43:27,564 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:43:27] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:43:28,204 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 19:43:28,204 - services.whatsapp_service - DEBUG - Created text message payload for 2348084838908
2025-09-11 19:43:29,272 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348084838908","wa_id":"2348084838908"}],"messages":[{"id":"wamid.HBgNMjM0ODA4NDgzODkwOBUCABEYEjlDM0UyOERDQUUyRDVDN0IyNgA="}]}
2025-09-11 19:43:29,273 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348084838908', 'wa_id': '2348084838908'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA4NDgzODkwOBUCABEYEjlDM0UyOERDQUUyRDVDN0IyNgA='}]}
2025-09-11 19:43:29,274 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:43:29] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:43:33,429 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:43:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:44:42,281 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:44:42] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:45:40,979 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:45:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:45:41,794 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:45:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:48:26,334 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:48:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:52:15,732 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:52:15] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:52:29,830 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:52:29] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:54:08,417 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:54:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:54:28,020 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:54:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:54:56,091 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:54:56] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:54:57,066 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:54:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:57:59,428 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:57:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:58:00,015 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:58:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 19:59:28,619 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 19:59:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:02:39,310 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:02:39] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:02:45,481 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:02:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:02:45,972 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:02:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:03:22,271 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:03:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:03:22,897 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:03:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:03:55,096 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:03:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:04:04,579 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:04:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:04:05,343 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:04:05] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:05:15,346 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:05:15] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:05:56,245 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:05:56] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:06:34,710 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:06:34] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:06:35,773 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:06:35] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:09:51,569 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:09:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:09:52,188 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:09:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:16:47,312 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:16:47] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:17:45,812 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:17:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:17:46,635 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:17:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:17:47,258 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:17:47] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:17:51,192 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:17:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:19:12,825 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:19:12] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:20:36,601 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:20:36] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:20:37,159 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348153854661. Message type: reaction
2025-09-11 20:20:37,160 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:20:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:21:26,277 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:21:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:21:28,125 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:21:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:21:58,095 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:21:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:21:58,666 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:21:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:22:55,510 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:22:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:23:37,381 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:23:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:28:00,365 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:28:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:32:38,115 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:32:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:32:38,661 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:32:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:32:46,030 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:32:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:33:53,190 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:33:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:35:38,895 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348024457300. Message type: reaction
2025-09-11 20:35:38,895 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:35:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:35:39,701 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:35:39] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:36:59,743 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:36:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:37:00,664 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:37:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:40:38,943 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:40:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:40:55,975 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:40:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:41:08,602 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:41:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:41:21,221 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:41:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:41:23,915 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:41:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:41:51,905 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:41:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:41:54,475 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:41:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:42:47,819 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:42:47] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:43:13,889 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348134156853. Message type: reaction
2025-09-11 20:43:13,890 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:43:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:50:44,446 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:50:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:52:22,818 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:52:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:52:26,337 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:52:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:52:44,838 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:52:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:52:59,605 - handlers.webhook_handler - WARNING - No valid message data extracted for 2349029765123. Message type: reaction
2025-09-11 20:52:59,606 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:52:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:55:25,863 - utils.session_manager - INFO - New session 2348106312187 initialized.
2025-09-11 20:55:25,866 - message_processor - INFO - Session 2348106312187: Global command 'hi' detected. Going to AI chat.
2025-09-11 20:55:25,874 - services.whatsapp_service - DEBUG - Created image message payload for 2348106312187
2025-09-11 20:55:27,090 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348106312187","wa_id":"2348106312187"}],"messages":[{"id":"wamid.HBgNMjM0ODEwNjMxMjE4NxUCABEYEkIzMDJERjI5Qjk2N0FEM0M3NAA="}]}
2025-09-11 20:55:27,092 - services.whatsapp_service - DEBUG - Created text message payload for 2348106312187
2025-09-11 20:55:28,700 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348106312187","wa_id":"2348106312187"}],"messages":[{"id":"wamid.HBgNMjM0ODEwNjMxMjE4NxUCABEYEjVEMDY1MDZCMkQ5QUFGMTc0MwA="}]}
2025-09-11 20:55:28,703 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348106312187', 'wa_id': '2348106312187'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEwNjMxMjE4NxUCABEYEjVEMDY1MDZCMkQ5QUFGMTc0MwA='}]}
2025-09-11 20:55:28,704 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:55:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:55:30,251 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:55:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 20:55:31,116 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 20:55:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:01:21,006 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:01:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:01:36,292 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:01:36] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:03:45,794 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:03:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:05:50,850 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:05:50] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:07:51,231 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:07:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:08:15,109 - utils.session_manager - INFO - New session 2349064827316 initialized.
2025-09-11 21:08:15,110 - message_processor - INFO - Session 2349064827316: New session detected. Starting AI chat.
2025-09-11 21:08:15,116 - services.whatsapp_service - DEBUG - Created image message payload for 2349064827316
2025-09-11 21:08:16,301 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349064827316","wa_id":"2349064827316"}],"messages":[{"id":"wamid.HBgNMjM0OTA2NDgyNzMxNhUCABEYEkVDMUM2NTAxMTc3MUZDNTVEQQA="}]}
2025-09-11 21:08:17,974 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:08:17,977 - services.whatsapp_service - DEBUG - Created text message payload for 2349064827316
2025-09-11 21:08:19,351 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349064827316","wa_id":"2349064827316"}],"messages":[{"id":"wamid.HBgNMjM0OTA2NDgyNzMxNhUCABEYEkE0ODgwNjQwRUFDMDFCNjU4NAA="}]}
2025-09-11 21:08:19,364 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349064827316', 'wa_id': '2349064827316'}], 'messages': [{'id': 'wamid.HBgNMjM0OTA2NDgyNzMxNhUCABEYEkE0ODgwNjQwRUFDMDFCNjU4NAA='}]}
2025-09-11 21:08:19,366 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:08:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:08:19,662 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:08:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:08:22,136 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:08:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:08:22,433 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:08:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:08:23,321 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:08:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:09:44,220 - handlers.webhook_handler - WARNING - No valid message data extracted for 2349161342900. Message type: reaction
2025-09-11 21:09:44,221 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:09:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:09:44,783 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:09:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:10:54,278 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:10:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:16:19,437 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:16:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:16:40,534 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:16:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:16:41,118 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:16:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:17:23,027 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:17:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:20:17,838 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:20:17] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:22:11,286 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:22:11,548 - __main__ - ERROR - Import error: cannot import name 'DataManager' from 'utils.data_manager' (C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py)
2025-09-11 21:23:52,897 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:23:54,444 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:23:54,447 - app - ERROR - Error initializing core services: DataManager.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\app.py", line 40, in <module>
    data_manager = DataManager(config)
TypeError: DataManager.__init__() takes 1 positional argument but 2 were given
2025-09-11 21:25:19,487 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:25:20,828 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:25:22,362 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:25:23,469 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:25:23,470 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:25:23,471 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:25:23,472 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 21:25:24,160 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:25:24,160 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:25:24,735 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:25:24,735 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:25:24,736 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 21:25:24,736 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 21:25:24,736 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:25:27,449 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:25:28,450 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:25:28,450 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:25:28,451 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:25:28,451 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 21:25:28,452 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 21:25:28,452 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 21:25:28,452 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 21:25:28,489 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 21:25:28,490 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 21:26:45,325 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-11 21:26:45,326 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 21:26:45,327 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-11 21:26:45,327 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-11 21:26:45,328 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 21:26:46,844 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0MDFGNzQxMEVGMUU3RDcwRgA="}]}
2025-09-11 21:26:46,846 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:26:47,941 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ1RjNEMzBFQzY2Q0I1OURENwA="}]}
2025-09-11 21:26:47,943 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ1RjNEMzBFQzY2Q0I1OURENwA='}]}
2025-09-11 21:26:47,945 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:26:47] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:26:48,291 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:26:48] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:26:49,094 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:26:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:26:49,647 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:26:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:26:49,804 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:26:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:27:19,669 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:27:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:27:20,212 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:27:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:30:33,774 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:30:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:30:34,615 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:30:34] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:30:58,902 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:30:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:32:35,834 - handlers.webhook_handler - INFO - Processing message from 2349135867423 (User: Temiloluwa Ayorinde): {'type': 'text', 'text': 'Thank you very much Eventio Africa team.'}
2025-09-11 21:32:35,834 - utils.session_manager - INFO - New session 2349135867423 initialized.
2025-09-11 21:32:35,834 - message_processor - INFO - Session 2349135867423: New session detected. Starting AI chat.
2025-09-11 21:32:35,835 - message_processor - INFO - Session 2349135867423: Starting AI chat for user 'Temiloluwa Ayorinde' with message 'Thank you very much Eventio Africa team.'.
2025-09-11 21:32:35,839 - services.whatsapp_service - DEBUG - Created image message payload for 2349135867423
2025-09-11 21:32:37,097 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349135867423","wa_id":"2349135867423"}],"messages":[{"id":"wamid.HBgNMjM0OTEzNTg2NzQyMxUCABEYEkFGREZBMTEzNTUwNDdFNjNCNQA="}]}
2025-09-11 21:32:38,639 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:32:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:32:39,685 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:32:39,691 - services.whatsapp_service - DEBUG - Created text message payload for 2349135867423
2025-09-11 21:32:40,653 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349135867423","wa_id":"2349135867423"}],"messages":[{"id":"wamid.HBgNMjM0OTEzNTg2NzQyMxUCABEYEkM2QTA5QzY4NDY0OTc1MUNDMgA="}]}
2025-09-11 21:32:40,654 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349135867423', 'wa_id': '2349135867423'}], 'messages': [{'id': 'wamid.HBgNMjM0OTEzNTg2NzQyMxUCABEYEkM2QTA5QzY4NDY0OTc1MUNDMgA='}]}
2025-09-11 21:32:40,655 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:32:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:32:43,141 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:32:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:33:51,238 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:33:51,239 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:33:54,125 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:33:55,717 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:33:57,166 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:33:58,234 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:33:58,234 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:33:58,235 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:33:58,235 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 21:33:58,698 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:33:58,698 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:33:59,068 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:33:59,068 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:33:59,068 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 21:33:59,069 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 21:33:59,069 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:34:00,354 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:34:01,417 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:34:01,417 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:34:01,418 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:34:01,418 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 21:34:01,419 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 21:34:01,419 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 21:34:01,420 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 21:34:01,444 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 21:34:01,444 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 21:34:06,195 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello do you deliver to abuja'}
2025-09-11 21:34:06,196 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 21:34:06,196 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-11 21:34:06,197 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello do you deliver to abuja'.
2025-09-11 21:34:06,197 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 21:34:07,477 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFGNEUxNkZCQzQyOTJFRUMxRQA="}]}
2025-09-11 21:34:07,894 - utils.data_manager - ERROR - Error saving conversation: value too long for type character varying(20)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 109, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(20)

2025-09-11 21:34:08,120 - message_processor - ERROR - Session 2348055614455: Error in message routing: value too long for type character varying(20)
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 87, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 119, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\handlers\ai_handler.py", line 76, in _handle_ai_chat_start
    self.data_manager.save_conversation(phone_number, session_id, user_message or "initial_greeting", prompt_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 109, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.StringDataRightTruncation: value too long for type character varying(20)

  2025-09-11 21:34:08,125 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello do you deliver to abuja'.
  2025-09-11 21:34:08,553 - utils.data_manager - ERROR - Error saving conversation: value too long for type character varying(20)
  Traceback (most recent call last):
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 87, in _route_to_handler
      return self._start_ai_chat(state, session_id, user_name, original_message)
            ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 119, in _start_ai_chat
      return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\handlers\ai_handler.py", line 76, in _handle_ai_chat_start
      self.data_manager.save_conversation(phone_number, session_id, user_message or "initial_greeting", prompt_message)
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 109, in save_conversation
      cur.execute("""
      ~~~~~~~~~~~^^^^
          INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          VALUES (%s, %s, %s, %s, %s)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
      """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  psycopg2.errors.StringDataRightTruncation: value too long for type character varying(20)


  During handling of the above exception, another exception occurred:

  Traceback (most recent call last):
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 109, in save_conversation
      cur.execute("""
      ~~~~~~~~~~~^^^^
          INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          VALUES (%s, %s, %s, %s, %s)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
      """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  psycopg2.errors.StringDataRightTruncation: value too long for type character varying(20)

  2025-09-11 21:34:08,685 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:34:08] "POST /webhook HTTP/1.1" 200 -
  2025-09-11 21:34:08,772 - message_processor - ERROR - Session 2348055614455: Error processing message: value too long for type character varying(20)
  Traceback (most recent call last):
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 87, in _route_to_handler
      return self._start_ai_chat(state, session_id, user_name, original_message)
            ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 119, in _start_ai_chat
      return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\handlers\ai_handler.py", line 76, in _handle_ai_chat_start
      self.data_manager.save_conversation(phone_number, session_id, user_message or "initial_greeting", prompt_message)
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 109, in save_conversation
      cur.execute("""
      ~~~~~~~~~~~^^^^
          INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          VALUES (%s, %s, %s, %s, %s)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
      """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  psycopg2.errors.StringDataRightTruncation: value too long for type character varying(20)


  During handling of the above exception, another exception occurred:

  Traceback (most recent call last):
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 46, in process_message
      response = self._route_to_handler(state, message, original_message, session_id, user_name)
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 109, in _route_to_handler
      return self._start_ai_chat(state, session_id, user_name, original_message)
            ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 119, in _start_ai_chat
      return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\handlers\ai_handler.py", line 76, in _handle_ai_chat_start
      self.data_manager.save_conversation(phone_number, session_id, user_message or "initial_greeting", prompt_message)
      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 109, in save_conversation
      cur.execute("""
      ~~~~~~~~~~~^^^^
          INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
          VALUES (%s, %s, %s, %s, %s)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
      """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  psycopg2.errors.StringDataRightTruncation: value too long for type character varying(20)

  2025-09-11 21:34:08,785 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
  2025-09-11 21:34:09,917 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0MDVCN0U5NkVBQjU5NDQ2OQA="}]}
  2025-09-11 21:34:09,918 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQ0MDVCN0U5NkVBQjU5NDQ2OQA='}]}
  2025-09-11 21:34:09,919 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:34:09] "POST /webhook HTTP/1.1" 200 -
  2025-09-11 21:34:11,462 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:34:11] "POST /webhook HTTP/1.1" 200 -
  2025-09-11 21:34:11,585 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:34:11] "POST /webhook HTTP/1.1" 200 -
  2025-09-11 21:34:12,071 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:34:12] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:35:30,252 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:35:30,253 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:35:32,056 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:35:33,366 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:35:34,784 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:35:36,234 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:35:36,234 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:35:36,235 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:35:36,235 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 21:35:36,696 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:35:36,696 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:35:37,113 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:35:37,113 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:35:37,114 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 21:35:37,114 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 21:35:37,114 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:35:38,466 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:35:39,907 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:35:39,908 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:35:39,908 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:35:39,909 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 21:35:39,909 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 21:35:39,910 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 21:35:39,910 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 21:35:39,925 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 21:35:39,926 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 21:35:48,497 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'hello do you delivery to abuja'}
2025-09-11 21:35:48,498 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 21:35:48,498 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-11 21:35:48,498 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'hello do you delivery to abuja'.
2025-09-11 21:35:48,499 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 21:35:49,623 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjgyMTRCREQ1NTVFQUQ5NzQ1NgA="}]}
2025-09-11 21:35:49,624 - utils.data_manager - WARNING - Truncated phone_number from 'hello do you delivery to abuja' to 'hello do you deliver' (max length: 20)
2025-09-11 21:35:50,271 - utils.data_manager - INFO - Saved conversation for phone_number: hello do you deliver, session_id: 2348055614455
2025-09-11 21:35:50,272 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:35:50,647 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:35:50] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:35:52,046 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBNjFBMTIyMkMxRkEzMEFCOQA="}]}
2025-09-11 21:35:52,047 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjZBNjFBMTIyMkMxRkEzMEFCOQA='}]}
2025-09-11 21:35:52,048 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:35:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:35:53,373 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:35:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:35:53,727 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:35:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:35:54,488 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:35:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:01,304 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you deliver to abuja'}
2025-09-11 21:36:01,305 - message_processor - ERROR - Session 2348055614455: Error in message routing: AIHandler.handle_ai_chat_state() missing 1 required positional argument: 'phone_number'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 92, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: AIHandler.handle_ai_chat_state() missing 1 required positional argument: 'phone_number'
2025-09-11 21:36:01,306 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Do you deliver to abuja'.
2025-09-11 21:36:01,307 - utils.data_manager - WARNING - Truncated phone_number from 'Do you deliver to abuja' to 'Do you deliver to ab' (max length: 20)
2025-09-11 21:36:01,952 - utils.data_manager - INFO - Saved conversation for phone_number: Do you deliver to ab, session_id: 2348055614455
2025-09-11 21:36:01,953 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:36:01,954 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'What would you like to know about our wallpapers and interior solutions?'}}
2025-09-11 21:36:03,188 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGNzdFNzczRkQ1NjY0RUUxOQA="}]}
2025-09-11 21:36:03,189 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNGNzdFNzczRkQ1NjY0RUUxOQA='}]}
2025-09-11 21:36:03,190 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:03] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:04,266 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:04,896 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:04,907 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:22,314 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you delivery to abuja'}
2025-09-11 21:36:22,314 - message_processor - ERROR - Session 2348055614455: Error in message routing: AIHandler.handle_ai_chat_state() missing 1 required positional argument: 'phone_number'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 92, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: AIHandler.handle_ai_chat_state() missing 1 required positional argument: 'phone_number'
2025-09-11 21:36:22,315 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Do you delivery to abuja'.
2025-09-11 21:36:22,316 - utils.data_manager - WARNING - Truncated phone_number from 'Do you delivery to abuja' to 'Do you delivery to a' (max length: 20)
2025-09-11 21:36:22,955 - utils.data_manager - INFO - Saved conversation for phone_number: Do you delivery to a, session_id: 2348055614455
2025-09-11 21:36:22,955 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:36:22,956 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'What would you like to know about our wallpapers and interior solutions?'}}
2025-09-11 21:36:24,115 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczNDZBRDQ5MDU3ODE5RjY4QQA="}]}
2025-09-11 21:36:24,116 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczNDZBRDQ5MDU3ODE5RjY4QQA='}]}
2025-09-11 21:36:24,116 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:25,360 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:25,709 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:36:25,779 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:36:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:39:47,976 - utils.session_manager - INFO - New session 2349051843994 initialized.
2025-09-11 21:39:47,977 - message_processor - INFO - Session 2349051843994: New session detected. Starting AI chat.
2025-09-11 21:39:47,984 - services.whatsapp_service - DEBUG - Created image message payload for 2349051843994
2025-09-11 21:39:49,376 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349051843994","wa_id":"2349051843994"}],"messages":[{"id":"wamid.HBgNMjM0OTA1MTg0Mzk5NBUCABEYEjI4NTA1QzFGOEYyQjM2NTFFRAA="}]}
2025-09-11 21:39:50,002 - utils.data_manager - INFO - Saved conversation for phone_number: Thank you so much!, session_id: 2349051843994
2025-09-11 21:39:50,003 - services.whatsapp_service - DEBUG - Created text message payload for 2349051843994
2025-09-11 21:39:50,969 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:39:50] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:39:51,017 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349051843994","wa_id":"2349051843994"}],"messages":[{"id":"wamid.HBgNMjM0OTA1MTg0Mzk5NBUCABEYEkZEMUE5REIyRjYzQjE3NEQxRQA="}]}
2025-09-11 21:39:51,019 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349051843994', 'wa_id': '2349051843994'}], 'messages': [{'id': 'wamid.HBgNMjM0OTA1MTg0Mzk5NBUCABEYEkZEMUE5REIyRjYzQjE3NEQxRQA='}]}
2025-09-11 21:39:51,020 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:39:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:39:51,827 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:39:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:39:52,657 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:39:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:39:53,466 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:39:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:39:54,529 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:39:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:40:37,086 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:40:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:40:59,146 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:40:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:40:59,749 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:40:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:41:07,873 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:41:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:18,065 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:18,658 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:19,198 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:25,673 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:36,918 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:36] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:37,893 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:46,569 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:51,054 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:55,157 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:43:55,318 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:43:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:44:08,695 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:44:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:44:35,018 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:44:35] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:45:00,302 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:45:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:45:01,099 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:45:01] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:45:09,538 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:45:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:45:53,907 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:45:53,909 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:45:57,193 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:45:58,858 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:46:00,677 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:46:02,317 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:46:02,318 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:46:02,318 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:46:02,318 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 21:46:02,759 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:46:02,759 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:46:03,109 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:46:03,109 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:46:03,110 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 21:46:03,110 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 21:46:03,110 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:46:04,376 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:46:05,767 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:46:05,768 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:46:05,768 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:46:05,769 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 21:46:05,770 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 21:46:05,770 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 21:46:05,770 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 21:46:05,792 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 21:46:05,793 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 21:46:08,919 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-11 21:46:08,920 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 21:46:08,922 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-11 21:46:08,924 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-11 21:46:08,925 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 21:46:10,288 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNDNkU5ODgyNDdGNTZGMTM2OQA="}]}
2025-09-11 21:46:11,028 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:46:11,028 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:46:11,423 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:11] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:12,140 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE3M0NDODBCNEY4MTYwRENFOAA="}]}
2025-09-11 21:46:12,141 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE3M0NDODBCNEY4MTYwRENFOAA='}]}
2025-09-11 21:46:12,142 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:12] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:13,279 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:13,730 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:13,749 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:17,926 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:17] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:18,640 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you deliver to abuja?'}
2025-09-11 21:46:18,641 - handlers.base_handler - INFO - AIHandler: Handling message 'do you deliver to abuja?' in AI chat state for session 2348055614455. Original: 'Do you deliver to abuja?'
2025-09-11 21:46:21,039 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:46:21,747 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:46:21,748 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:46:22,847 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0QjQyM0UxRUZEMkFFODI1NwA="}]}
2025-09-11 21:46:22,848 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU0QjQyM0UxRUZEMkFFODI1NwA='}]}
2025-09-11 21:46:22,849 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:24,219 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:24,726 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:25,339 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:40,474 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:53,071 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:53,648 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:54,231 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:46:54,798 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:46:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:47:03,036 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:47:03] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:47:06,659 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:47:06] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:47:28,783 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want join the waitlist'}
2025-09-11 21:47:28,783 - handlers.base_handler - INFO - AIHandler: Handling message 'i want join the waitlist' in AI chat state for session 2348055614455. Original: 'I want join the waitlist'
2025-09-11 21:47:29,497 - utils.data_manager - INFO - Added to waitlist: phone_number=2348055614455
2025-09-11 21:47:30,167 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:47:30,168 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:47:31,318 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCNjQxMUJCMjA3MkQwQkRGMwA="}]}
2025-09-11 21:47:31,319 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCNjQxMUJCMjA3MkQwQkRGMwA='}]}
2025-09-11 21:47:31,319 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:47:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:47:32,470 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:47:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:47:32,941 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:47:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:47:33,279 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:47:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:47:41,435 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:47:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:48:06,605 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:48:06] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:48:07,421 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:48:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:48:19,672 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:48:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:48:20,278 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:48:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:48:20,952 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:48:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:48:21,572 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:48:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:48:58,838 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:48:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:50:01,760 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:50:01] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:50:12,078 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:50:12] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:50:12,441 - handlers.webhook_handler - INFO - Processing message from 2349126213114 (User: Horluwakhemy): {'type': 'text', 'text': 'Thank you for contacting Horluwakhemy! Please let us know how we can help you.'}
2025-09-11 21:50:12,441 - utils.session_manager - INFO - New session 2349126213114 initialized.
2025-09-11 21:50:12,441 - message_processor - INFO - Session 2349126213114: New session detected. Starting AI chat.
2025-09-11 21:50:12,441 - message_processor - INFO - Session 2349126213114: Starting AI chat for user 'Horluwakhemy' with message 'Thank you for contacting Horluwakhemy! Please let us know how we can help you.'.
2025-09-11 21:50:12,442 - services.whatsapp_service - DEBUG - Created image message payload for 2349126213114
2025-09-11 21:50:13,679 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349126213114","wa_id":"2349126213114"}],"messages":[{"id":"wamid.HBgNMjM0OTEyNjIxMzExNBUCABEYEkFCMUNEOEIxMUZEMUY1NDFBRgA="}]}
2025-09-11 21:50:14,801 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:50:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:50:15,081 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:50:15,768 - utils.data_manager - INFO - Saved conversation for phone_number: 2349126213114, session_id: 2349126213114
2025-09-11 21:50:15,768 - services.whatsapp_service - DEBUG - Created text message payload for 2349126213114
2025-09-11 21:50:16,779 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349126213114","wa_id":"2349126213114"}],"messages":[{"id":"wamid.HBgNMjM0OTEyNjIxMzExNBUCABEYEkU1ODc4QzNBRjEwNDMyM0M0MAA="}]}
2025-09-11 21:50:16,780 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349126213114', 'wa_id': '2349126213114'}], 'messages': [{'id': 'wamid.HBgNMjM0OTEyNjIxMzExNBUCABEYEkU1ODc4QzNBRjEwNDMyM0M0MAA='}]}
2025-09-11 21:50:16,781 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:50:16] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:50:19,705 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:50:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:50:21,814 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:50:21,814 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:50:54,959 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:50:56,210 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:50:57,689 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:50:59,228 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:50:59,228 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:50:59,229 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:50:59,229 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 21:50:59,612 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:50:59,612 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:50:59,996 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:50:59,997 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:50:59,997 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 21:50:59,997 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 21:50:59,998 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:51:01,519 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:51:03,169 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:51:03,169 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:51:03,170 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:51:03,170 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 21:51:03,170 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 21:51:03,171 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 21:51:03,171 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 21:51:03,188 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 21:51:03,189 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 21:51:09,629 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:11,894 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello do you deliver to abuja/'}
2025-09-11 21:51:11,895 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 21:51:11,895 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-11 21:51:11,895 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello do you deliver to abuja/'.
2025-09-11 21:51:11,896 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 21:51:13,083 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM3RUYwRThGRjgwMzZEQUE3NAA="}]}
2025-09-11 21:51:13,811 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:15,962 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:51:16,608 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:51:16,609 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:51:18,049 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyQUQ5NEFBM0NEN0JCNzlFRAA="}]}
2025-09-11 21:51:18,049 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQyQUQ5NEFBM0NEN0JCNzlFRAA='}]}
2025-09-11 21:51:18,050 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:19,176 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:19,750 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:19,912 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:29,207 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:29] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:30,011 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:31,043 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you have a waitlist'}
2025-09-11 21:51:31,044 - handlers.base_handler - INFO - AIHandler: Handling message 'do you have a waitlist' in AI chat state for session 2348055614455. Original: 'Do you have a waitlist'
2025-09-11 21:51:33,079 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:51:33,750 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:51:33,751 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:51:34,829 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUzMEFGMzIzNzYxMzkzQzY5NAA="}]}
2025-09-11 21:51:34,830 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUzMEFGMzIzNzYxMzkzQzY5NAA='}]}
2025-09-11 21:51:34,832 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:34] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:36,017 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:36] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:36,310 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:36] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:41,618 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:48,715 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348144423615. Message type: reaction
2025-09-11 21:51:48,716 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:48] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:51,386 - utils.session_manager - INFO - New session 2348106312187 initialized.
2025-09-11 21:51:51,387 - message_processor - INFO - Session 2348106312187: New session detected. Starting AI chat.
2025-09-11 21:51:51,393 - services.whatsapp_service - DEBUG - Created image message payload for 2348106312187
2025-09-11 21:51:52,519 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348106312187","wa_id":"2348106312187"}],"messages":[{"id":"wamid.HBgNMjM0ODEwNjMxMjE4NxUCABEYEjBCODdCQUYyNjQyRTdDNTlENQA="}]}
2025-09-11 21:51:53,729 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:51:53,966 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:54,368 - utils.data_manager - INFO - Saved conversation for phone_number: 2348106312187, session_id: 2348106312187
2025-09-11 21:51:54,369 - services.whatsapp_service - DEBUG - Created text message payload for 2348106312187
2025-09-11 21:51:55,241 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348106312187","wa_id":"2348106312187"}],"messages":[{"id":"wamid.HBgNMjM0ODEwNjMxMjE4NxUCABEYEjA0QzM2QzJEN0U1Q0MzNjQ2NgA="}]}
2025-09-11 21:51:55,241 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348106312187', 'wa_id': '2348106312187'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEwNjMxMjE4NxUCABEYEjA0QzM2QzJEN0U1Q0MzNjQ2NgA='}]}
2025-09-11 21:51:55,242 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:56,174 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:51:56] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:51:58,123 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor Makinde zigamakinde@gmail.com'}
2025-09-11 21:51:58,123 - handlers.base_handler - INFO - AIHandler: Handling message 'victor makinde zigamakinde@gmail.com' in AI chat state for session 2348055614455. Original: 'Victor Makinde zigamakinde@gmail.com'
2025-09-11 21:51:59,729 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:52:00,428 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:52:00,429 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:52:01,519 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1NzAyMEYwNjMyMjNEMEMzNgA="}]}
2025-09-11 21:52:01,521 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc1NzAyMEYwNjMyMjNEMEMzNgA='}]}
2025-09-11 21:52:01,522 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:01] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:02,758 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:02] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:03,229 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:03] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:03,392 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:03] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:32,732 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:41,550 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:57,536 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:58,139 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:52:58,769 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:52:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:53:14,670 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:53:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:53:16,840 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:53:16] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:53:19,274 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:53:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:53:32,922 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:53:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:53:43,683 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:53:43,684 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:55:52,361 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:55:53,509 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:55:55,099 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:55:56,710 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:55:56,711 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:55:56,711 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:55:56,712 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 21:55:57,096 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:55:57,097 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:55:57,465 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:55:57,466 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:55:57,466 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 21:55:57,466 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 21:55:57,467 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:55:58,926 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:56:00,606 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:56:00,607 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:56:00,607 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:56:00,607 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 21:56:00,608 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 21:56:00,608 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 21:56:00,609 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 21:56:00,621 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 21:56:00,621 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 21:56:08,077 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello \nDo you have a waitlist?'}
2025-09-11 21:56:08,077 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 21:56:08,078 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-11 21:56:08,079 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello 
Do you have a waitlist?'.
2025-09-11 21:56:08,079 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 21:56:09,310 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJCQTA2MjFCNDQ1N0IyNjFBQwA="}]}
2025-09-11 21:56:10,211 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:10] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:11,291 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:56:11,979 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:56:11,979 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:56:13,340 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAwN0ExN0E0MjUwMzFGQThGNgA="}]}
2025-09-11 21:56:13,341 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjAwN0ExN0E0MjUwMzFGQThGNgA='}]}
2025-09-11 21:56:13,341 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:14,466 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:14,941 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:26,206 - handlers.webhook_handler - INFO - Processing message from 2348079783121 (User: EniolaBenjamin): {'type': 'text', 'text': 'Thank you'}
2025-09-11 21:56:26,207 - utils.session_manager - INFO - New session 2348079783121 initialized.
2025-09-11 21:56:26,207 - message_processor - INFO - Session 2348079783121: New session detected. Starting AI chat.
2025-09-11 21:56:26,207 - message_processor - INFO - Session 2348079783121: Starting AI chat for user 'EniolaBenjamin' with message 'Thank you'.
2025-09-11 21:56:26,208 - services.whatsapp_service - DEBUG - Created image message payload for 2348079783121
2025-09-11 21:56:27,550 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348079783121","wa_id":"2348079783121"}],"messages":[{"id":"wamid.HBgNMjM0ODA3OTc4MzEyMRUCABEYEjk1REZBODhGMTNFNjc1N0UxMgA="}]}
2025-09-11 21:56:28,556 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:28,851 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:56:29,549 - utils.data_manager - INFO - Saved conversation for phone_number: 2348079783121, session_id: 2348079783121
2025-09-11 21:56:29,550 - services.whatsapp_service - DEBUG - Created text message payload for 2348079783121
2025-09-11 21:56:30,660 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348079783121","wa_id":"2348079783121"}],"messages":[{"id":"wamid.HBgNMjM0ODA3OTc4MzEyMRUCABEYEjNGNkM1QjIxMzgyMkRDN0IwMQA="}]}
2025-09-11 21:56:30,661 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348079783121', 'wa_id': '2348079783121'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA3OTc4MzEyMRUCABEYEjNGNkM1QjIxMzgyMkRDN0IwMQA='}]}
2025-09-11 21:56:30,662 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:30,962 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:31,528 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:33,665 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:41,271 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:46,496 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor Makinde and my email is zigamakinde@gmail.com'}
2025-09-11 21:56:46,496 - handlers.base_handler - INFO - AIHandler: Handling message 'victor makinde and my email is zigamakinde@gmail.com' in AI chat state for session 2348055614455. Original: 'Victor Makinde and my email is zigamakinde@gmail.com'
2025-09-11 21:56:48,215 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:56:48,921 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:56:48,921 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:56:49,952 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2MjI1MkFDN0IzNjY4NjUyRAA="}]}
2025-09-11 21:56:49,953 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU2MjI1MkFDN0IzNjY4NjUyRAA='}]}
2025-09-11 21:56:49,953 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:51,080 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:51,596 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:51,776 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:56:53,113 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:56:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:57:00,038 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:57:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:57:14,950 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:57:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:57:21,329 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:57:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:57:46,590 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:57:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:57:46,832 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:57:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:57:53,738 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:57:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:57:58,869 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:57:58,870 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 21:58:01,973 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 21:58:03,190 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:58:04,720 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:58:06,270 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:58:06,270 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:58:06,271 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:58:06,271 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 21:58:06,672 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:58:06,673 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:58:07,015 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 21:58:07,015 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 21:58:07,016 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 21:58:07,016 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 21:58:07,016 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 21:58:08,400 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 21:58:09,963 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 21:58:09,964 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 21:58:09,965 - services.payment_service - INFO - PaymentService initialized
2025-09-11 21:58:09,965 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 21:58:09,965 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 21:58:09,966 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 21:58:09,966 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 21:58:09,981 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 21:58:09,981 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 21:58:11,721 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello am i in your waitlist'}
2025-09-11 21:58:11,721 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 21:58:11,722 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-11 21:58:11,722 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello am i in your waitlist'.
2025-09-11 21:58:11,723 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 21:58:12,941 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjNCMjNDRjlGQzlBOTgwNDJDOQA="}]}
2025-09-11 21:58:14,063 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:14,912 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:58:15,610 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 21:58:15,610 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 21:58:16,730 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3QTI2NUVBODhERTg3N0FGOAA="}]}
2025-09-11 21:58:16,731 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY3QTI2NUVBODhERTg3N0FGOAA='}]}
2025-09-11 21:58:16,731 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:16] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:18,037 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:18,452 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:18,692 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:43,581 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:45,885 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:46,241 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:58:48,771 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:58:48] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:07,107 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:25,948 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:29,614 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:29] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:30,444 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:31,257 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:31,872 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:37,912 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:38,516 - utils.session_manager - INFO - New session 2347076271085 initialized.
2025-09-11 21:59:38,516 - message_processor - INFO - Session 2347076271085: New session detected. Starting AI chat.
2025-09-11 21:59:38,524 - services.whatsapp_service - DEBUG - Created image message payload for 2347076271085
2025-09-11 21:59:39,761 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347076271085","wa_id":"2347076271085"}],"messages":[{"id":"wamid.HBgNMjM0NzA3NjI3MTA4NRUCABEYEkYxQjg1RDYzMUM5QkZFQzZCRgA="}]}
2025-09-11 21:59:40,644 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:41,210 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 21:59:41,862 - utils.data_manager - INFO - Saved conversation for phone_number: 2347076271085, session_id: 2347076271085
2025-09-11 21:59:41,863 - services.whatsapp_service - DEBUG - Created text message payload for 2347076271085
2025-09-11 21:59:42,300 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:42] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:42,901 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347076271085","wa_id":"2347076271085"}],"messages":[{"id":"wamid.HBgNMjM0NzA3NjI3MTA4NRUCABEYEjA3NjBCREM5NDQ4RTNCQTU0NgA="}]}
2025-09-11 21:59:42,903 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347076271085', 'wa_id': '2347076271085'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA3NjI3MTA4NRUCABEYEjA3NjBCREM5NDQ4RTNCQTU0NgA='}]}
2025-09-11 21:59:42,904 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:42] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:43,561 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:44,202 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 21:59:45,891 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 21:59:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:00:01,220 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:00:01] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:00:01,845 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:00:01] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:00:02,437 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:00:02] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:00:45,098 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:00:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:01:27,114 - handlers.webhook_handler - WARNING - No valid message data extracted for 2349059072739. Message type: reaction
2025-09-11 22:01:27,115 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:01:27] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:01:30,583 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:01:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:02:07,793 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:02:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:02:28,809 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:02:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:02:46,493 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:02:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:02:54,282 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:02:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:02:55,996 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:02:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:03:20,426 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:03:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:03:32,201 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:03:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:00,047 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:19,151 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:19,802 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:24,843 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:29,527 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:04:29,529 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:04:32,486 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:04:34,616 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:04:36,250 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:04:37,910 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:04:37,911 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:04:37,912 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:04:37,913 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:04:38,650 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:04:38,651 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:04:39,257 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:04:39,258 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:04:39,259 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:04:39,259 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:04:39,260 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:04:40,739 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:04:42,260 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:04:42,261 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:04:42,262 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:04:42,263 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:04:42,263 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:04:42,264 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:04:42,264 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:04:42,284 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:04:42,285 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:04:47,912 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello i want to join your waitlist'}
2025-09-11 22:04:47,913 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 22:04:47,914 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-11 22:04:47,914 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello i want to join your waitlist'.
2025-09-11 22:04:47,915 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 22:04:49,179 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkYwN0M2NDM5NTBBMUQ2OTQxOAA="}]}
2025-09-11 22:04:49,871 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:04:49,872 - services.ai_service - INFO - Prompting for missing waitlist info: ['your email address'] for phone_number=2348055614455
2025-09-11 22:04:49,872 - handlers.ai_handler - INFO - Transitioning to waitlist_collection state for 2348055614455: needs email=True, name=False
2025-09-11 22:04:49,873 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:04:49,874 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Great! To complete your waitlist sign-up, please provide your email address.'}}
2025-09-11 22:04:49,978 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:50,972 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QTJERTg2MzcxNjBDN0VBNwA="}]}
2025-09-11 22:04:50,973 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5QTJERTg2MzcxNjBDN0VBNwA='}]}
2025-09-11 22:04:50,974 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:50] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:52,190 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:52,595 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:04:52,774 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:04:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:00,173 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'zigamakinde@gmail.com'}
2025-09-11 22:05:00,174 - message_processor - INFO - Session 2348055614455: Unhandled AI state 'waitlist_collection'. Defaulting to AI chat.
2025-09-11 22:05:00,175 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'zigamakinde@gmail.com'.
2025-09-11 22:05:00,784 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:02,302 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:05:03,012 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:05:03,013 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:05:03,013 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'I see you asked: "zigamakinde@gmail.com"\n\nHere\'s my response:\nHello! How can I assist you today?\n\nI\'m always here if you need more details, just ask anytime!'}}
2025-09-11 22:05:04,013 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg0NkU0QzMxNzVCRjc1MTFCMgA="}]}
2025-09-11 22:05:04,014 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg0NkU0QzMxNzVCRjc1MTFCMgA='}]}
2025-09-11 22:05:04,016 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:04,990 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:05,378 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:05] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:05,697 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:05] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:05,699 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:05] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:08,088 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348114181320. Message type: unsupported
2025-09-11 22:05:08,090 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:26,683 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do you deluver to abuja?'}
2025-09-11 22:05:26,684 - handlers.base_handler - INFO - AIHandler: Handling message 'do you deluver to abuja?' in AI chat state for session 2348055614455. Original: 'Do you deluver to abuja?'
2025-09-11 22:05:28,502 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:05:29,241 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:05:29,242 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:05:29,243 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Yes, we deliver to Abuja! Whether you're in Lagos, Abuja, or anywhere else in Nigeria, we can get our beautiful wallpapers to you. If you have any specific questions about delivery or shipping, feel free to ask!\n\nI'm always here if you need more details, just ask anytime!"}}
2025-09-11 22:05:30,272 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdFNTIyMDY4MTJGNDFCREI3RQA="}]}
2025-09-11 22:05:30,273 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjdFNTIyMDY4MTJGNDFCREI3RQA='}]}
2025-09-11 22:05:30,274 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:31,595 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:31,964 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:32,075 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:39,792 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'i want to join your wailst'}
2025-09-11 22:05:39,792 - handlers.base_handler - INFO - AIHandler: Handling message 'i want to join your wailst' in AI chat state for session 2348055614455. Original: 'i want to join your wailst'
2025-09-11 22:05:41,382 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:05:42,080 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:05:42,081 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:05:42,082 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Great choice! I'd be happy to add you to our waitlist. Could you please provide me with your preferred name and email address so we can keep you updated on special offers and updates?\n\nI'm always here if you need more details, just ask anytime!"}}
2025-09-11 22:05:43,172 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU3Q0NDREUxNDU3QjY2OURDRQA="}]}
2025-09-11 22:05:43,174 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkU3Q0NDREUxNDU3QjY2OURDRQA='}]}
2025-09-11 22:05:43,176 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:44,423 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:45,012 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:45,338 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:05:55,383 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'victor makinde and zigamakinde@gmail.com'}
2025-09-11 22:05:55,384 - handlers.base_handler - INFO - AIHandler: Handling message 'victor makinde and zigamakinde@gmail.com' in AI chat state for session 2348055614455. Original: 'victor makinde and zigamakinde@gmail.com'
2025-09-11 22:05:57,113 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:05:57,814 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:05:57,815 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:05:57,816 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Thank you, Victor Makinde! You've been successfully added to our waitlist with the email zigamakinde@gmail.com. You'll be among the first to know about our latest updates and special offers.\n\nIf you have any other questions or need assistance with anything else, feel free to ask. I'm here to help you!\n\nI'm always here if you need more details, just ask anytime!"}}
2025-09-11 22:05:58,872 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczMERDNjUwNDM5NDQzRTIwRQA="}]}
2025-09-11 22:05:58,874 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczMERDNjUwNDM5NDQzRTIwRQA='}]}
2025-09-11 22:05:58,876 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:05:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:00,135 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:06:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:00,499 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:06:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:00,615 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:06:00] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:14,740 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:06:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:26,680 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:06:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:27,403 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:06:27] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:31,395 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:06:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:06:52,800 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:06:52,802 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:06:55,161 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:06:56,995 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:06:58,691 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:07:00,491 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:07:00,492 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:07:00,493 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:07:00,494 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:07:01,125 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:07:01,126 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:07:01,867 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:07:01,868 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:07:01,868 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:07:01,869 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:07:01,869 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:07:03,391 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:07:05,052 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:07:05,053 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:07:05,055 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:07:05,056 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:07:05,058 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:07:05,060 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:07:05,062 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:07:05,090 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:07:05,090 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:07:05,244 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-11 22:07:05,245 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 22:07:05,245 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-11 22:07:05,246 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-11 22:07:05,246 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 22:07:06,434 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:06] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:06,454 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjIwM0ZERjAyNzE0NkJGNDNBOQA="}]}
2025-09-11 22:07:06,980 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:06] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:07,127 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:07,141 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:07:07,142 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:07:08,833 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyRTRBNDhDMkZFM0FBMkNFQgA="}]}
2025-09-11 22:07:08,836 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkMyRTRBNDhDMkZFM0FBMkNFQgA='}]}
2025-09-11 22:07:08,839 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:09,975 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:10,414 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:10] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:11,427 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:11] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:16,792 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to join yoru wailist'}
2025-09-11 22:07:16,793 - handlers.base_handler - INFO - AIHandler: Handling message 'i want to join yoru wailist' in AI chat state for session 2348055614455. Original: 'I want to join yoru wailist'
2025-09-11 22:07:19,054 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:07:19,741 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:07:19,743 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:07:20,683 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:20,893 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBMTlBQTFCMTVEOTA2QkVGRQA="}]}
2025-09-11 22:07:20,896 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNBMTlBQTFCMTVEOTA2QkVGRQA='}]}
2025-09-11 22:07:20,898 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:21,865 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:22,616 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:22,776 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:07:54,943 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:07:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:09,407 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:22,616 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:23,495 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:44,110 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:44,714 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:51,084 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:52,117 - handlers.webhook_handler - INFO - Processing message from 2349152715386 (User: Peace Of God): {'type': 'text', 'text': 'Thanks so much'}
2025-09-11 22:08:52,119 - utils.session_manager - INFO - New session 2349152715386 initialized.
2025-09-11 22:08:52,120 - message_processor - INFO - Session 2349152715386: New session detected. Starting AI chat.
2025-09-11 22:08:52,121 - message_processor - INFO - Session 2349152715386: Starting AI chat for user 'Peace Of God' with message 'Thanks so much'.
2025-09-11 22:08:52,122 - services.whatsapp_service - DEBUG - Created image message payload for 2349152715386
2025-09-11 22:08:53,253 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349152715386","wa_id":"2349152715386"}],"messages":[{"id":"wamid.HBgNMjM0OTE1MjcxNTM4NhUCABEYEjdCNzc1MkExQjE5ODcwQzQ4OQA="}]}
2025-09-11 22:08:54,397 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:54,654 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:08:55,321 - utils.data_manager - INFO - Saved conversation for phone_number: 2349152715386, session_id: 2349152715386
2025-09-11 22:08:55,325 - services.whatsapp_service - DEBUG - Created text message payload for 2349152715386
2025-09-11 22:08:56,302 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349152715386","wa_id":"2349152715386"}],"messages":[{"id":"wamid.HBgNMjM0OTE1MjcxNTM4NhUCABEYEkEwMzk0NTZDNDNEMjgwOTdBNgA="}]}
2025-09-11 22:08:56,305 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349152715386', 'wa_id': '2349152715386'}], 'messages': [{'id': 'wamid.HBgNMjM0OTE1MjcxNTM4NhUCABEYEkEwMzk0NTZDNDNEMjgwOTdBNgA='}]}
2025-09-11 22:08:56,307 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:56] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:57,123 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:08:58,330 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:08:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:05,803 - handlers.webhook_handler - INFO - Processing message from 2348163753505 (User: Royalcakes-N-Craftempire): {'type': 'text', 'text': 'Thank you for contacting Royalcakes-N-Craftempire! We make giftboxes,gifts curator,cakes,event decor nd props,any event surprise ...cake toppers nd crafts...kindly patronisend refer....\nStrictly business only'}
2025-09-11 22:09:05,804 - utils.session_manager - INFO - New session 2348163753505 initialized.
2025-09-11 22:09:05,805 - message_processor - INFO - Session 2348163753505: New session detected. Starting AI chat.
2025-09-11 22:09:05,805 - message_processor - INFO - Session 2348163753505: Starting AI chat for user 'Royalcakes-N-Craftempire' with message 'Thank you for contacting Royalcakes-N-Craftempire! We make giftboxes,gifts curator,cakes,event decor nd props,any event surprise ...cake toppers nd crafts...kindly patronisend refer....
Strictly business only'.
2025-09-11 22:09:05,806 - services.whatsapp_service - DEBUG - Created image message payload for 2348163753505
2025-09-11 22:09:07,034 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348163753505","wa_id":"2348163753505"}],"messages":[{"id":"wamid.HBgNMjM0ODE2Mzc1MzUwNRUCABEYEjkzQUM0RjUwRDNDMDg4Nzc5MAA="}]}
2025-09-11 22:09:08,161 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:08,964 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:09:09,695 - utils.data_manager - INFO - Saved conversation for phone_number: 2348163753505, session_id: 2348163753505
2025-09-11 22:09:09,696 - services.whatsapp_service - DEBUG - Created text message payload for 2348163753505
2025-09-11 22:09:10,823 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348163753505","wa_id":"2348163753505"}],"messages":[{"id":"wamid.HBgNMjM0ODE2Mzc1MzUwNRUCABEYEjgwRUUxOEREMjhENTBGMzNCRgA="}]}
2025-09-11 22:09:10,826 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348163753505', 'wa_id': '2348163753505'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE2Mzc1MzUwNRUCABEYEjgwRUUxOEREMjhENTBGMzNCRgA='}]}
2025-09-11 22:09:10,828 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:10] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:13,913 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:34,712 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:34] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:41,414 - utils.session_manager - INFO - New session 2348159772015 initialized.
2025-09-11 22:09:41,414 - message_processor - INFO - Session 2348159772015: New session detected. Starting AI chat.
2025-09-11 22:09:41,427 - services.whatsapp_service - DEBUG - Created image message payload for 2348159772015
2025-09-11 22:09:41,642 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:42,576 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348159772015","wa_id":"2348159772015"}],"messages":[{"id":"wamid.HBgNMjM0ODE1OTc3MjAxNRUCABEYEjU4NkVDN0FGNjg0RkRERkNEMwA="}]}
2025-09-11 22:09:43,436 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:43,954 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:09:44,631 - utils.data_manager - INFO - Saved conversation for phone_number: 2348159772015, session_id: 2348159772015
2025-09-11 22:09:44,632 - services.whatsapp_service - DEBUG - Created text message payload for 2348159772015
2025-09-11 22:09:45,643 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348159772015","wa_id":"2348159772015"}],"messages":[{"id":"wamid.HBgNMjM0ODE1OTc3MjAxNRUCABEYEjQxOTA5OThGMUM3RUUzQkZDQgA="}]}
2025-09-11 22:09:45,645 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348159772015', 'wa_id': '2348159772015'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE1OTc3MjAxNRUCABEYEjQxOTA5OThGMUM3RUUzQkZDQgA='}]}
2025-09-11 22:09:45,646 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:45,775 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:09:48,975 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:09:48] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:04,367 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:08,746 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:22,025 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:10:22,027 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:10:24,170 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:10:26,680 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:10:28,752 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:10:30,471 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:10:30,472 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:10:30,474 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:10:30,474 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:10:31,289 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:10:31,290 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:10:31,984 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:10:31,985 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:10:31,985 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:10:31,986 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:10:31,987 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:10:33,800 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:10:35,541 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:10:35,542 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:10:35,542 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:10:35,543 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:10:35,544 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:10:35,545 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:10:35,545 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:10:35,578 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:10:35,580 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:10:36,780 - utils.session_manager - INFO - New session 2348137436841 initialized.
2025-09-11 22:10:36,781 - message_processor - INFO - Session 2348137436841: New session detected. Starting AI chat.
2025-09-11 22:10:36,795 - services.whatsapp_service - DEBUG - Created image message payload for 2348137436841
2025-09-11 22:10:37,495 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:38,170 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348137436841","wa_id":"2348137436841"}],"messages":[{"id":"wamid.HBgNMjM0ODEzNzQzNjg0MRUCABEYEkQ0RkE0RDFEMEI1NDk3RjE3MAA="}]}
2025-09-11 22:10:38,948 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:40,751 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:10:41,625 - utils.data_manager - INFO - Saved conversation for phone_number: 2348137436841, session_id: 2348137436841
2025-09-11 22:10:41,626 - services.whatsapp_service - DEBUG - Created text message payload for 2348137436841
2025-09-11 22:10:42,666 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348137436841","wa_id":"2348137436841"}],"messages":[{"id":"wamid.HBgNMjM0ODEzNzQzNjg0MRUCABEYEjgyMDMxRUUxNzEyQzBBRDIwNgA="}]}
2025-09-11 22:10:42,668 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348137436841', 'wa_id': '2348137436841'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEzNzQzNjg0MRUCABEYEjgyMDMxRUUxNzEyQzBBRDIwNgA='}]}
2025-09-11 22:10:42,670 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:42] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:44,114 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:44,224 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:44,817 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:45,044 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:10:45,049 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:10:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:13,940 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:24,447 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:26,023 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:37,378 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:37,695 - handlers.webhook_handler - INFO - Processing message from 2349059072739 (User: glorioustomilola): {'type': 'text', 'text': 'Thank you!'}
2025-09-11 22:11:37,696 - utils.session_manager - INFO - New session 2349059072739 initialized.
2025-09-11 22:11:37,697 - message_processor - INFO - Session 2349059072739: New session detected. Starting AI chat.
2025-09-11 22:11:37,697 - message_processor - INFO - Session 2349059072739: Starting AI chat for user 'glorioustomilola' with message 'Thank you!'.
2025-09-11 22:11:37,698 - services.whatsapp_service - DEBUG - Created image message payload for 2349059072739
2025-09-11 22:11:38,159 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:38,814 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349059072739","wa_id":"2349059072739"}],"messages":[{"id":"wamid.HBgNMjM0OTA1OTA3MjczORUCABEYEjcyNzI4Q0ZCRTJDNUZBMTU0MgA="}]}
2025-09-11 22:11:40,116 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:40,145 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:11:40,861 - utils.data_manager - INFO - Saved conversation for phone_number: 2349059072739, session_id: 2349059072739
2025-09-11 22:11:40,862 - services.whatsapp_service - DEBUG - Created text message payload for 2349059072739
2025-09-11 22:11:41,867 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349059072739","wa_id":"2349059072739"}],"messages":[{"id":"wamid.HBgNMjM0OTA1OTA3MjczORUCABEYEjUwNTA2RUQzRjVFOEYxNUMwMAA="}]}
2025-09-11 22:11:41,870 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349059072739', 'wa_id': '2349059072739'}], 'messages': [{'id': 'wamid.HBgNMjM0OTA1OTA3MjczORUCABEYEjUwNTA2RUQzRjVFOEYxNUMwMAA='}]}
2025-09-11 22:11:41,873 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:11:44,086 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:11:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:12:08,354 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:12:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:12:30,654 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:12:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:12:31,391 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:12:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:12:45,512 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:12:45] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:12:46,094 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:12:46] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:03,658 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:03] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:07,956 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:08,807 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:09,701 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:23,465 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:50,687 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:50] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:51,542 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348132393390. Message type: reaction
2025-09-11 22:13:51,577 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:13:52,529 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:13:52] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:24,291 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:28,025 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:30,755 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:31,366 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:32,195 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:32,300 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:33,034 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:33] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:14:35,599 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:14:35] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:15:12,094 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:15:12] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:15:12,299 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:15:12] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:15:40,878 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:15:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:16:41,917 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:16:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:04,443 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hi'}
2025-09-11 22:17:04,444 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-09-11 22:17:04,445 - message_processor - INFO - Session 2347082345056: Global command 'hi' detected. Going to AI chat.
2025-09-11 22:17:04,445 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke' with message 'Hi'.
2025-09-11 22:17:04,446 - services.whatsapp_service - DEBUG - Created image message payload for 2347082345056
2025-09-11 22:17:05,825 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEyNTUwQjI1RUUwMENERDMyMQA="}]}
2025-09-11 22:17:05,828 - utils.data_manager - ERROR - Error saving conversation for phone_number=2347082345056, session_id=2347082345056: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-11 22:17:05,830 - message_processor - ERROR - Session 2347082345056: Error in message routing: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 82, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\message_processor.py", line 119, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\handlers\ai_handler.py", line 94, in _handle_ai_chat_start
    self.data_manager.save_conversation(phone_number, session_id, "", prompt_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-11 22:17:05,833 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke' with message 'Hi'.
2025-09-11 22:17:05,834 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-11 22:17:05,835 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2347082345056: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2347082345056', 'type': 'text', 'text': {'body': 'What would you like to know about our wallpapers and interior solutions?'}}
2025-09-11 22:17:06,676 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:06] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:07,003 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjExNzc5NDNCODdEMzA0QzQ3RgA="}]}
2025-09-11 22:17:07,004 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjExNzc5NDNCODdEMzA0QzQ3RgA='}]}
2025-09-11 22:17:07,005 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:07] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:08,306 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:09,141 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:09,499 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:09] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:18,877 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Can I join the waitlist'}
2025-09-11 22:17:18,878 - handlers.base_handler - INFO - AIHandler: Handling message 'can i join the waitlist' in AI chat state for session 2347082345056. Original: 'Can I join the waitlist'
2025-09-11 22:17:21,732 - utils.data_manager - INFO - Saved conversation for phone_number: 2347082345056, session_id: 2347082345056
2025-09-11 22:17:21,733 - services.ai_service - INFO - Prompting for missing waitlist info: ['your email address'] for phone_number=2347082345056
2025-09-11 22:17:21,734 - handlers.ai_handler - INFO - Transitioning to waitlist_collection state for 2347082345056: needs email=True, name=False
2025-09-11 22:17:21,735 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-11 22:17:22,823 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEyQ0MwMzA5Mjc5NDZGMjU1OAA="}]}
2025-09-11 22:17:22,825 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEyQ0MwMzA5Mjc5NDZGMjU1OAA='}]}
2025-09-11 22:17:22,827 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:24,075 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:24,614 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:24,698 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:43,916 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Mayowaoyaleke.mo@gmail.com'}
2025-09-11 22:17:43,916 - message_processor - INFO - Session 2347082345056: Unhandled AI state 'waitlist_collection'. Defaulting to AI chat.
2025-09-11 22:17:43,917 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke' with message 'Mayowaoyaleke.mo@gmail.com'.
2025-09-11 22:17:45,705 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:17:46,408 - utils.data_manager - INFO - Saved conversation for phone_number: 2347082345056, session_id: 2347082345056
2025-09-11 22:17:46,409 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-11 22:17:47,538 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkE1MjdCRDA3QzVCMjFEQjFFNgA="}]}
2025-09-11 22:17:47,540 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkE1MjdCRDA3QzVCMjFEQjFFNgA='}]}
2025-09-11 22:17:47,542 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:47] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:48,397 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:48] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:49,362 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:17:49,480 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:17:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:18:02,193 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:18:02] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:18:03,307 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348155680146. Message type: reaction
2025-09-11 22:18:03,308 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:18:03] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:18:22,643 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:18:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:19:01,029 - handlers.webhook_handler - WARNING - No valid message data extracted for 2349035086831. Message type: reaction
2025-09-11 22:19:01,030 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:19:01] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:19:14,963 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:19:14] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:19:35,208 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:19:35] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:12,621 - handlers.webhook_handler - INFO - Processing message from 2348132393390 (User: PRECIOUS OSENI): {'type': 'text', 'text': 'Thank you'}
2025-09-11 22:20:12,621 - utils.session_manager - INFO - New session 2348132393390 initialized.
2025-09-11 22:20:12,621 - message_processor - INFO - Session 2348132393390: New session detected. Starting AI chat.
2025-09-11 22:20:12,622 - message_processor - INFO - Session 2348132393390: Starting AI chat for user 'PRECIOUS OSENI' with message 'Thank you'.
2025-09-11 22:20:12,622 - services.whatsapp_service - DEBUG - Created image message payload for 2348132393390
2025-09-11 22:20:13,913 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348132393390","wa_id":"2348132393390"}],"messages":[{"id":"wamid.HBgNMjM0ODEzMjM5MzM5MBUCABEYEjIxQ0E1MkVBQkU4NkU5REJBNwA="}]}
2025-09-11 22:20:15,426 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:15] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:15,427 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:15] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:15,484 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:20:16,113 - utils.data_manager - INFO - Saved conversation for phone_number: 2348132393390, session_id: 2348132393390
2025-09-11 22:20:16,113 - services.whatsapp_service - DEBUG - Created text message payload for 2348132393390
2025-09-11 22:20:17,203 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348132393390","wa_id":"2348132393390"}],"messages":[{"id":"wamid.HBgNMjM0ODEzMjM5MzM5MBUCABEYEkYzRjA3NzM5REY0RDNEN0NEMwA="}]}
2025-09-11 22:20:17,204 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348132393390', 'wa_id': '2348132393390'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEzMjM5MzM5MBUCABEYEkYzRjA3NzM5REY0RDNEN0NEMwA='}]}
2025-09-11 22:20:17,205 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:17] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:20,599 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:23,805 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:30,328 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:30] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:40,373 - handlers.webhook_handler - WARNING - No valid message data extracted for 2347025844773. Message type: reaction
2025-09-11 22:20:40,374 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:49,181 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:49] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:20:53,743 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:20:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:21:23,344 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:21:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:21:24,247 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:21:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:22:41,870 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:22:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:22:43,055 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:22:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:22:55,955 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:22:55] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:23:40,152 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:23:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:23:48,030 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Olumayowa'}
2025-09-11 22:23:48,031 - handlers.base_handler - INFO - AIHandler: Handling message 'olumayowa' in AI chat state for session 2347082345056. Original: 'Olumayowa'
2025-09-11 22:23:50,164 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:23:50,762 - utils.data_manager - INFO - Saved conversation for phone_number: 2347082345056, session_id: 2347082345056
2025-09-11 22:23:50,763 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-11 22:23:51,714 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEzODRBMTRCNkExQzRDNUEzRAA="}]}
2025-09-11 22:23:51,714 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkEzODRBMTRCNkExQzRDNUEzRAA='}]}
2025-09-11 22:23:51,715 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:23:51] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:23:53,230 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:23:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:23:53,946 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:23:53] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:23:54,065 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:23:54] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:25:34,190 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:25:34] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:25:39,304 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:25:39] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:25:48,344 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:25:48] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:26:04,944 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:26:04] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:27:20,200 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:27:20] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:27:21,205 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:27:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:27:22,055 - handlers.webhook_handler - WARNING - No valid message data extracted for 2347056569962. Message type: reaction
2025-09-11 22:27:22,056 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:27:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:27:37,133 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:27:37] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:29:06,771 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:29:06] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:29:23,249 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:29:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:29:25,494 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:29:25] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:30:22,703 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:30:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:33:26,239 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:33:26] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:35:32,438 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:35:32] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:35:49,409 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:35:49,411 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:35:51,873 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:35:53,685 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:35:55,102 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:35:56,599 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:35:56,600 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:35:56,601 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:35:56,602 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:35:57,352 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:35:57,353 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:35:57,886 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:35:57,886 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:35:57,886 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:35:57,887 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:35:57,887 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:35:59,093 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:36:00,552 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:36:00,553 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:36:00,553 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:36:00,554 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:36:00,554 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:36:00,554 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:36:00,555 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:36:00,570 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:36:00,571 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:36:11,513 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:11] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:15,145 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello do you deliver to abuja'}
2025-09-11 22:36:15,145 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 22:36:15,145 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-09-11 22:36:15,146 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello do you deliver to abuja'.
2025-09-11 22:36:15,146 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 22:36:16,562 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkZBNDdGMzZDODk1MTc2QTVDRQA="}]}
2025-09-11 22:36:18,002 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:18,805 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:36:20,003 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:36:20,663 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:36:20,664 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:36:21,969 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBMTQ3N0VDMjRFRTVBM0FENAA="}]}
2025-09-11 22:36:21,971 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhBMTQ3N0VDMjRFRTVBM0FENAA='}]}
2025-09-11 22:36:21,972 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:23,129 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:23,777 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:24,246 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:24] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:34,340 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'DO you have a waitlist?'}
2025-09-11 22:36:34,341 - handlers.base_handler - INFO - AIHandler: Handling message 'do you have a waitlist?' in AI chat state for session 2348055614455. Original: 'DO you have a waitlist?'
2025-09-11 22:36:36,185 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:36:36,823 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:36:37,453 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:36:37,453 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:36:38,464 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg1MEY0ODBDNEYxNUQ4RTE0RgA="}]}
2025-09-11 22:36:38,465 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg1MEY0ODBDNEYxNUQ4RTE0RgA='}]}
2025-09-11 22:36:38,466 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:39,573 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:39] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:39,964 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:39] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:40,095 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:51,720 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor Makinde and zigamakinde@gmail.com'}
2025-09-11 22:36:51,720 - handlers.base_handler - INFO - AIHandler: Handling message 'victor makinde and zigamakinde@gmail.com' in AI chat state for session 2348055614455. Original: 'Victor Makinde and zigamakinde@gmail.com'
2025-09-11 22:36:54,149 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:36:54,748 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:36:55,355 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:36:55,355 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:36:56,413 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM2M0RGRjE2QkQ0MjAwMzMxQQA="}]}
2025-09-11 22:36:56,414 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkM2M0RGRjE2QkQ0MjAwMzMxQQA='}]}
2025-09-11 22:36:56,415 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:56] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:57,485 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:57,986 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:36:58,136 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:36:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:37:19,324 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:37:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:37:19,886 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:37:19] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:37:39,315 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:37:39,316 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:37:41,871 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:37:43,338 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:37:45,080 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:37:46,723 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:37:46,723 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:37:46,724 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:37:46,724 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:37:47,129 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:37:47,129 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:37:47,523 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:37:47,524 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:37:47,524 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:37:47,524 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:37:47,524 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:37:48,763 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:37:50,183 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:37:50,183 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:37:50,183 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:37:50,184 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:37:50,184 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:37:50,185 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:37:50,185 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:37:50,208 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:37:50,209 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:37:59,261 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:37:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:40:58,103 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:40:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:40:58,444 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:40:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:40:59,016 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:40:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:41:21,535 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:41:21] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:43:03,714 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:43:03] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:43:42,335 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:43:42] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:43:43,096 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:43:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:43:43,854 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:43:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:44:13,260 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:44:13] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:47:52,360 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:47:52,362 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:47:55,019 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:47:57,081 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:47:58,463 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:47:59,925 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:47:59,926 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:47:59,928 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:47:59,929 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:48:01,308 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:48:01,309 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:48:02,296 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:48:02,297 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:48:02,298 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:48:02,298 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:48:02,298 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:48:03,613 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:48:05,143 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:48:05,144 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:48:05,146 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:48:05,146 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:48:05,147 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:48:05,148 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:48:05,150 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:48:05,177 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:48:05,178 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:48:47,908 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:48:47,910 - utils.data_manager - INFO - Database connection pool closed
2025-09-11 22:48:49,912 - __main__ - ERROR - Database connection failed. Please fix the issues above.
2025-09-11 22:49:18,113 - data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:49:19,589 - data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:49:19,592 - data_manager - INFO - Database connection pool closed
2025-09-11 22:49:21,765 - data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:49:23,209 - data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:49:23,210 - services.ai_service - WARNING - AI features disabled in Wallpaper.ng AIService - missing Azure OpenAI configuration.
2025-09-11 22:49:23,211 - data_manager - INFO - Database connection pool closed
2025-09-11 22:49:23,221 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:49:24,550 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:49:25,710 - data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:49:27,085 - data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:49:27,086 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:49:27,087 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:49:27,088 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:49:27,773 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:49:27,773 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:49:28,366 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:49:28,367 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:49:28,367 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:49:28,368 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:49:28,368 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:49:29,663 - data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:49:31,192 - data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:49:31,193 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:49:31,194 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:49:31,195 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:49:31,195 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:49:31,196 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:49:31,197 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:49:31,222 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:49:31,222 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:49:36,454 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-09-11 22:49:36,455 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-09-11 22:49:36,455 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-09-11 22:49:36,456 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-09-11 22:49:36,457 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-09-11 22:49:37,744 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI5QkQxMEYxM0Y0M0I3MEQ4RAA="}]}
2025-09-11 22:49:38,373 - data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:49:38,375 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:49:38,902 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:38] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:39,355 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE0Njk0QzNEOEE1MEJGQThFQQA="}]}
2025-09-11 22:49:39,357 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE0Njk0QzNEOEE1MEJGQThFQQA='}]}
2025-09-11 22:49:39,359 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:39] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:40,780 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:40] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:41,113 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:41,227 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:41] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:52,208 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to join your wait-list'}
2025-09-11 22:49:52,209 - handlers.base_handler - INFO - AIHandler: Handling message 'i want to join your wait-list' in AI chat state for session 2348055614455. Original: 'I want to join your wait-list'
2025-09-11 22:49:55,067 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:49:55,665 - data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:49:56,282 - data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:49:56,283 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:49:57,194 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczMDdFQkMxRkU0QjkyRjE4NAA="}]}
2025-09-11 22:49:57,195 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjczMDdFQkMxRkU0QjkyRjE4NAA='}]}
2025-09-11 22:49:57,197 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:58,293 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:58,993 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:58] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:49:59,297 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:49:59] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:50:12,301 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Victor and my email is zigamakide@gmail.com'}
2025-09-11 22:50:12,302 - handlers.base_handler - INFO - AIHandler: Handling message 'victor and my email is zigamakide@gmail.com' in AI chat state for session 2348055614455. Original: 'Victor and my email is zigamakide@gmail.com'
2025-09-11 22:50:14,257 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 22:50:14,817 - data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:50:15,413 - data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-09-11 22:50:15,414 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-09-11 22:50:16,364 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFCOEM0REY4OTUxQjM0MTJBRQA="}]}
2025-09-11 22:50:16,366 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjFCOEM0REY4OTUxQjM0MTJBRQA='}]}
2025-09-11 22:50:16,367 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:50:16] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:50:17,893 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:50:17] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:50:18,423 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:50:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:50:18,427 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:50:18] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:51:14,819 - data_manager - INFO - Database connection pool closed
2025-09-11 22:51:14,821 - data_manager - INFO - Database connection pool closed
2025-09-11 22:51:16,582 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-11 22:51:19,807 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:51:21,266 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:51:22,653 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:51:22,654 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:51:22,655 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:51:22,655 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-11 22:51:23,476 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:51:23,477 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:51:24,357 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-11 22:51:24,358 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-11 22:51:24,358 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-11 22:51:24,358 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-11 22:51:24,359 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-11 22:51:25,575 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-11 22:51:26,932 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-11 22:51:26,933 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-11 22:51:26,934 - services.payment_service - INFO - PaymentService initialized
2025-09-11 22:51:26,935 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-11 22:51:26,936 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-11 22:51:26,937 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-11 22:51:26,938 - app - INFO - WebhookHandler initialized with message processor.
2025-09-11 22:51:26,966 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-11 22:51:26,967 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-11 22:52:22,591 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:52:22] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:52:28,057 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:52:28] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:53:44,184 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:53:44] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:56:08,905 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:56:08] "POST /webhook HTTP/1.1" 200 -
2025-09-11 22:56:10,230 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348142695687. Message type: reaction
2025-09-11 22:56:10,230 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 22:56:10] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:03:43,070 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:03:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:03:43,854 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:03:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:14:23,230 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:14:23] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:14:31,394 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:14:31] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:15:43,239 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:15:43] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:15:54,715 - utils.session_manager - INFO - New session 2348123317618 initialized.
2025-09-11 23:15:54,716 - message_processor - INFO - Session 2348123317618: New session detected. Starting AI chat.
2025-09-11 23:15:54,722 - services.whatsapp_service - DEBUG - Created image message payload for 2348123317618
2025-09-11 23:15:56,270 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348123317618","wa_id":"2348123317618"}],"messages":[{"id":"wamid.HBgNMjM0ODEyMzMxNzYxOBUCABEYEjAyMkM3RTkxQjZFODIxREE3MAA="}]}
2025-09-11 23:15:57,635 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:15:57] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:15:58,140 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-11 23:15:58,144 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348123317618, session_id=2348123317618: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-11 23:15:58,146 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-11 23:16:00,596 - utils.data_manager - INFO - Saved conversation for phone_number: 2348123317618, session_id: 2348123317618
2025-09-11 23:16:00,597 - services.whatsapp_service - DEBUG - Created text message payload for 2348123317618
2025-09-11 23:16:01,703 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348123317618","wa_id":"2348123317618"}],"messages":[{"id":"wamid.HBgNMjM0ODEyMzMxNzYxOBUCABEYEjQwQzlGQzhGOEMzMDgxMjNBNQA="}]}
2025-09-11 23:16:01,704 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348123317618', 'wa_id': '2348123317618'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEyMzMxNzYxOBUCABEYEjQwQzlGQzhGOEMzMDgxMjNBNQA='}]}
2025-09-11 23:16:01,704 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:16:01] "POST /webhook HTTP/1.1" 200 -
2025-09-11 23:16:05,408 - werkzeug - INFO - 127.0.0.1 - - [11/Sep/2025 23:16:05] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:24:01,938 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-09-12 14:24:03,892 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-12 14:24:06,521 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-12 14:24:07,947 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-12 14:24:07,947 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-12 14:24:07,948 - services.payment_service - INFO - PaymentService initialized
2025-09-12 14:24:07,948 - app - INFO - Core services initialized for Wallpaper.ng
2025-09-12 14:24:08,447 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-12 14:24:08,447 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-12 14:24:08,809 - services.ai_service - INFO - Azure OpenAI client initialized successfully for Wallpaper.ng AIService.
2025-09-12 14:24:08,809 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Wallpaper.ng.
2025-09-12 14:24:08,809 - message_processor - INFO - MessageProcessor initialized for Wallpaper.ng conversational AI.
2025-09-12 14:24:08,809 - app - INFO - Wallpaper.ng handlers and message processor initialized.
2025-09-12 14:24:08,810 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-09-12 14:24:10,048 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-09-12 14:24:11,541 - utils.data_manager - INFO - Database tables created or verified successfully
2025-09-12 14:24:11,542 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-09-12 14:24:11,543 - services.payment_service - INFO - PaymentService initialized
2025-09-12 14:24:11,544 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-09-12 14:24:11,544 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-09-12 14:24:11,545 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-09-12 14:24:11,546 - app - INFO - WebhookHandler initialized with message processor.
2025-09-12 14:24:11,600 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-09-12 14:24:11,601 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-09-12 14:24:44,283 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:24:44] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:24:51,600 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:24:51] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:25:00,657 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:25:00] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:25:35,751 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:25:35] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:25:38,243 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:25:38] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:25:39,948 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:25:39] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:04,963 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:04] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:07,892 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:07] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:16,529 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348131047145. Message type: reaction
2025-09-12 14:26:16,530 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:16] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:18,190 - handlers.webhook_handler - INFO - Processing message from 2349069171296 (User: Joshua Ayodeji): {'type': 'text', 'text': 'Thanks'}
2025-09-12 14:26:18,190 - utils.session_manager - INFO - New session 2349069171296 initialized.
2025-09-12 14:26:18,190 - message_processor - INFO - Session 2349069171296: New session detected. Starting AI chat.
2025-09-12 14:26:18,191 - message_processor - INFO - Session 2349069171296: Starting AI chat for user 'Joshua Ayodeji' with message 'Thanks'.
2025-09-12 14:26:18,192 - services.whatsapp_service - DEBUG - Created image message payload for 2349069171296
2025-09-12 14:26:19,499 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349069171296","wa_id":"2349069171296"}],"messages":[{"id":"wamid.HBgNMjM0OTA2OTE3MTI5NhUCABEYEjhDMzUzRTkyQTdFNzJFMEZFQgA="}]}
2025-09-12 14:26:20,223 - handlers.webhook_handler - INFO - Processing message from 2348143364902 (User: Dounie_bake_et_treat): {'type': 'text', 'text': 'Hello!\nThank you very much.'}
2025-09-12 14:26:20,223 - utils.session_manager - INFO - New session 2348143364902 initialized.
2025-09-12 14:26:20,224 - message_processor - INFO - Session 2348143364902: New session detected. Starting AI chat.
2025-09-12 14:26:20,227 - message_processor - INFO - Session 2348143364902: Starting AI chat for user 'Dounie_bake_et_treat' with message 'Hello!
Thank you very much.'.
2025-09-12 14:26:20,229 - services.whatsapp_service - DEBUG - Created image message payload for 2348143364902
2025-09-12 14:26:21,046 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:21] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:21,279 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348143364902","wa_id":"2348143364902"}],"messages":[{"id":"wamid.HBgNMjM0ODE0MzM2NDkwMhUCABEYEjJCMzlGQjREODA2MkJCMjI5NgA="}]}
2025-09-12 14:26:21,371 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:26:21,991 - utils.data_manager - INFO - Saved conversation for phone_number: 2349069171296, session_id: 2349069171296
2025-09-12 14:26:21,991 - services.whatsapp_service - DEBUG - Created text message payload for 2349069171296
2025-09-12 14:26:22,339 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:22] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:22,451 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:26:22,841 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:22] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:22,902 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349069171296","wa_id":"2349069171296"}],"messages":[{"id":"wamid.HBgNMjM0OTA2OTE3MTI5NhUCABEYEjU1NzIzNTMwMTQxQTVENEE3QQA="}]}
2025-09-12 14:26:22,903 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349069171296', 'wa_id': '2349069171296'}], 'messages': [{'id': 'wamid.HBgNMjM0OTA2OTE3MTI5NhUCABEYEjU1NzIzNTMwMTQxQTVENEE3QQA='}]}
2025-09-12 14:26:22,905 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:22] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:23,035 - utils.data_manager - INFO - Saved conversation for phone_number: 2348143364902, session_id: 2348143364902
2025-09-12 14:26:23,036 - services.whatsapp_service - DEBUG - Created text message payload for 2348143364902
2025-09-12 14:26:23,370 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:23] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:23,731 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:23] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:24,060 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348143364902","wa_id":"2348143364902"}],"messages":[{"id":"wamid.HBgNMjM0ODE0MzM2NDkwMhUCABEYEkRDOEM5QzgzNEUwN0JCOUQyRAA="}]}
2025-09-12 14:26:24,061 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348143364902', 'wa_id': '2348143364902'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE0MzM2NDkwMhUCABEYEkRDOEM5QzgzNEUwN0JCOUQyRAA='}]}
2025-09-12 14:26:24,062 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:24] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:26,480 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:26] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:28,115 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:28] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:37,799 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:26:38,399 - utils.data_manager - INFO - Saved conversation for phone_number: 2348143364902, session_id: 2348143364902
2025-09-12 14:26:38,400 - services.whatsapp_service - DEBUG - Created text message payload for 2348143364902
2025-09-12 14:26:39,389 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348143364902","wa_id":"2348143364902"}],"messages":[{"id":"wamid.HBgNMjM0ODE0MzM2NDkwMhUCABEYEjlEN0VGMzQ0OEVCREExNzQ4OAA="}]}
2025-09-12 14:26:39,390 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348143364902', 'wa_id': '2348143364902'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE0MzM2NDkwMhUCABEYEjlEN0VGMzQ0OEVCREExNzQ4OAA='}]}
2025-09-12 14:26:39,391 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:39] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:40,652 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:40] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:40,780 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:40] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:49,641 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:49] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:26:53,433 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:26:53] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:27:35,163 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:27:35] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:27:38,091 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:27:38] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:27:39,701 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:27:39] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:28:10,437 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:28:10] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:28:20,566 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:28:20] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:28:24,976 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:28:24] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:29:19,382 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:29:19] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:29:38,576 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:29:38] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:29:43,068 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:29:43] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:30:45,697 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:30:45] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:31:32,626 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:31:32] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:32:06,876 - handlers.webhook_handler - INFO - Processing message from 2348101684854 (User: Elixir): {'type': 'text', 'text': 'Thanks so much'}
2025-09-12 14:32:06,876 - utils.session_manager - INFO - New session 2348101684854 initialized.
2025-09-12 14:32:06,877 - message_processor - INFO - Session 2348101684854: New session detected. Starting AI chat.
2025-09-12 14:32:06,877 - message_processor - INFO - Session 2348101684854: Starting AI chat for user 'Elixir' with message 'Thanks so much'.
2025-09-12 14:32:06,877 - services.whatsapp_service - DEBUG - Created image message payload for 2348101684854
2025-09-12 14:32:08,008 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348101684854","wa_id":"2348101684854"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMTY4NDg1NBUCABEYEjMzNDYxNTMyMjRFMzVGREU1OQA="}]}
2025-09-12 14:32:08,810 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:32:08] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:32:09,828 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:32:09,841 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348101684854, session_id=2348101684854: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-12 14:32:09,844 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 14:32:12,279 - utils.data_manager - INFO - Saved conversation for phone_number: 2348101684854, session_id: 2348101684854
2025-09-12 14:32:12,279 - services.whatsapp_service - DEBUG - Created text message payload for 2348101684854
2025-09-12 14:32:13,299 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348101684854","wa_id":"2348101684854"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMTY4NDg1NBUCABEYEkI3NkRBQkRDOEM1NEI0QTZDMQA="}]}
2025-09-12 14:32:13,300 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348101684854', 'wa_id': '2348101684854'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEwMTY4NDg1NBUCABEYEkI3NkRBQkRDOEM1NEI0QTZDMQA='}]}
2025-09-12 14:32:13,301 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:32:13] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:32:15,609 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:32:15] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:33:26,759 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'Hi there'}
2025-09-12 14:33:26,760 - utils.session_manager - INFO - New session 2347082345056 initialized.
2025-09-12 14:33:26,760 - message_processor - INFO - Session 2347082345056: New session detected. Starting AI chat.
2025-09-12 14:33:26,761 - message_processor - INFO - Session 2347082345056: Starting AI chat for user 'Olumayowa Oyaleke' with message 'Hi there'.
2025-09-12 14:33:26,761 - services.whatsapp_service - DEBUG - Created image message payload for 2347082345056
2025-09-12 14:33:27,989 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjFBNTA3MUNBRDU5NDY1QTUwOAA="}]}
2025-09-12 14:33:28,578 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:33:28] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:33:29,168 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:33:29,767 - utils.data_manager - INFO - Saved conversation for phone_number: 2347082345056, session_id: 2347082345056
2025-09-12 14:33:29,767 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-12 14:33:30,919 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkUxRjVFNjFDMUNFRjRGRDRFNQA="}]}
2025-09-12 14:33:30,920 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEkUxRjVFNjFDMUNFRjRGRDRFNQA='}]}
2025-09-12 14:33:30,921 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:33:30] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:33:32,237 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:33:32] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:33:32,672 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:33:32] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:33:32,892 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:33:32] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:33:43,950 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:33:43] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:34:09,106 - handlers.webhook_handler - INFO - Processing message from 2347082345056 (User: Olumayowa Oyaleke): {'type': 'text', 'text': 'How are you'}
2025-09-12 14:34:09,107 - handlers.base_handler - INFO - AIHandler: Handling message 'how are you' in AI chat state for session 2347082345056. Original: 'How are you'
2025-09-12 14:34:10,419 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:34:11,020 - utils.data_manager - INFO - Saved conversation for phone_number: 2347082345056, session_id: 2347082345056
2025-09-12 14:34:11,020 - services.whatsapp_service - DEBUG - Created text message payload for 2347082345056
2025-09-12 14:34:12,022 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347082345056","wa_id":"2347082345056"}],"messages":[{"id":"wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjYwODlBQThCMzEzQURCRjEwRgA="}]}
2025-09-12 14:34:12,023 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347082345056', 'wa_id': '2347082345056'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA4MjM0NTA1NhUCABEYEjYwODlBQThCMzEzQURCRjEwRgA='}]}
2025-09-12 14:34:12,025 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:34:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:34:13,111 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:34:13] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:34:14,796 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:34:14] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:34:14,864 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:34:14] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:34:56,761 - utils.session_manager - INFO - New session 2349053354672 initialized.
2025-09-12 14:34:56,762 - message_processor - INFO - Session 2349053354672: New session detected. Starting AI chat.
2025-09-12 14:34:56,766 - services.whatsapp_service - DEBUG - Created image message payload for 2349053354672
2025-09-12 14:34:57,940 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349053354672","wa_id":"2349053354672"}],"messages":[{"id":"wamid.HBgNMjM0OTA1MzM1NDY3MhUCABEYEjFGNjhEOERDODM3QzY1REY5NwA="}]}
2025-09-12 14:34:58,779 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:34:58] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:34:59,608 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:35:00,207 - utils.data_manager - INFO - Saved conversation for phone_number: 2349053354672, session_id: 2349053354672
2025-09-12 14:35:00,208 - services.whatsapp_service - DEBUG - Created text message payload for 2349053354672
2025-09-12 14:35:01,207 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349053354672","wa_id":"2349053354672"}],"messages":[{"id":"wamid.HBgNMjM0OTA1MzM1NDY3MhUCABEYEkM4Qzc1MUM1NjAxN0EyRjNEMwA="}]}
2025-09-12 14:35:01,207 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349053354672', 'wa_id': '2349053354672'}], 'messages': [{'id': 'wamid.HBgNMjM0OTA1MzM1NDY3MhUCABEYEkM4Qzc1MUM1NjAxN0EyRjNEMwA='}]}
2025-09-12 14:35:01,208 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:35:01] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:35:02,018 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:35:02] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:35:04,340 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:35:04] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:35:37,264 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:35:37] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:37:31,089 - handlers.webhook_handler - INFO - Processing message from 2349053354672 (User: Adeola Oni'oge): {'type': 'text', 'text': 'Thank you'}
2025-09-12 14:37:31,089 - handlers.base_handler - INFO - AIHandler: Handling message 'thank you' in AI chat state for session 2349053354672. Original: 'Thank you'
2025-09-12 14:37:32,859 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:37:33,938 - utils.data_manager - INFO - Saved conversation for phone_number: 2349053354672, session_id: 2349053354672
2025-09-12 14:37:33,939 - services.whatsapp_service - DEBUG - Created text message payload for 2349053354672
2025-09-12 14:37:34,840 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349053354672","wa_id":"2349053354672"}],"messages":[{"id":"wamid.HBgNMjM0OTA1MzM1NDY3MhUCABEYEjA5Mzc0NDFGOTM5NTc3MkQ4QQA="}]}
2025-09-12 14:37:34,840 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349053354672', 'wa_id': '2349053354672'}], 'messages': [{'id': 'wamid.HBgNMjM0OTA1MzM1NDY3MhUCABEYEjA5Mzc0NDFGOTM5NTc3MkQ4QQA='}]}
2025-09-12 14:37:34,841 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:37:34] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:37:35,849 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:37:35] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:41:40,820 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:41:40] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:41:42,695 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:41:42] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:42:28,845 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:42:28] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:43:31,673 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:43:31] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:44:35,125 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348130657730. Message type: reaction
2025-09-12 14:44:35,125 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:44:35] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:46:28,012 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:46:28] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:46:32,868 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:46:32] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:47:58,323 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:47:58] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:48:33,417 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:48:33] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:48:34,736 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:48:34] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:48:38,121 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:48:38] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:49:04,752 - handlers.webhook_handler - INFO - Processing message from 2348103391226 (User: Ajayi Deborah Opeyemi): {'type': 'text', 'text': 'Hi. Thank you'}
2025-09-12 14:49:04,752 - utils.session_manager - INFO - New session 2348103391226 initialized.
2025-09-12 14:49:04,752 - message_processor - INFO - Session 2348103391226: New session detected. Starting AI chat.
2025-09-12 14:49:04,753 - message_processor - INFO - Session 2348103391226: Starting AI chat for user 'Ajayi Deborah Opeyemi' with message 'Hi. Thank you'.
2025-09-12 14:49:04,753 - services.whatsapp_service - DEBUG - Created image message payload for 2348103391226
2025-09-12 14:49:05,810 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348103391226","wa_id":"2348103391226"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMzM5MTIyNhUCABEYEjY1RjAzQzNGODVBNkZFNkU3NAA="}]}
2025-09-12 14:49:07,034 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:49:07] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:49:07,095 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 14:49:07,098 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348103391226, session_id=2348103391226: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-12 14:49:07,099 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 14:49:09,460 - utils.data_manager - INFO - Saved conversation for phone_number: 2348103391226, session_id: 2348103391226
2025-09-12 14:49:09,460 - services.whatsapp_service - DEBUG - Created text message payload for 2348103391226
2025-09-12 14:49:10,356 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348103391226","wa_id":"2348103391226"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMzM5MTIyNhUCABEYEjY3RjlCQUZGNDE5MUU0OTk0MwA="}]}
2025-09-12 14:49:10,357 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348103391226', 'wa_id': '2348103391226'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEwMzM5MTIyNhUCABEYEjY3RjlCQUZGNDE5MUU0OTk0MwA='}]}
2025-09-12 14:49:10,357 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:49:10] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:49:12,715 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:49:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:50:07,303 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:50:07] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:50:11,301 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:50:11] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:50:41,348 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:50:41] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:51:05,344 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:51:05] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:51:58,073 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:51:58] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:52:03,576 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:52:03] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:53:49,016 - handlers.webhook_handler - WARNING - No valid message data extracted for 2347034240489. Message type: reaction
2025-09-12 14:53:49,017 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:53:49] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:54:37,602 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:54:37] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:54:38,938 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:54:38] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:55:03,625 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:55:03] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:56:43,954 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:56:43] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:57:33,730 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:57:33] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:57:34,515 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:57:34] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:58:12,005 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:58:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:58:46,596 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:58:46] "POST /webhook HTTP/1.1" 200 -
2025-09-12 14:58:57,067 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 14:58:57] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:01:12,408 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348117023044. Message type: reaction
2025-09-12 15:01:12,408 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:01:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:05:12,561 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:05:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:05:13,173 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:05:13] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:08:18,690 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:08:18] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:09:09,354 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:09:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:09:10,022 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:09:10] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:09:34,008 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:09:34] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:09:35,047 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:09:35] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:09:35,403 - handlers.webhook_handler - INFO - Processing message from 2348157666217 (User: M S): {'type': 'text', 'text': 'Thank you for contacting M S! Please let us know how we can help you.'}
2025-09-12 15:09:35,404 - utils.session_manager - INFO - New session 2348157666217 initialized.
2025-09-12 15:09:35,404 - message_processor - INFO - Session 2348157666217: New session detected. Starting AI chat.
2025-09-12 15:09:35,404 - message_processor - INFO - Session 2348157666217: Starting AI chat for user 'M S' with message 'Thank you for contacting M S! Please let us know how we can help you.'.
2025-09-12 15:09:35,405 - services.whatsapp_service - DEBUG - Created image message payload for 2348157666217
2025-09-12 15:09:36,881 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348157666217","wa_id":"2348157666217"}],"messages":[{"id":"wamid.HBgNMjM0ODE1NzY2NjIxNxUCABEYEkNGMThCMjM2NEMwMTkyRDVGRgA="}]}
2025-09-12 15:09:38,435 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:09:38] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:09:38,566 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:09:38,750 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348157666217, session_id=2348157666217: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

2025-09-12 15:09:38,752 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 15:09:41,108 - utils.data_manager - INFO - Saved conversation for phone_number: 2348157666217, session_id: 2348157666217
2025-09-12 15:09:41,109 - services.whatsapp_service - DEBUG - Created text message payload for 2348157666217
2025-09-12 15:09:42,362 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348157666217","wa_id":"2348157666217"}],"messages":[{"id":"wamid.HBgNMjM0ODE1NzY2NjIxNxUCABEYEjg4QzQ2OTU2MzlBRUFERjY2MQA="}]}
2025-09-12 15:09:42,363 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348157666217', 'wa_id': '2348157666217'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE1NzY2NjIxNxUCABEYEjg4QzQ2OTU2MzlBRUFERjY2MQA='}]}
2025-09-12 15:09:42,363 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:09:42] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:09:46,146 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:09:46] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:10:05,512 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:10:05] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:10:17,563 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:10:17] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:11:59,064 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:11:59] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:12:15,202 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:12:15] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:13:32,009 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:13:32] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:13:32,823 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:13:32] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:16:09,167 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:16:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:16:54,478 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:16:54] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:17:02,176 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:17:02] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:18:21,177 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:18:21] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:18:21,707 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:18:21] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:19:17,337 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:19:17] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:21:48,361 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:21:48] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:22:53,388 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:22:53] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:25:15,125 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:25:15] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:25:49,581 - handlers.webhook_handler - INFO - Processing message from 2348165708502 (User: Dorcas Omowumi): {'type': 'text', 'text': 'Thank you'}
2025-09-12 15:25:49,581 - utils.session_manager - INFO - New session 2348165708502 initialized.
2025-09-12 15:25:49,582 - message_processor - INFO - Session 2348165708502: New session detected. Starting AI chat.
2025-09-12 15:25:49,582 - message_processor - INFO - Session 2348165708502: Starting AI chat for user 'Dorcas Omowumi' with message 'Thank you'.
2025-09-12 15:25:49,583 - services.whatsapp_service - DEBUG - Created image message payload for 2348165708502
2025-09-12 15:25:51,249 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348165708502","wa_id":"2348165708502"}],"messages":[{"id":"wamid.HBgNMjM0ODE2NTcwODUwMhUCABEYEkQ2MDIwQTc1QjZDRkNBQkFGNAA="}]}
2025-09-12 15:25:52,694 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:25:52,695 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:25:52] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:25:52,697 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348165708502, session_id=2348165708502: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-12 15:25:52,698 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 15:25:55,048 - utils.data_manager - INFO - Saved conversation for phone_number: 2348165708502, session_id: 2348165708502
2025-09-12 15:25:55,049 - services.whatsapp_service - DEBUG - Created text message payload for 2348165708502
2025-09-12 15:25:56,028 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348165708502","wa_id":"2348165708502"}],"messages":[{"id":"wamid.HBgNMjM0ODE2NTcwODUwMhUCABEYEjc3RjE2RjFDOUE2ODFDMkRFNAA="}]}
2025-09-12 15:25:56,029 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348165708502', 'wa_id': '2348165708502'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE2NTcwODUwMhUCABEYEjc3RjE2RjFDOUE2ODFDMkRFNAA='}]}
2025-09-12 15:25:56,030 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:25:56] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:00,590 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:00] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:43,264 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'hi'}
2025-09-12 15:26:43,265 - utils.session_manager - INFO - New session 2349038417663 initialized.
2025-09-12 15:26:43,265 - message_processor - INFO - Session 2349038417663: Global command 'hi' detected. Going to AI chat.
2025-09-12 15:26:43,266 - message_processor - INFO - Session 2349038417663: Starting AI chat for user 'NA' with message 'hi'.
2025-09-12 15:26:43,266 - services.whatsapp_service - DEBUG - Created image message payload for 2349038417663
2025-09-12 15:26:44,329 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038417663","wa_id":"2349038417663"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjE1RDMwQUZBMzVDMEI3MEVBOQA="}]}
2025-09-12 15:26:44,929 - utils.data_manager - INFO - Saved conversation for phone_number: 2349038417663, session_id: 2349038417663
2025-09-12 15:26:44,930 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-12 15:26:45,732 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:45] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:45,869 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038417663","wa_id":"2349038417663"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEkU3NUI0RUI2OUYzRjYzMDJCQQA="}]}
2025-09-12 15:26:45,870 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349038417663', 'wa_id': '2349038417663'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEkU3NUI0RUI2OUYzRjYzMDJCQQA='}]}
2025-09-12 15:26:45,871 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:45] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:46,072 - handlers.webhook_handler - INFO - Processing message from 2347043075099 (User: Victor): {'type': 'text', 'text': 'Thanks'}
2025-09-12 15:26:46,072 - utils.session_manager - INFO - New session 2347043075099 initialized.
2025-09-12 15:26:46,073 - message_processor - INFO - Session 2347043075099: New session detected. Starting AI chat.
2025-09-12 15:26:46,073 - message_processor - INFO - Session 2347043075099: Starting AI chat for user 'Victor' with message 'Thanks'.
2025-09-12 15:26:46,073 - services.whatsapp_service - DEBUG - Created image message payload for 2347043075099
2025-09-12 15:26:47,211 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347043075099","wa_id":"2347043075099"}],"messages":[{"id":"wamid.HBgNMjM0NzA0MzA3NTA5ORUCABEYEjdDOTE5NThDM0IzRDExQjJBNAA="}]}
2025-09-12 15:26:47,784 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:47] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:47,965 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:47] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:47,981 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:47] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:48,439 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:26:48,606 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:48] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:49,039 - utils.data_manager - INFO - Saved conversation for phone_number: 2347043075099, session_id: 2347043075099
2025-09-12 15:26:49,039 - services.whatsapp_service - DEBUG - Created text message payload for 2347043075099
2025-09-12 15:26:49,979 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347043075099","wa_id":"2347043075099"}],"messages":[{"id":"wamid.HBgNMjM0NzA0MzA3NTA5ORUCABEYEjBFMkJDODQ3NTUxRTJDREY4NQA="}]}
2025-09-12 15:26:49,980 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347043075099', 'wa_id': '2347043075099'}], 'messages': [{'id': 'wamid.HBgNMjM0NzA0MzA3NTA5ORUCABEYEjBFMkJDODQ3NTUxRTJDREY4NQA='}]}
2025-09-12 15:26:49,981 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:49] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:26:53,481 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:26:53] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:05,055 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'what exactly do you guys do'}
2025-09-12 15:27:05,055 - handlers.base_handler - INFO - AIHandler: Handling message 'what exactly do you guys do' in AI chat state for session 2349038417663. Original: 'what exactly do you guys do'
2025-09-12 15:27:06,859 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:27:07,462 - utils.data_manager - INFO - Saved conversation for phone_number: 2349038417663, session_id: 2349038417663
2025-09-12 15:27:07,462 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-12 15:27:08,429 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038417663","wa_id":"2349038417663"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjE0NEMyMTIzMTcyQThFRjhEOQA="}]}
2025-09-12 15:27:08,429 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349038417663', 'wa_id': '2349038417663'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjE0NEMyMTIzMTcyQThFRjhEOQA='}]}
2025-09-12 15:27:08,430 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:08] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:09,254 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:09,850 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:09,979 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:38,410 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'do you guys do collaboration, like i might want to partner with you guys'}
2025-09-12 15:27:38,410 - handlers.base_handler - INFO - AIHandler: Handling message 'do you guys do collaboration, like i might want to partner with you guys' in AI chat state for session 2349038417663. Original: 'do you guys do collaboration, like i might want to partner with you guys'
2025-09-12 15:27:40,562 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:27:41,153 - utils.data_manager - INFO - Saved conversation for phone_number: 2349038417663, session_id: 2349038417663
2025-09-12 15:27:41,164 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-12 15:27:42,088 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038417663","wa_id":"2349038417663"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjRCM0U3Q0E5MEYwOEQ5NTQwMAA="}]}
2025-09-12 15:27:42,089 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349038417663', 'wa_id': '2349038417663'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjRCM0U3Q0E5MEYwOEQ5NTQwMAA='}]}
2025-09-12 15:27:42,090 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:42] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:42,868 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:42] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:43,533 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:43] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:27:43,789 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:27:43] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:00,105 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'alright how do i place an order'}
2025-09-12 15:28:00,105 - handlers.base_handler - INFO - AIHandler: Handling message 'alright how do i place an order' in AI chat state for session 2349038417663. Original: 'alright how do i place an order'
2025-09-12 15:28:03,008 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'where is your product list'}
2025-09-12 15:28:03,009 - handlers.base_handler - INFO - AIHandler: Handling message 'where is your product list' in AI chat state for session 2349038417663. Original: 'where is your product list'
2025-09-12 15:28:04,640 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:28:05,258 - utils.data_manager - INFO - Saved conversation for phone_number: 2349038417663, session_id: 2349038417663
2025-09-12 15:28:05,259 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-12 15:28:05,613 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:28:06,159 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038417663","wa_id":"2349038417663"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjI2NTZERDA2Qjk2RkU4NDBGNQA="}]}
2025-09-12 15:28:06,159 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349038417663', 'wa_id': '2349038417663'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjI2NTZERDA2Qjk2RkU4NDBGNQA='}]}
2025-09-12 15:28:06,160 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:06] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:06,209 - utils.data_manager - INFO - Saved conversation for phone_number: 2349038417663, session_id: 2349038417663
2025-09-12 15:28:06,209 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-12 15:28:07,287 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:07] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:07,429 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038417663","wa_id":"2349038417663"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjcwNDkyNzFGNjQwMUM0NEUwNQA="}]}
2025-09-12 15:28:07,429 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349038417663', 'wa_id': '2349038417663'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjcwNDkyNzFGNjQwMUM0NEUwNQA='}]}
2025-09-12 15:28:07,430 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:07] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:07,690 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:07] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:07,717 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:07] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:08,520 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:08] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:09,089 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:09,208 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:35,510 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:35] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:37,283 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:37] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:38,916 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:38] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:39,100 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:39] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:41,591 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:41] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:28:42,892 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:28:42] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:29:03,755 - handlers.webhook_handler - INFO - Processing message from 2349038417663 (User: NA): {'type': 'text', 'text': 'okay if i want to order now'}
2025-09-12 15:29:03,756 - handlers.base_handler - INFO - AIHandler: Handling message 'okay if i want to order now' in AI chat state for session 2349038417663. Original: 'okay if i want to order now'
2025-09-12 15:29:07,144 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 15:29:07,767 - utils.data_manager - INFO - Saved conversation for phone_number: 2349038417663, session_id: 2349038417663
2025-09-12 15:29:07,768 - services.whatsapp_service - DEBUG - Created text message payload for 2349038417663
2025-09-12 15:29:08,760 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2349038417663","wa_id":"2349038417663"}],"messages":[{"id":"wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjJFODA2OTNDQkU0MjcxREMzMAA="}]}
2025-09-12 15:29:08,761 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2349038417663', 'wa_id': '2349038417663'}], 'messages': [{'id': 'wamid.HBgNMjM0OTAzODQxNzY2MxUCABEYEjJFODA2OTNDQkU0MjcxREMzMAA='}]}
2025-09-12 15:29:08,764 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:29:08] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:29:09,638 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:29:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:29:10,178 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:29:10] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:29:10,191 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:29:10] "POST /webhook HTTP/1.1" 200 -
2025-09-12 15:29:23,724 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 15:29:23] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:19:39,959 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:19:39] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:20:01,909 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348137715845. Message type: unsupported
2025-09-12 21:20:01,910 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:20:01] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:20:21,164 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:20:21] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:20:44,772 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:20:44] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:20:44,775 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:20:44] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:21:19,647 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:21:19] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:22:12,805 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:22:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:22:14,373 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:22:14] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:23:42,020 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:23:42] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:23:56,470 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:23:56] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:25:34,793 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:25:34] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:26:25,455 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:26:25] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:29:12,117 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:29:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:29:53,434 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:29:53] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:29:54,244 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:29:54] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:34:12,313 - utils.session_manager - INFO - New session 2347015917550 initialized.
2025-09-12 21:34:12,316 - message_processor - INFO - Session 2347015917550: New session detected. Starting AI chat.
2025-09-12 21:34:12,328 - services.whatsapp_service - DEBUG - Created image message payload for 2347015917550
2025-09-12 21:34:13,481 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347015917550","wa_id":"2347015917550"}],"messages":[{"id":"wamid.HBgNMjM0NzAxNTkxNzU1MBUCABEYEjMwNTFEQjQ1RTgxQTk3QzA3MQA="}]}
2025-09-12 21:34:13,494 - utils.data_manager - ERROR - Error adding/updating lead for phone_number=2347015917550: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 284, in add_lead
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO leads (phone_number, name, email, inquiry, created_at)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
            created_at = CURRENT_TIMESTAMP
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, name, email, inquiry, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

2025-09-12 21:34:13,497 - services.ai_service - ERROR - Error adding lead for 2347015917550: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 284, in add_lead
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO leads (phone_number, name, email, inquiry, created_at)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
            created_at = CURRENT_TIMESTAMP
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, name, email, inquiry, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 220, in generate_wallpapers_response
    self.data_manager.add_lead(phone_number, user_name, email, user_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 298, in add_lead
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 21:34:15,338 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:34:15] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:34:16,050 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 21:34:19,184 - utils.data_manager - INFO - Saved conversation for phone_number: 2347015917550, session_id: 2347015917550
2025-09-12 21:34:19,185 - services.whatsapp_service - DEBUG - Created text message payload for 2347015917550
2025-09-12 21:34:20,436 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347015917550","wa_id":"2347015917550"}],"messages":[{"id":"wamid.HBgNMjM0NzAxNTkxNzU1MBUCABEYEkVGQjJEREM3QUEwQkUyNEY3QwA="}]}
2025-09-12 21:34:20,437 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347015917550', 'wa_id': '2347015917550'}], 'messages': [{'id': 'wamid.HBgNMjM0NzAxNTkxNzU1MBUCABEYEkVGQjJEREM3QUEwQkUyNEY3QwA='}]}
2025-09-12 21:34:20,439 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:34:20] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:34:23,474 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:34:23] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:36:14,103 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:36:14] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:37:17,737 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:37:17] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:38:53,929 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:38:53] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:39:17,199 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:39:17] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:39:21,459 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:39:21] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:41:02,886 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:41:02] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:41:50,623 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:41:50] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:41:50,800 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:41:50] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:42:44,739 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:42:44] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:44:42,925 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:44:42] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:45:13,127 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:45:13] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:46:13,421 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:46:13] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:48:21,039 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348146513241. Message type: unsupported
2025-09-12 21:48:21,041 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:48:21] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:50:01,390 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:50:01] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:51:28,988 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:51:28] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:53:52,352 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:53:52] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:55:08,666 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:55:08] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:55:09,896 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:55:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:56:07,727 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 21:56:07,729 - utils.data_manager - ERROR - Error saving conversation for phone_number=2347015917550, session_id=2347015917550: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-12 21:56:07,730 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 21:56:09,014 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:56:09] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:56:11,273 - utils.data_manager - INFO - Saved conversation for phone_number: 2347015917550, session_id: 2347015917550
2025-09-12 21:56:11,274 - services.whatsapp_service - DEBUG - Created text message payload for 2347015917550
2025-09-12 21:56:12,224 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347015917550","wa_id":"2347015917550"}],"messages":[{"id":"wamid.HBgNMjM0NzAxNTkxNzU1MBUCABEYEjE3QzQxMkVFMzBFMjIzNTVFNQA="}]}
2025-09-12 21:56:12,274 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347015917550', 'wa_id': '2347015917550'}], 'messages': [{'id': 'wamid.HBgNMjM0NzAxNTkxNzU1MBUCABEYEjE3QzQxMkVFMzBFMjIzNTVFNQA='}]}
2025-09-12 21:56:12,275 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:56:12] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:56:13,469 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:56:13] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:56:13,659 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:56:13] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:57:18,336 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:57:18] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:57:52,394 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:57:52] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:57:53,075 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:57:53] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:57:53,643 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:57:53] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:58:52,874 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:58:52] "POST /webhook HTTP/1.1" 200 -
2025-09-12 21:59:41,490 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 21:59:41] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:01:15,724 - handlers.webhook_handler - INFO - Processing message from 2348101684854 (User: Elixir): {'type': 'text', 'text': 'Can I edit the foundation please'}
2025-09-12 22:01:15,725 - utils.session_manager - INFO - Session 2348101684854 timed out after 26943.45 seconds (timeout limit: 3000s). Resetting.
2025-09-12 22:01:15,725 - message_processor - INFO - Session 2348101684854: New session detected. Starting AI chat.
2025-09-12 22:01:15,726 - message_processor - INFO - Session 2348101684854: Starting AI chat for user 'Elixir' with message 'Can I edit the foundation please'.
2025-09-12 22:01:15,726 - services.whatsapp_service - DEBUG - Created image message payload for 2348101684854
2025-09-12 22:01:55,372 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:01:55] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:02:21,092 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348101684854","wa_id":"2348101684854"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMTY4NDg1NBUCABEYEjU4NjFENUUwRTdDRDQ5N0UxMQA="}]}
2025-09-12 22:02:23,248 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 22:02:23,250 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348101684854, session_id=2348101684854: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-12 22:02:23,251 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 22:02:26,533 - utils.data_manager - INFO - Saved conversation for phone_number: 2348101684854, session_id: 2348101684854
2025-09-12 22:02:26,535 - services.whatsapp_service - DEBUG - Created text message payload for 2348101684854
2025-09-12 22:02:27,559 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348101684854","wa_id":"2348101684854"}],"messages":[{"id":"wamid.HBgNMjM0ODEwMTY4NDg1NBUCABEYEjJBNDgzQkM0RDZDOUVEQUE3QwA="}]}
2025-09-12 22:02:27,561 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348101684854', 'wa_id': '2348101684854'}], 'messages': [{'id': 'wamid.HBgNMjM0ODEwMTY4NDg1NBUCABEYEjJBNDgzQkM0RDZDOUVEQUE3QwA='}]}
2025-09-12 22:02:27,562 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:02:27] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:02:29,481 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:02:29] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:09:31,708 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:09:31] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:11:14,065 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:11:14] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:11:31,193 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:11:31] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:12:29,061 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:12:29] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:42:31,295 - handlers.webhook_handler - WARNING - No valid message data extracted for 2349061112374. Message type: reaction
2025-09-12 22:42:31,296 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:42:31] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:50:46,294 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:50:46] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:59:02,919 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:59:02] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:59:23,321 - handlers.webhook_handler - INFO - Processing message from 2348053465917 (User: Callme JIGGY): {'type': 'text', 'text': 'Thank you'}
2025-09-12 22:59:23,322 - utils.session_manager - INFO - New session 2348053465917 initialized.
2025-09-12 22:59:23,323 - message_processor - INFO - Session 2348053465917: New session detected. Starting AI chat.
2025-09-12 22:59:23,324 - message_processor - INFO - Session 2348053465917: Starting AI chat for user 'Callme JIGGY' with message 'Thank you'.
2025-09-12 22:59:23,325 - services.whatsapp_service - DEBUG - Created image message payload for 2348053465917
2025-09-12 22:59:24,492 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348053465917","wa_id":"2348053465917"}],"messages":[{"id":"wamid.HBgNMjM0ODA1MzQ2NTkxNxUCABEYEkYwMUY0MUUxNTc0OTkwREVGNwA="}]}
2025-09-12 22:59:25,999 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:59:25] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:59:26,837 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 22:59:26,841 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348053465917, session_id=2348053465917: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

2025-09-12 22:59:26,848 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 22:59:29,887 - utils.data_manager - INFO - Saved conversation for phone_number: 2348053465917, session_id: 2348053465917
2025-09-12 22:59:29,888 - services.whatsapp_service - DEBUG - Created text message payload for 2348053465917
2025-09-12 22:59:30,597 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348053465917","wa_id":"2348053465917"}],"messages":[{"id":"wamid.HBgNMjM0ODA1MzQ2NTkxNxUCABEYEkY2QkEzMDk0OEI0MDFDQjdFNwA="}]}
2025-09-12 22:59:30,599 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348053465917', 'wa_id': '2348053465917'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1MzQ2NTkxNxUCABEYEkY2QkEzMDk0OEI0MDFDQjdFNwA='}]}
2025-09-12 22:59:30,601 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:59:30] "POST /webhook HTTP/1.1" 200 -
2025-09-12 22:59:33,368 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 22:59:33] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:01:49,438 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:01:49] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:06:26,811 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:06:26] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:39:27,837 - handlers.webhook_handler - WARNING - No valid message data extracted for 2348075705344. Message type: reaction
2025-09-12 23:39:27,839 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:39:27] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:42:57,923 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:42:57] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:50:26,643 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:50:26] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:50:27,402 - utils.session_manager - INFO - New session 2347018155462 initialized.
2025-09-12 23:50:27,404 - message_processor - INFO - Session 2347018155462: New session detected. Starting AI chat.
2025-09-12 23:50:27,417 - services.whatsapp_service - DEBUG - Created image message payload for 2347018155462
2025-09-12 23:50:28,628 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347018155462","wa_id":"2347018155462"}],"messages":[{"id":"wamid.HBgNMjM0NzAxODE1NTQ2MhUCABEYEkU0RkY3OTM1RjA2NkE3Rjg4RQA="}]}
2025-09-12 23:50:30,024 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:50:30] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:50:30,538 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-12 23:50:30,544 - utils.data_manager - ERROR - Error saving conversation for phone_number=2347018155462, session_id=2347018155462: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-12 23:50:30,546 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-12 23:50:34,607 - utils.data_manager - INFO - Saved conversation for phone_number: 2347018155462, session_id: 2347018155462
2025-09-12 23:50:34,608 - services.whatsapp_service - DEBUG - Created text message payload for 2347018155462
2025-09-12 23:50:36,626 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347018155462","wa_id":"2347018155462"}],"messages":[{"id":"wamid.HBgNMjM0NzAxODE1NTQ2MhUCABEYEjIzNEU3Njk3NDc5Q0YzQTI2NQA="}]}
2025-09-12 23:50:36,628 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347018155462', 'wa_id': '2347018155462'}], 'messages': [{'id': 'wamid.HBgNMjM0NzAxODE1NTQ2MhUCABEYEjIzNEU3Njk3NDc5Q0YzQTI2NQA='}]}
2025-09-12 23:50:36,631 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:50:36] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:50:40,227 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:50:40] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:51:47,822 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:51:47] "POST /webhook HTTP/1.1" 200 -
2025-09-12 23:51:49,286 - werkzeug - INFO - 127.0.0.1 - - [12/Sep/2025 23:51:49] "POST /webhook HTTP/1.1" 200 -
2025-09-13 00:14:59,078 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 00:14:59] "POST /webhook HTTP/1.1" 200 -
2025-09-13 00:23:19,025 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 00:23:19] "POST /webhook HTTP/1.1" 200 -
2025-09-13 00:23:20,672 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 00:23:20] "POST /webhook HTTP/1.1" 200 -
2025-09-13 00:35:44,298 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 00:35:44] "POST /webhook HTTP/1.1" 200 -
2025-09-13 00:35:44,891 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 00:35:44] "POST /webhook HTTP/1.1" 200 -
2025-09-13 00:51:11,175 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 00:51:11] "POST /webhook HTTP/1.1" 200 -
2025-09-13 00:55:32,795 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 00:55:32] "POST /webhook HTTP/1.1" 200 -
2025-09-13 01:41:39,219 - handlers.webhook_handler - INFO - Processing message from 2347030692861 (User: Gbolagade Wariz): {'type': 'text', 'text': 'Well received, thank you.'}
2025-09-13 01:41:39,225 - utils.session_manager - INFO - New session 2347030692861 initialized.
2025-09-13 01:41:39,231 - message_processor - INFO - Session 2347030692861: New session detected. Starting AI chat.
2025-09-13 01:41:39,233 - message_processor - INFO - Session 2347030692861: Starting AI chat for user 'Gbolagade Wariz' with message 'Well received, thank you.'.
2025-09-13 01:41:39,235 - services.whatsapp_service - DEBUG - Created image message payload for 2347030692861
2025-09-13 01:41:40,837 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347030692861","wa_id":"2347030692861"}],"messages":[{"id":"wamid.HBgNMjM0NzAzMDY5Mjg2MRUCABEYEjNCREQxNDgwQjU5RTdFNUNGNwA="}]}
2025-09-13 01:41:41,921 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 01:41:41] "POST /webhook HTTP/1.1" 200 -
2025-09-13 01:41:43,172 - httpx - INFO - HTTP Request: POST https://insig-maduyfup-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-35-turbo/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-09-13 01:41:43,191 - utils.data_manager - ERROR - Error saving conversation for phone_number=2347030692861, session_id=2347030692861: SSL connection has been closed unexpectedly
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly

2025-09-13 01:41:43,193 - services.ai_service - ERROR - Unexpected error generating Wallpaper.ng response: connection already closed
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 146, in save_conversation
    cur.execute("""
    ~~~~~~~~~~~^^^^
        INSERT INTO conversations (phone_number, session_id, user_message, assistant_response, timestamp)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        VALUES (%s, %s, %s, %s, %s)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    """, (phone_number, session_id, user_message, assistant_response, datetime.now()))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.OperationalError: SSL connection has been closed unexpectedly


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\services\ai_service.py", line 252, in generate_wallpapers_response
    self.data_manager.save_conversation(phone_number, session_id, user_message, ai_response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\wallpapers.ng\utils\data_manager.py", line 155, in save_conversation
    conn.rollback()
    ~~~~~~~~~~~~~^^
psycopg2.InterfaceError: connection already closed
2025-09-13 01:41:48,458 - utils.data_manager - INFO - Saved conversation for phone_number: 2347030692861, session_id: 2347030692861
2025-09-13 01:41:48,459 - services.whatsapp_service - DEBUG - Created text message payload for 2347030692861
2025-09-13 01:41:49,823 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2347030692861","wa_id":"2347030692861"}],"messages":[{"id":"wamid.HBgNMjM0NzAzMDY5Mjg2MRUCABEYEjExMzNCQ0VBQ0Q1RkMyMTUwNAA="}]}
2025-09-13 01:41:49,824 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2347030692861', 'wa_id': '2347030692861'}], 'messages': [{'id': 'wamid.HBgNMjM0NzAzMDY5Mjg2MRUCABEYEjExMzNCQ0VBQ0Q1RkMyMTUwNAA='}]}
2025-09-13 01:41:49,826 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 01:41:49] "POST /webhook HTTP/1.1" 200 -
2025-09-13 01:41:50,518 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 01:41:50] "POST /webhook HTTP/1.1" 200 -
2025-09-13 01:41:52,974 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 01:41:52] "POST /webhook HTTP/1.1" 200 -
2025-09-13 01:42:00,361 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 01:42:00] "POST /webhook HTTP/1.1" 200 -
2025-09-13 02:01:18,968 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 02:01:18] "POST /webhook HTTP/1.1" 200 -
2025-09-13 02:12:27,429 - werkzeug - INFO - 127.0.0.1 - - [13/Sep/2025 02:12:27] "POST /webhook HTTP/1.1" 200 -
2025-10-16 10:52:26,144 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 10:52:27,246 - __main__ - ERROR - Import error: No module named 'langchain_openai'
2025-10-16 11:03:15,018 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 11:03:15,784 - __main__ - ERROR - Import error: No module named 'langchain_openai'
2025-10-16 11:04:22,793 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 11:04:26,584 - __main__ - ERROR - Import error: No module named 'langchain'
2025-10-16 11:27:25,786 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 11:27:27,874 - __main__ - ERROR - Import error: No module named 'langchain'
2025-10-16 11:31:20,667 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 11:31:24,386 - __main__ - ERROR - Import error: No module named 'langchain_community'
2025-10-16 11:34:06,444 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 11:34:09,243 - __main__ - ERROR - Import error: No module named 'supabase'
2025-10-16 11:45:35,900 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 11:45:39,501 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 11:45:44,379 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-10-16 11:45:46,707 - utils.data_manager - INFO - Database tables created or verified successfully
2025-10-16 11:45:46,708 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-10-16 11:45:46,709 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 11:45:46,725 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 11:45:46,726 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 11:45:46,737 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 11:45:46,740 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 11:45:46,742 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 11:45:46,743 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 11:45:46,744 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 11:45:47,963 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-10-16 11:45:54,157 - utils.data_manager - INFO - Database tables created or verified successfully
2025-10-16 11:45:54,157 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 630482473482641
2025-10-16 11:45:54,158 - services.payment_service - INFO - PaymentService initialized
2025-10-16 11:45:54,158 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 11:45:54,159 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 11:45:54,159 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 11:45:54,160 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 11:45:54,203 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 11:45:54,203 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 11:47:43,237 - handlers.webhook_handler - INFO - WhatsApp webhook verified successfully!
2025-10-16 11:47:43,238 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:47:43] "GET /webhook?hub.mode=subscribe&hub.challenge=914008322&hub.verify_token=123456 HTTP/1.1" 200 -
2025-10-16 11:48:31,942 - utils.data_manager - INFO - Database connection pool closed
2025-10-16 11:48:31,943 - utils.data_manager - INFO - Database connection pool closed
2025-10-16 11:48:37,270 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 11:48:40,046 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 11:48:41,354 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-10-16 11:48:42,725 - utils.data_manager - INFO - Database tables created or verified successfully
2025-10-16 11:48:42,726 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 11:48:42,726 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 11:48:42,729 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 11:48:42,729 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 11:48:42,732 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 11:48:42,732 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 11:48:42,733 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 11:48:42,733 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 11:48:42,733 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 11:48:43,925 - utils.data_manager - INFO - Database connection pool initialized successfully
2025-10-16 11:48:45,306 - utils.data_manager - INFO - Database tables created or verified successfully
2025-10-16 11:48:45,306 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 11:48:45,307 - services.payment_service - INFO - PaymentService initialized
2025-10-16 11:48:45,307 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 11:48:45,308 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 11:48:45,308 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 11:48:45,309 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 11:48:45,321 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 11:48:45,321 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 11:48:52,519 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 11:48:52,520 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 11:48:52,521 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 11:48:52,521 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 11:48:52,522 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-10-16 11:48:54,835 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjA5NTQxQ0FBOEFBRERGMDZFRgA="}]}
2025-10-16 11:48:55,444 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-10-16 11:48:55,444 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 11:48:56,337 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:48:56] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:48:56,834 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYzQzgxMjJGMDQ2RDhDQzJGOAA="}]}
2025-10-16 11:48:56,836 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjYzQzgxMjJGMDQ2RDhDQzJGOAA='}]}
2025-10-16 11:48:56,837 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:48:56] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:48:58,074 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:48:58] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:48:58,651 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:48:58] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:48:58,765 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:48:58] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:49:16,715 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to know how cerival caner works and i want to order a kit'}
2025-10-16 11:49:16,715 - message_processor - ERROR - Session 2348055614455: Error in message routing: 'AIHandler' object has no attribute 'handle_ai_chat_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?
2025-10-16 11:49:16,728 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'I want to know how cerival caner works and i want to order a kit'.
2025-10-16 11:49:17,324 - utils.data_manager - INFO - Saved conversation for phone_number: 2348055614455, session_id: 2348055614455
2025-10-16 11:49:17,325 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 11:49:18,820 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1QjU3N0MwMjIwQjQ5RUVEQwA="}]}
2025-10-16 11:49:18,821 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE1QjU3N0MwMjIwQjQ5RUVEQwA='}]}
2025-10-16 11:49:18,822 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:49:18] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:49:19,874 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:49:19] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:49:20,305 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:49:20] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:49:22,808 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:49:22] "POST /webhook HTTP/1.1" 200 -
2025-10-16 11:52:06,089 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:52:06] "[33mPOST /api/paystack/webhook HTTP/1.1[0m" 404 -
2025-10-16 11:57:08,808 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 11:57:08] "[33mPOST /api/paystack/webhook HTTP/1.1[0m" 404 -
2025-10-16 12:00:31,847 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 12:00:31] "[33mPOST /api/paystack/webhook HTTP/1.1[0m" 404 -
2025-10-16 12:01:59,621 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 12:01:59] "[33mPOST /api/paystack/webhook HTTP/1.1[0m" 404 -
2025-10-16 12:04:03,151 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 12:04:03] "[33mPOST /api/paystack/webhook HTTP/1.1[0m" 404 -
2025-10-16 12:06:37,980 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 12:06:37] "[33mPOST /api/paystack/webhook HTTP/1.1[0m" 404 -
2025-10-16 12:07:23,622 - utils.data_manager - INFO - Database connection pool closed
2025-10-16 12:07:23,627 - utils.data_manager - INFO - Database connection pool closed
2025-10-16 12:07:26,881 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 12:07:40,102 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 12:07:41,770 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 12:07:41,771 - utils.data_manager - INFO - Assuming kit_requests, test_results, and conversations tables are pre-created in Supabase
2025-10-16 12:07:44,547 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/pg_tables?select=tablename&schemaname=eq.public "HTTP/2 404 Not Found"
2025-10-16 12:07:44,554 - utils.data_manager - ERROR - Error verifying tables: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 12:07:44,559 - utils.data_manager - ERROR - Failed to initialize Supabase client: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 38, in __init__
    self._create_tables()
    ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 12:07:44,563 - app - ERROR - Error initializing core services: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\app.py", line 38, in <module>
    data_manager = DataManager(config)
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 38, in __init__
    self._create_tables()
    ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 12:08:19,056 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 12:08:27,643 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 12:08:29,289 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 12:08:29,290 - utils.data_manager - INFO - Assuming kit_requests, test_results, and conversations tables are pre-created in Supabase
2025-10-16 12:08:31,325 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/pg_tables?select=tablename&schemaname=eq.public "HTTP/2 404 Not Found"
2025-10-16 12:08:31,329 - utils.data_manager - ERROR - Error verifying tables: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 12:08:31,334 - utils.data_manager - ERROR - Failed to initialize Supabase client: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 38, in __init__
    self._create_tables()
    ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 12:08:31,337 - app - ERROR - Error initializing core services: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\app.py", line 38, in <module>
    data_manager = DataManager(config)
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 38, in __init__
    self._create_tables()
    ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:12:49,052 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:12:53,415 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:12:53,866 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:12:53,866 - utils.data_manager - INFO - Assuming kit_requests, test_results, and conversations tables are pre-created in Supabase
2025-10-16 13:12:55,540 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/pg_tables?select=tablename&schemaname=eq.public "HTTP/2 404 Not Found"
2025-10-16 13:12:55,544 - utils.data_manager - ERROR - Error verifying tables: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:12:55,549 - utils.data_manager - ERROR - Failed to initialize Supabase client: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 38, in __init__
    self._create_tables()
    ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:12:55,551 - app - ERROR - Error initializing core services: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\app.py", line 38, in <module>
    data_manager = DataManager(config)
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 38, in __init__
    self._create_tables()
    ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 72, in _create_tables
    tables = self.supabase_client.table("pg_tables").select("tablename").eq("schemaname", "public").execute()
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.pg_tables' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:14:35,676 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:14:39,317 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:14:40,352 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:14:42,348 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:14:42,350 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:14:42,350 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:14:42,589 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:14:42,602 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:14:42,602 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:14:42,858 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:14:42,872 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:14:42,873 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:14:42,873 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:14:42,874 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 13:14:42,878 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:14:42,879 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:14:42,879 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:14:42,879 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:14:42,879 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:14:42,880 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:14:42,883 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:14:42,883 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:14:42,884 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:14:42,884 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:14:42,884 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:14:42,884 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:14:42,885 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 13:14:42,885 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 13:14:42,885 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:14:43,364 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:14:44,816 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:14:44,816 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:14:44,817 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:14:45,084 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:14:45,085 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:14:45,085 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:14:45,338 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:14:45,420 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:14:45,420 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:14:45,420 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:14:45,421 - services.payment_service - INFO - PaymentService initialized
2025-10-16 13:14:45,421 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 13:14:45,422 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 13:14:45,422 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 13:14:45,423 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 13:14:45,454 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 13:14:45,455 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 13:14:59,510 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 13:14:59,510 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 13:14:59,511 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 13:14:59,511 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:14:59,512 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-10-16 13:15:01,037 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-10-16 13:15:01,707 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations "HTTP/2 404 Not Found"
2025-10-16 13:15:01,724 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348055614455, session_id=2348055614455: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:15:01,727 - message_processor - ERROR - Session 2348055614455: Error in message routing: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 83, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 118, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 189, in _handle_ai_chat_start
    self.data_manager.save_conversation(phone_number, session_id, "", welcome_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:15:01,728 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:15:01,729 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:15:02,854 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 401 Client Error: Unauthorized for url: https://graph.facebook.com/v17.0/204426689424598/messages - Response: No response
2025-10-16 13:15:02,856 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:15:02] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:15:42,064 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:15:45,120 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:15:45,708 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:15:46,919 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:15:46,920 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:15:46,920 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:15:47,145 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:15:47,161 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:15:47,162 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:15:47,392 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:15:47,403 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:15:47,403 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:15:47,403 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:15:47,404 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 13:15:47,408 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:15:47,408 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:15:47,408 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:15:47,408 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:15:47,408 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:15:47,409 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:15:47,412 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:15:47,412 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:15:47,412 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:15:47,412 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:15:47,413 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:15:47,413 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:15:47,413 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 13:15:47,413 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 13:15:47,413 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:15:47,916 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:15:49,197 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:15:49,197 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:15:49,198 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:15:49,446 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:15:49,462 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:15:49,462 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:15:49,734 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:15:49,734 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:15:49,734 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:15:49,735 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:15:49,735 - services.payment_service - INFO - PaymentService initialized
2025-10-16 13:15:49,736 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 13:15:49,736 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 13:15:49,736 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 13:15:49,737 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 13:15:49,753 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 13:15:49,754 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 13:16:00,573 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 13:16:00,574 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 13:16:00,574 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 13:16:00,575 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:16:00,576 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-10-16 13:16:02,105 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjlCQjhDRjY2MTQ3NEEwNDEwRQA="}]}
2025-10-16 13:16:02,591 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations "HTTP/2 404 Not Found"
2025-10-16 13:16:02,592 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348055614455, session_id=2348055614455: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:16:02,594 - message_processor - ERROR - Session 2348055614455: Error in message routing: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 83, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 118, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 189, in _handle_ai_chat_start
    self.data_manager.save_conversation(phone_number, session_id, "", welcome_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:16:02,595 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:16:02,595 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:16:03,885 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE5REI4QzU3M0U0QTUwREFCNwA="}]}
2025-10-16 13:16:03,886 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE5REI4QzU3M0U0QTUwREFCNwA='}]}
2025-10-16 13:16:03,887 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:03] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:05,183 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:05] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:05,393 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:05] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:07,398 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:07] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:10,715 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:10] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:14,351 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to know how cerival caner works and i want to\xa0order\xa0a\xa0kit'}
2025-10-16 13:16:14,351 - message_processor - ERROR - Session 2348055614455: Error in message routing: 'AIHandler' object has no attribute 'handle_ai_chat_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?
2025-10-16 13:16:14,354 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'I want to know how cerival caner works and i want to order a kit'.
2025-10-16 13:16:14,814 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations "HTTP/2 404 Not Found"
2025-10-16 13:16:14,830 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348055614455, session_id=2348055614455: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:16:14,833 - message_processor - ERROR - Session 2348055614455: Error processing message: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 46, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 108, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 118, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 186, in _handle_ai_chat_start
    return self._process_user_question(state, session_id, user_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 285, in _process_user_question
    self.data_manager.save_conversation(phone_number, session_id, user_message, error_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:16:14,836 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:16:16,662 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0M0ZGMzZCMzNFOTRGNTI3NAA="}]}
2025-10-16 13:16:16,664 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0M0ZGMzZCMzNFOTRGNTI3NAA='}]}
2025-10-16 13:16:16,665 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:16] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:17,923 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:17] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:18,174 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:18] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:18,176 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:18] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:27,533 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to know how cerival caner works and i want to\xa0order\xa0a\xa0kit'}
2025-10-16 13:16:27,533 - message_processor - ERROR - Session 2348055614455: Error in message routing: 'AIHandler' object has no attribute 'handle_ai_chat_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?
2025-10-16 13:16:27,535 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'I want to know how cerival caner works and i want to order a kit'.
2025-10-16 13:16:28,213 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations "HTTP/2 404 Not Found"
2025-10-16 13:16:28,231 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348055614455, session_id=2348055614455: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:16:28,234 - message_processor - ERROR - Session 2348055614455: Error processing message: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 46, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 108, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 118, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 186, in _handle_ai_chat_start
    return self._process_user_question(state, session_id, user_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 285, in _process_user_question
    self.data_manager.save_conversation(phone_number, session_id, user_message, error_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:16:28,237 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:16:29,643 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhFNEVBREE0RUUxMUZBNkYxMQA="}]}
2025-10-16 13:16:29,647 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjhFNEVBREE0RUUxMUZBNkYxMQA='}]}
2025-10-16 13:16:29,650 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:29] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:30,735 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:30] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:31,214 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:31] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:16:31,218 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:16:31] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:17:03,998 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'How do i find a screening kit?'}
2025-10-16 13:17:03,998 - message_processor - ERROR - Session 2348055614455: Error in message routing: 'AIHandler' object has no attribute 'handle_ai_chat_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?
2025-10-16 13:17:04,000 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'How do i find a screening kit?'.
2025-10-16 13:17:04,503 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations "HTTP/2 404 Not Found"
2025-10-16 13:17:04,520 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348055614455, session_id=2348055614455: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:17:04,522 - message_processor - ERROR - Session 2348055614455: Error processing message: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 46, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 108, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 118, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 186, in _handle_ai_chat_start
    return self._process_user_question(state, session_id, user_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 285, in _process_user_question
    self.data_manager.save_conversation(phone_number, session_id, user_message, error_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:17:04,524 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:17:05,991 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQxQkUzQ0VGODNCMEZEMzg4NAA="}]}
2025-10-16 13:17:05,993 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkQxQkUzQ0VGODNCMEZEMzg4NAA='}]}
2025-10-16 13:17:05,994 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:17:05] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:17:07,100 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:17:07] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:17:07,602 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:17:07] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:17:07,663 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:17:07] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:17:07,744 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:17:07] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:22:45,227 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 13:22:45,227 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 13:22:45,228 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:22:45,228 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:22:46,595 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3MzQ2NEMxMTk5RUFDNDQ0QgA="}]}
2025-10-16 13:22:46,597 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE3MzQ2NEMxMTk5RUFDNDQ0QgA='}]}
2025-10-16 13:22:46,597 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:22:46] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:22:47,570 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:22:47] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:22:48,366 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:22:48] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:09,917 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:23:13,473 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:23:14,120 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:23:15,538 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:23:15,539 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:23:15,539 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:23:15,773 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:23:15,785 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:23:15,785 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:23:16,004 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:23:16,014 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:23:16,014 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:23:16,015 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:23:16,016 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 13:23:16,021 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:23:16,021 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:23:16,021 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:23:16,022 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:23:16,022 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:23:16,022 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:23:16,028 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:23:16,028 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:23:16,028 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:23:16,029 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:23:16,029 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:23:16,029 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:23:16,029 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 13:23:16,030 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 13:23:16,030 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:23:16,388 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:23:17,240 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:23:17,241 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:23:17,241 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:23:17,472 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:23:17,484 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:23:17,484 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:23:17,727 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:23:17,745 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:23:17,745 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:23:17,746 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:23:17,746 - services.payment_service - INFO - PaymentService initialized
2025-10-16 13:23:17,746 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 13:23:17,747 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 13:23:17,747 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 13:23:17,748 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 13:23:17,762 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 13:23:17,763 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 13:23:21,858 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:21] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:24,816 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 13:23:24,817 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 13:23:24,817 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 13:23:24,817 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:23:24,819 - services.whatsapp_service - DEBUG - Created image message payload for 2348055614455
2025-10-16 13:23:26,335 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRFOTVGNkJERDg5QUQ3OUEzRAA="}]}
2025-10-16 13:23:26,784 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations "HTTP/2 404 Not Found"
2025-10-16 13:23:26,803 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348055614455, session_id=2348055614455: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:23:26,816 - message_processor - ERROR - Session 2348055614455: Error in message routing: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 83, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 118, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 189, in _handle_ai_chat_start
    self.data_manager.save_conversation(phone_number, session_id, "", welcome_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:23:26,818 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:23:26,818 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:23:26,904 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:26] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:28,285 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRBQUE4NzA4NDdDQUIxOEE0RAA="}]}
2025-10-16 13:23:28,287 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRBQUE4NzA4NDdDQUIxOEE0RAA='}]}
2025-10-16 13:23:28,288 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:28] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:29,463 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:29] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:29,987 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:29] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:30,086 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:30] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:30,557 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:30] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:37,124 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to know how cerival caner works and i want to\xa0order\xa0a\xa0kit'}
2025-10-16 13:23:37,127 - message_processor - ERROR - Session 2348055614455: Error in message routing: 'AIHandler' object has no attribute 'handle_ai_chat_state'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?
2025-10-16 13:23:37,133 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'I want to know how cerival caner works and i want to order a kit'.
2025-10-16 13:23:37,640 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations "HTTP/2 404 Not Found"
2025-10-16 13:23:37,655 - utils.data_manager - ERROR - Error saving conversation for phone_number=2348055614455, session_id=2348055614455: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:23:37,658 - message_processor - ERROR - Session 2348055614455: Error processing message: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 93, in _route_to_handler
    return self.ai_handler.handle_ai_chat_state(state, message, original_message, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AIHandler' object has no attribute 'handle_ai_chat_state'. Did you mean: 'handle_ai_menu_state'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 46, in process_message
    response = self._route_to_handler(state, message, original_message, session_id, user_name)
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 108, in _route_to_handler
    return self._start_ai_chat(state, session_id, user_name, original_message)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 118, in _start_ai_chat
    return self.ai_handler._handle_ai_chat_start(state, session_id, original_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 186, in _handle_ai_chat_start
    return self._process_user_question(state, session_id, user_message)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 285, in _process_user_question
    self.data_manager.save_conversation(phone_number, session_id, user_message, error_message)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\utils\data_manager.py", line 139, in save_conversation
    }).execute()
       ~~~~~~~^^
  File "C:\Users\zigam\AppData\Local\Programs\Python\Python313\Lib\site-packages\postgrest\_sync\request_builder.py", line 64, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}
2025-10-16 13:23:37,661 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:23:39,025 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4NTNBQzkwMkQ3Q0ZBRjI1QQA="}]}
2025-10-16 13:23:39,026 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc4NTNBQzkwMkQ3Q0ZBRjI1QQA='}]}
2025-10-16 13:23:39,027 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:39] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:40,074 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:40] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:23:40,627 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:23:40] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:04,534 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:31:05,732 - __main__ - ERROR - Unexpected error: name 'BaseHandler' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\run.py", line 187, in main
    from app import app
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\app.py", line 7, in <module>
    from handlers.webhook_handler import WebhookHandler
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\webhook_handler.py", line 10, in <module>
    from message_processor import MessageProcessor
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\message_processor.py", line 4, in <module>
    from handlers.ai_handler import AIHandler
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 1, in <module>
    class AIHandler(BaseHandler):
                    ^^^^^^^^^^^
NameError: name 'BaseHandler' is not defined
2025-10-16 13:31:23,313 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:31:25,872 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:31:26,289 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:31:27,339 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:31:27,340 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:31:27,340 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:31:27,578 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:31:27,609 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:31:27,609 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:31:27,830 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:31:27,847 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:31:27,847 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:31:27,848 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:31:27,848 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 13:31:27,851 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:31:27,852 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:31:27,852 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:31:27,852 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:31:27,853 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:31:27,853 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:31:27,856 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:31:27,856 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:31:27,857 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:31:27,857 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:31:27,857 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:31:27,857 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:31:27,858 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 13:31:27,858 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 13:31:27,858 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:31:28,248 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:31:29,095 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:31:29,096 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:31:29,096 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:31:29,325 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:31:29,339 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:31:29,339 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:31:29,574 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:31:29,577 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:31:29,578 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:31:29,578 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:31:29,579 - services.payment_service - INFO - PaymentService initialized
2025-10-16 13:31:29,579 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 13:31:29,579 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 13:31:29,580 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 13:31:29,580 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 13:31:29,601 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 13:31:29,601 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 13:31:34,060 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 13:31:34,061 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 13:31:34,062 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 13:31:34,062 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:31:34,063 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:31:34,064 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-10-16 13:31:35,400 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM0RjcyRjMwRkJFRTJDOEZBQQA="}]}
2025-10-16 13:31:35,401 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM0RjcyRjMwRkJFRTJDOEZBQQA='}]}
2025-10-16 13:31:35,402 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:35] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:36,480 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:36] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:36,960 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:36] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:43,546 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:43] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:48,490 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to know how cerival caner works and i want to\xa0order\xa0a\xa0kit'}
2025-10-16 13:31:48,491 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 13:31:48,491 - handlers.ai_handler - INFO - Processing question for 2348055614455: I want to know how cerival caner works and i want to order a kit
2025-10-16 13:31:48,492 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:31:48,492 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Sorry, the AI chat feature is currently unavailable. Please contact a health provider directly.'}}
2025-10-16 13:31:50,121 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0RDIxREZENjRGQzlEM0I2NwA="}]}
2025-10-16 13:31:50,124 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjk0RDIxREZENjRGQzlEM0I2NwA='}]}
2025-10-16 13:31:50,124 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:50] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:51,256 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:51] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:51,817 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:51] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:51,861 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:51] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:31:51,864 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:31:51] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:27,904 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:43:32,006 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:43:32,620 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:43:34,114 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:43:34,120 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:43:34,120 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:43:34,348 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:43:34,355 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:43:34,355 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:43:34,580 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:43:34,590 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:43:34,590 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:43:34,591 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:43:34,591 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 13:43:34,595 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:43:34,595 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:43:34,595 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:43:34,596 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:43:34,596 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:43:34,596 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:43:34,602 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:43:34,602 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:43:34,603 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:43:34,603 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:43:34,604 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:43:34,605 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:43:34,606 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 13:43:34,606 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 13:43:34,606 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:43:35,001 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:43:36,085 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:43:36,086 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:43:36,086 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:43:36,333 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:43:36,349 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:43:36,349 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:43:36,623 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:43:36,623 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:43:36,624 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:43:36,624 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:43:36,624 - services.payment_service - INFO - PaymentService initialized
2025-10-16 13:43:36,625 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 13:43:36,625 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 13:43:36,626 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 13:43:36,626 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 13:43:36,642 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 13:43:36,643 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 13:43:39,141 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 13:43:39,142 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 13:43:39,142 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 13:43:39,143 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:43:39,144 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:43:39,145 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-10-16 13:43:40,742 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUzREJBMTQ0NkZCRDJGQzk3NAA="}]}
2025-10-16 13:43:40,744 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjUzREJBMTQ0NkZCRDJGQzk3NAA='}]}
2025-10-16 13:43:40,745 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:40] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:42,122 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:42] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:42,389 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:42] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:42,552 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:42] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:50,010 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to know how cerival caner works and i want to\xa0order\xa0a\xa0kit'}
2025-10-16 13:43:50,011 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 13:43:50,011 - handlers.ai_handler - INFO - Processing question for 2348055614455: I want to know how cerival caner works and i want to order a kit
2025-10-16 13:43:50,012 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:43:50,012 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Sorry, the AI chat feature is currently unavailable. Please contact a health provider directly.'}}
2025-10-16 13:43:51,218 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {"messaging_product":"whatsapp","contacts":[{"input":"2348055614455","wa_id":"2348055614455"}],"messages":[{"id":"wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY0RTM3NEQyNDRDRTYxNjM1NAA="}]}
2025-10-16 13:43:51,219 - services.whatsapp_service - ERROR - Missing 'to' parameter in payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY0RTM3NEQyNDRDRTYxNjM1NAA='}]}
2025-10-16 13:43:51,220 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:51] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:52,530 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:52] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:52,762 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:52] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:43:52,939 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:43:52] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:44:38,505 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 13:44:41,384 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:44:41,905 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:44:43,059 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:44:43,060 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:44:43,060 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:44:43,306 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:44:43,318 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:44:43,318 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:44:43,550 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:44:43,558 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:44:43,558 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:44:43,559 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:44:43,559 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 13:44:43,563 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:44:43,563 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:44:43,563 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:44:43,564 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:44:43,564 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:44:43,564 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:44:43,568 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 13:44:43,569 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 13:44:43,569 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 13:44:43,569 - services.ai_service - INFO - AI Enabled: False
2025-10-16 13:44:43,570 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 13:44:43,570 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 13:44:43,570 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 13:44:43,570 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 13:44:43,570 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 13:44:44,006 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 13:44:45,164 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:44:45,165 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'message': "Could not find the table 'public.kit_requests' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:44:45,165 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:44:45,393 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:44:45,409 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'message': "Could not find the table 'public.test_results' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:44:45,409 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 13:44:45,638 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 13:44:45,656 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'message': "Could not find the table 'public.conversations' in the schema cache", 'code': 'PGRST205', 'hint': None, 'details': None}. Please create it in the Supabase dashboard.
2025-10-16 13:44:45,656 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 13:44:45,657 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 13:44:45,657 - services.payment_service - INFO - PaymentService initialized
2025-10-16 13:44:45,657 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 13:44:45,658 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 13:44:45,658 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 13:44:45,659 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 13:44:45,673 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 13:44:45,673 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 13:44:52,310 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 13:44:52,310 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 13:44:52,311 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 13:44:52,311 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 13:44:52,312 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:44:52,312 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-10-16 13:44:53,569 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRFODY1NkQyRjgzRkI2N0Q0RgA='}]}
2025-10-16 13:44:53,571 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRFODY1NkQyRjgzRkI2N0Q0RgA='}]}
2025-10-16 13:44:53,572 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:44:53] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:44:54,891 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:44:54] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:44:55,356 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:44:55] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:44:56,190 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:44:56] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:44:58,770 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I want to know how cerival caner works and i want to\xa0order\xa0a\xa0kit'}
2025-10-16 13:44:58,770 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 13:44:58,771 - handlers.ai_handler - INFO - Processing question for 2348055614455: I want to know how cerival caner works and i want to order a kit
2025-10-16 13:44:58,771 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 13:44:58,772 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Sorry, the AI chat feature is currently unavailable. Please contact a health provider directly.'}}
2025-10-16 13:45:00,050 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3M0Y4RjM2RkI4NTk4QkI0QwA='}]}
2025-10-16 13:45:00,052 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkI3M0Y4RjM2RkI4NTk4QkI0QwA='}]}
2025-10-16 13:45:00,053 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:45:00] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:45:01,190 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:45:01] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:45:01,731 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:45:01] "POST /webhook HTTP/1.1" 200 -
2025-10-16 13:45:03,905 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 13:45:03] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:26:30,255 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 14:26:30,263 - __main__ - ERROR - Import error: No module named 'flask'
2025-10-16 14:30:35,792 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 14:30:35,798 - __main__ - ERROR - Import error: No module named 'flask'
2025-10-16 14:34:39,996 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 14:34:44,800 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:34:45,344 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:34:46,782 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:34:46,782 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:34:46,782 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:34:47,006 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:34:47,026 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:34:47,027 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:34:47,238 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:34:47,253 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:34:47,253 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:34:47,253 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:34:47,253 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 14:34:47,272 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 14:34:47,273 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 14:34:47,273 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 14:34:47,273 - services.ai_service - INFO - AI Enabled: False
2025-10-16 14:34:47,273 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 14:34:47,273 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 14:34:47,278 - services.ai_service - INFO - Configuration check - Supabase URL: missing
2025-10-16 14:34:47,278 - services.ai_service - INFO - Configuration check - Supabase Key: missing
2025-10-16 14:34:47,278 - services.ai_service - INFO - Configuration check - OpenAI API Key: missing
2025-10-16 14:34:47,278 - services.ai_service - INFO - AI Enabled: False
2025-10-16 14:34:47,278 - services.ai_service - WARNING - AI features disabled - missing Supabase or OpenAI configuration.
2025-10-16 14:34:47,282 - handlers.ai_handler - WARNING - AIHandler: AI features disabled as AIService could not be initialized.
2025-10-16 14:34:47,282 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 14:34:47,282 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 14:34:47,283 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:34:47,746 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:34:49,018 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:34:49,020 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:34:49,020 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:34:49,260 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:34:49,278 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:34:49,278 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:34:49,524 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:34:49,532 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:34:49,532 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:34:49,532 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:34:49,532 - services.payment_service - INFO - PaymentService initialized
2025-10-16 14:34:49,532 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 14:34:49,539 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 14:34:49,540 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 14:34:49,540 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 14:34:49,577 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 14:34:49,579 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 14:35:03,846 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 14:35:03,846 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 14:35:03,846 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 14:35:03,846 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 14:35:03,846 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:35:03,846 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-10-16 14:35:05,018 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE1NzY3MkE2MTdGQjc4QjVGMQA='}]}
2025-10-16 14:35:05,020 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkE1NzY3MkE2MTdGQjc4QjVGMQA='}]}
2025-10-16 14:35:05,022 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:05] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:35:06,200 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:06] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:35:06,712 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:06] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:35:15,947 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:15] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:35:16,882 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What is cervical screening?'}
2025-10-16 14:35:16,883 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 14:35:16,884 - handlers.ai_handler - INFO - Processing question for 2348055614455: What is cervical screening?
2025-10-16 14:35:16,887 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:35:16,890 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Sorry, the AI chat feature is currently unavailable. Please contact a health provider directly.'}}
2025-10-16 14:35:18,162 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1QjEwMEU3NEZGN0Q0NjExNAA='}]}
2025-10-16 14:35:18,178 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjI1QjEwMEU3NEZGN0Q0NjExNAA='}]}
2025-10-16 14:35:18,178 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:18] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:35:19,119 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:19] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:35:19,723 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:19] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:35:19,852 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:35:19] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:42:31,424 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 14:42:38,781 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:42:39,589 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:42:41,235 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:42:41,235 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:42:41,235 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:42:41,489 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:42:41,504 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:42:41,504 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:42:41,731 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:42:41,744 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:42:41,744 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:42:41,744 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:42:41,744 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 14:42:41,759 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 14:42:41,759 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 14:42:41,759 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 14:42:41,759 - services.ai_service - INFO - AI Enabled: True
2025-10-16 14:42:42,360 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 14:42:43,838 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 14:42:45,581 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 14:42:45,581 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 14:42:45,600 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 14:42:45,600 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 14:42:45,600 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 14:42:45,600 - services.ai_service - INFO - AI Enabled: True
2025-10-16 14:42:46,381 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 14:42:47,900 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 14:42:49,077 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 14:42:49,077 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 14:42:49,077 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 14:42:49,077 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 14:42:49,077 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:42:49,846 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:42:51,512 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:42:51,517 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:42:51,517 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:42:51,748 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:42:51,748 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:42:51,764 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:42:52,017 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:42:52,033 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:42:52,033 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:42:52,033 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:42:52,033 - services.payment_service - INFO - PaymentService initialized
2025-10-16 14:42:52,046 - app - ERROR - Error initializing WebhookHandler: 'Config' object has no attribute 'DB_NAME'
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\app.py", line 68, in <module>
    webhook_handler = WebhookHandler(config, message_processor)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\webhook_handler.py", line 37, in __init__
    self.payment_handler = PaymentHandler(
                           ^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\payment_handler.py", line 30, in __init__
    self.product_sync_handler = product_sync_handler or ProductSyncHandler(config)
                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\product_sync_handler.py", line 27, in __init__
    'dbname': self.config.DB_NAME,
              ^^^^^^^^^^^^^^^^^^^
AttributeError: 'Config' object has no attribute 'DB_NAME'
2025-10-16 14:45:55,668 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 14:46:00,134 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:46:00,706 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:46:01,739 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:46:01,739 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:46:01,739 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:46:01,980 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:46:01,993 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:46:01,993 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:46:02,239 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:46:02,239 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:46:02,239 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:46:02,254 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:46:02,255 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 14:46:02,260 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 14:46:02,261 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 14:46:02,261 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 14:46:02,261 - services.ai_service - INFO - AI Enabled: True
2025-10-16 14:46:02,706 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 14:46:03,640 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 14:46:04,638 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 14:46:04,638 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 14:46:04,638 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 14:46:04,638 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 14:46:04,638 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 14:46:04,638 - services.ai_service - INFO - AI Enabled: True
2025-10-16 14:46:05,131 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 14:46:06,054 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 14:46:07,004 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 14:46:07,004 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 14:46:07,004 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 14:46:07,004 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 14:46:07,004 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:46:07,495 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:46:08,470 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:46:08,470 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:46:08,470 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:46:08,703 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:46:08,723 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:46:08,724 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:46:08,953 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:46:08,953 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:46:08,953 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:46:08,953 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:46:08,953 - services.payment_service - INFO - PaymentService initialized
2025-10-16 14:46:08,953 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 14:46:08,953 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 14:46:08,953 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 14:46:08,953 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 14:46:08,989 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 14:46:08,989 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 14:47:00,123 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 14:47:00,123 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 14:47:00,125 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 14:47:00,125 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 14:47:00,127 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:47:00,128 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-10-16 14:47:01,105 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1NzBERjYyNTQxNjA0NUFFMAA='}]}
2025-10-16 14:47:01,105 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjM1NzBERjYyNTQxNjA0NUFFMAA='}]}
2025-10-16 14:47:01,105 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:47:01] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:47:02,224 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:47:02] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:47:02,806 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:47:02] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:48:33,922 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:48:33] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:48:38,108 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What is cervical screening?'}
2025-10-16 14:48:38,109 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 14:48:38,109 - handlers.ai_handler - INFO - Processing question for 2348055614455: What is cervical screening?
2025-10-16 14:48:38,109 - handlers.ai_handler - INFO - Calling AI service for message: What is cervical screening?
2025-10-16 14:48:38,109 - services.ai_service - INFO - Generating medical response for: What is cervical screening?
2025-10-16 14:48:39,343 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-16 14:48:39,453 - services.ai_service - INFO - Retrieving documents for query: cervical screening
2025-10-16 14:48:41,294 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-10-16 14:48:43,693 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/rpc/match_documents?limit=3 "HTTP/2 200 OK"
2025-10-16 14:48:43,704 - services.ai_service - INFO - Retrieved 3 documents
2025-10-16 14:48:44,888 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-16 14:48:45,998 - services.ai_service - INFO - Generated response: Cervical screening is a test designed to detect early abnormal changes in the cervix, which can help
2025-10-16 14:48:45,998 - handlers.ai_handler - INFO - AI response generated: Cervical screening is a test designed to detect early abnormal changes in the cervix, which can help
2025-10-16 14:48:45,998 - handlers.ai_handler - ERROR - Error processing user question for session 2348055614455: name 'datetime' is not defined
Traceback (most recent call last):
  File "C:\Users\zigam\Documents\Coding\Pentanative\kenya-ai\handlers\ai_handler.py", line 234, in _process_user_question
    "timestamp": datetime.now().isoformat()
                 ^^^^^^^^
NameError: name 'datetime' is not defined. Did you forget to import 'datetime'
2025-10-16 14:48:45,998 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:48:45,998 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I'm having trouble processing your request right now. Please contact a health provider directly."}}
2025-10-16 14:48:47,045 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY4OTIyRDdGRUVGRTk5ODNBQgA='}]}
2025-10-16 14:48:47,045 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY4OTIyRDdGRUVGRTk5ODNBQgA='}]}
2025-10-16 14:48:47,045 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:48:47] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:48:48,131 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:48:48] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:48:48,594 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:48:48] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:48:48,774 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:48:48] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:52:38,548 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 14:52:45,016 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:52:45,835 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:52:47,104 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:52:47,104 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:52:47,104 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:52:47,333 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:52:47,350 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:52:47,350 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:52:47,569 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:52:47,591 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:52:47,591 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:52:47,593 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:52:47,594 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 14:52:47,606 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 14:52:47,607 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 14:52:47,607 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 14:52:47,607 - services.ai_service - INFO - AI Enabled: True
2025-10-16 14:52:48,260 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 14:52:49,880 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 14:52:51,410 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 14:52:51,410 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 14:52:51,423 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 14:52:51,423 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 14:52:51,423 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 14:52:51,423 - services.ai_service - INFO - AI Enabled: True
2025-10-16 14:52:52,106 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 14:52:53,499 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 14:52:55,013 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 14:52:55,013 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 14:52:55,013 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 14:52:55,013 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 14:52:55,013 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 14:52:55,710 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 14:52:56,915 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:52:56,915 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:52:56,915 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:52:57,153 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:52:57,153 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:52:57,153 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 14:52:57,381 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 14:52:57,393 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 14:52:57,393 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 14:52:57,393 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 14:52:57,393 - services.payment_service - INFO - PaymentService initialized
2025-10-16 14:52:57,393 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 14:52:57,393 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 14:52:57,393 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 14:52:57,393 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 14:52:57,429 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 14:52:57,429 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 14:52:58,856 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-10-16 14:52:58,856 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-10-16 14:52:58,856 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-10-16 14:52:58,856 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-10-16 14:52:58,856 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:52:58,856 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-10-16 14:52:59,916 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5OUUwMDU2OEM1RTNERDgxMwA='}]}
2025-10-16 14:52:59,916 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjQ5OUUwMDU2OEM1RTNERDgxMwA='}]}
2025-10-16 14:52:59,916 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:52:59] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:01,190 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:01] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:01,514 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:01] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:01,683 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:01] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:05,714 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'What is cervical screening?'}
2025-10-16 14:53:05,715 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 14:53:05,715 - handlers.ai_handler - INFO - Processing question for 2348055614455: What is cervical screening?
2025-10-16 14:53:05,715 - handlers.ai_handler - INFO - Calling AI service for message: What is cervical screening?
2025-10-16 14:53:05,715 - services.ai_service - INFO - Generating medical response for: What is cervical screening?
2025-10-16 14:53:07,189 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-16 14:53:07,387 - services.ai_service - INFO - Retrieving documents for query: cervical screening
2025-10-16 14:53:08,362 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-10-16 14:53:09,535 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/rpc/match_documents?limit=3 "HTTP/2 200 OK"
2025-10-16 14:53:09,535 - services.ai_service - INFO - Retrieved 3 documents
2025-10-16 14:53:10,091 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-16 14:53:11,273 - services.ai_service - INFO - Generated response: Cervical screening is a test designed to detect early abnormal changes in the cervix, helping to pre
2025-10-16 14:53:11,273 - handlers.ai_handler - INFO - AI response generated: Cervical screening is a test designed to detect early abnormal changes in the cervix, helping to pre
2025-10-16 14:53:11,273 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:53:12,220 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJEQzk2MEMzREMxNTFFNUY3OQA='}]}
2025-10-16 14:53:12,220 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkJEQzk2MEMzREMxNTFFNUY3OQA='}]}
2025-10-16 14:53:12,220 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:12] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:13,323 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:13] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:13,866 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:13] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:14,903 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:14] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:26,712 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'How can i get a kit?'}
2025-10-16 14:53:26,713 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 14:53:26,714 - handlers.ai_handler - INFO - Processing question for 2348055614455: How can i get a kit?
2025-10-16 14:53:26,714 - handlers.ai_handler - INFO - Calling AI service for message: How can i get a kit?
2025-10-16 14:53:26,714 - services.ai_service - INFO - Prompting for missing kit request info: ['your area or county'] for phone_number=2348055614455
2025-10-16 14:53:26,714 - handlers.ai_handler - INFO - Transitioning to kit_request_collection state for 2348055614455
2025-10-16 14:53:26,722 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:53:27,948 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2OEI1NkI1QkQzNjkzRTE2RQA='}]}
2025-10-16 14:53:27,948 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY2OEI1NkI1QkQzNjkzRTE2RQA='}]}
2025-10-16 14:53:27,948 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:27] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:28,912 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:28] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:29,698 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:29] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:29,733 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:29] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:30,004 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:30] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:51,765 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'I am in nairobi'}
2025-10-16 14:53:51,765 - handlers.ai_handler - INFO - Handling kit request collection for session 2348055614455: location=None, name=Ziga
2025-10-16 14:53:51,765 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:53:51,765 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Thank you, Ziga! Your request for a cervical screening kit in nairobi has been received.\nA Community Health Worker will contact you soon to arrange delivery. Anything else I can help with?'}}
2025-10-16 14:53:52,995 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2Qzk5Nzg4NzkyNThCMUQ2MwA='}]}
2025-10-16 14:53:52,995 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjE2Qzk5Nzg4NzkyNThCMUQ2MwA='}]}
2025-10-16 14:53:52,995 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:52] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:54,111 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:54] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:54,650 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:54] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:53:54,675 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:53:54] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:54:31,571 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Yes            "Why should I get screened for cervical cancer?",'}
2025-10-16 14:54:31,571 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-10-16 14:54:31,572 - handlers.ai_handler - INFO - Processing question for 2348055614455: Yes            "Why should I get screened for cervical cancer?",
2025-10-16 14:54:31,572 - handlers.ai_handler - INFO - Calling AI service for message: Yes            "Why should I get screened for cervical cancer?",
2025-10-16 14:54:31,572 - services.ai_service - INFO - Generating medical response for: Yes            "Why should I get screened for cervical cancer?",
2025-10-16 14:54:32,714 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-16 14:54:33,005 - services.ai_service - INFO - Retrieving documents for query: Why should I get screened for cervical cancer?
2025-10-16 14:54:33,556 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-10-16 14:54:34,556 - httpx - INFO - HTTP Request: POST https://syoesccpepohqjmkougg.supabase.co/rest/v1/rpc/match_documents?limit=3 "HTTP/2 200 OK"
2025-10-16 14:54:34,556 - services.ai_service - INFO - Retrieved 3 documents
2025-10-16 14:54:35,319 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-16 14:54:37,533 - services.ai_service - INFO - Generated response: Getting screened for cervical cancer is crucial because it helps detect early abnormal changes in th
2025-10-16 14:54:37,533 - handlers.ai_handler - INFO - AI response generated: Getting screened for cervical cancer is crucial because it helps detect early abnormal changes in th
2025-10-16 14:54:37,533 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-10-16 14:54:38,597 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNFRTBFNzY4RjE5Q0Y3N0JFRAA='}]}
2025-10-16 14:54:38,602 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkNFRTBFNzY4RjE5Q0Y3N0JFRAA='}]}
2025-10-16 14:54:38,602 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:54:38] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:54:39,701 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:54:39] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:54:40,172 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:54:40] "POST /webhook HTTP/1.1" 200 -
2025-10-16 14:54:40,389 - werkzeug - INFO - 127.0.0.1 - - [16/Oct/2025 14:54:40] "POST /webhook HTTP/1.1" 200 -
2025-10-16 15:40:25,816 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-10-16 15:40:48,844 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-10-16 15:41:37,450 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 15:41:41,437 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 15:41:41,891 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 15:41:43,234 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 15:41:43,246 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 15:41:43,249 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 15:41:43,488 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 15:41:43,488 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 15:41:43,488 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 15:41:43,733 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 15:41:43,749 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 15:41:43,751 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 15:41:43,751 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 15:41:43,752 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 15:41:43,755 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 15:41:43,756 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 15:41:43,767 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 15:41:43,767 - services.ai_service - INFO - AI Enabled: True
2025-10-16 15:41:44,188 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 15:41:44,976 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 15:41:45,926 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 15:41:45,926 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 15:41:45,935 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 15:41:45,936 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 15:41:45,936 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 15:41:45,937 - services.ai_service - INFO - AI Enabled: True
2025-10-16 15:41:46,426 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 15:41:47,259 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 15:41:48,176 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 15:41:48,176 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 15:41:48,176 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 15:41:48,176 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 15:41:48,176 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 15:41:48,586 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 15:41:49,633 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 15:41:49,633 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 15:41:49,633 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 15:41:49,866 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 15:41:49,882 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 15:41:49,882 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 15:41:50,103 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 15:41:50,103 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 15:41:50,103 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 15:41:50,103 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 15:41:50,103 - services.payment_service - INFO - PaymentService initialized
2025-10-16 15:41:50,103 - handlers.payment_handler - WARNING - FeedbackHandler not provided, feedback collection will be manual
2025-10-16 15:41:50,103 - handlers.payment_handler - INFO - ProductSyncHandler successfully provided to PaymentHandler
2025-10-16 15:41:50,103 - handlers.payment_handler - INFO - PaymentHandler initialized with subaccount ACCT_iwv6csej0ra4k7g, split percentage 1%, merchant phone 2347082345056
2025-10-16 15:41:50,103 - app - INFO - WebhookHandler initialized with message processor.
2025-10-16 15:41:50,126 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-10-16 15:41:50,126 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-16 16:43:46,298 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 16:43:50,704 - __main__ - ERROR - Import error: No module named 'handlers.product_sync_handler'
2025-10-16 16:45:14,776 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 16:45:17,792 - __main__ - ERROR - Import error: No module named 'handlers.payment_handler'
2025-10-16 16:45:31,285 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 16:45:34,512 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 16:45:35,026 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 16:45:36,652 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 16:45:36,652 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 16:45:36,652 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 16:45:36,886 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 16:45:36,907 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 16:45:36,907 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 16:45:37,155 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 16:45:37,155 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 16:45:37,155 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 16:45:37,155 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 16:45:37,155 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 16:45:37,173 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 16:45:37,173 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 16:45:37,173 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 16:45:37,174 - services.ai_service - INFO - AI Enabled: True
2025-10-16 16:45:37,501 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 16:45:38,187 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 16:45:39,604 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 16:45:39,604 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 16:45:39,620 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 16:45:39,620 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 16:45:39,620 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 16:45:39,620 - services.ai_service - INFO - AI Enabled: True
2025-10-16 16:45:40,236 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 16:45:41,387 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 16:45:42,253 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 16:45:42,253 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 16:45:42,253 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 16:45:42,253 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 16:45:42,253 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 16:45:42,667 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 16:45:43,514 - __main__ - INFO - AI Assistant server stopped by user.
2025-10-16 17:03:44,259 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-10-16 17:03:50,565 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 17:03:54,870 - __main__ - ERROR - Import error: No module named 'handlers.payment_handler'
2025-10-16 17:05:21,584 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 17:05:24,649 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 17:05:25,114 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 17:05:27,100 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 17:05:27,100 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 17:05:27,100 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 17:05:27,313 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 17:05:27,328 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 17:05:27,328 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 17:05:27,573 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 17:05:27,594 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 17:05:27,594 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 17:05:27,595 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 17:05:27,595 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 17:05:27,598 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 17:05:27,598 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 17:05:27,598 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 17:05:27,598 - services.ai_service - INFO - AI Enabled: True
2025-10-16 17:05:27,973 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 17:05:28,818 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 17:05:29,557 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 17:05:29,557 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 17:05:29,566 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 17:05:29,566 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 17:05:29,566 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 17:05:29,566 - services.ai_service - INFO - AI Enabled: True
2025-10-16 17:05:29,933 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 17:05:30,670 - services.ai_service - INFO - Vector store initialized successfully
2025-10-16 17:05:31,487 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-10-16 17:05:31,487 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-10-16 17:05:31,487 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-10-16 17:05:31,487 - app - INFO - AfyaBot handlers and message processor initialized.
2025-10-16 17:05:31,487 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 17:05:31,959 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 17:05:33,104 - __main__ - INFO - AI Assistant server stopped by user.
2025-10-16 17:05:55,369 - __main__ - ERROR - Environment check failed. Please fix the issues above.
2025-10-16 17:05:59,415 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-10-16 17:06:02,443 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-10-16 17:06:02,836 - utils.data_manager - INFO - Supabase client initialized successfully
2025-10-16 17:06:03,845 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 17:06:03,877 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 17:06:03,877 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 17:06:04,098 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 17:06:04,121 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 17:06:04,121 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-10-16 17:06:04,330 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-10-16 17:06:04,403 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-10-16 17:06:04,404 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-10-16 17:06:04,404 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-10-16 17:06:04,405 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-10-16 17:06:04,407 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-10-16 17:06:04,408 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-10-16 17:06:04,408 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-10-16 17:06:04,408 - services.ai_service - INFO - AI Enabled: True
2025-10-16 17:06:04,728 - services.ai_service - INFO - Supabase client initialized successfully
2025-10-16 17:06:05,090 - __main__ - INFO - AI Assistant server stopped by user.
2025-11-03 20:09:13,872 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-11-03 20:09:24,857 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:09:25,765 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:09:27,699 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:09:27,753 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:09:27,753 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:09:28,030 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:09:28,033 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:09:28,033 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:09:28,267 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:09:28,291 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:09:28,292 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:09:28,292 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-11-03 20:09:28,295 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-11-03 20:09:28,312 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:09:28,315 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:09:28,315 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:09:28,315 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:09:29,446 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:09:32,075 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:09:33,893 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:09:33,893 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:09:33,900 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:09:33,900 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:09:33,900 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:09:33,903 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:09:34,913 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:09:36,698 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:09:39,595 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:09:39,598 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:09:39,598 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-11-03 20:09:39,600 - app - INFO - AfyaBot handlers and message processor initialized.
2025-11-03 20:09:39,600 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:09:41,126 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:09:43,533 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:09:43,536 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:09:43,536 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:09:43,799 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:09:43,820 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:09:43,820 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:09:44,072 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:09:44,090 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:09:44,091 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:09:44,091 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 204426689424598
2025-11-03 20:09:44,091 - services.payment_service - INFO - PaymentService initialized
2025-11-03 20:09:44,093 - app - INFO - WebhookHandler initialized with message processor.
2025-11-03 20:09:44,192 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-11-03 20:09:44,194 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-03 20:13:37,645 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-11-03 20:13:44,115 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:13:45,133 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:13:46,813 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:13:46,815 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:13:46,818 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:13:47,058 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:13:47,070 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:13:47,070 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:13:47,313 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:13:47,327 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:13:47,330 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:13:47,330 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:13:47,330 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-11-03 20:13:47,347 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:13:47,347 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:13:47,347 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:13:47,347 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:13:48,255 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:13:49,903 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:13:51,821 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:13:51,821 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:13:51,841 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:13:51,842 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:13:51,842 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:13:51,844 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:13:52,818 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:13:54,309 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:13:55,676 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:13:55,676 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:13:55,676 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-11-03 20:13:55,676 - app - INFO - AfyaBot handlers and message processor initialized.
2025-11-03 20:13:55,679 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:13:56,355 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:13:57,851 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:13:57,853 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:13:57,853 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:13:58,140 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:13:58,288 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:13:58,288 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:13:58,519 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:13:58,538 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:13:58,538 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:13:58,538 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:13:58,541 - services.payment_service - INFO - PaymentService initialized
2025-11-03 20:13:58,541 - app - INFO - WebhookHandler initialized with message processor.
2025-11-03 20:13:58,565 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-11-03 20:13:58,566 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-03 20:14:50,259 - handlers.webhook_handler - INFO - WhatsApp webhook verified successfully!
2025-11-03 20:14:50,263 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:14:50] "GET /webhook?hub.mode=subscribe&hub.challenge=535118902&hub.verify_token=123456 HTTP/1.1" 200 -
2025-11-03 20:19:43,757 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-11-03 20:19:53,435 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:19:55,718 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:19:58,191 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:19:58,193 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:19:58,195 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:19:58,445 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:19:58,475 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:19:58,477 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:19:58,747 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:19:58,769 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:19:58,844 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:19:58,845 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:19:58,847 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-11-03 20:19:58,883 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:19:58,885 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:19:58,885 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:19:58,885 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:20:00,661 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:20:04,355 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:20:06,748 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:20:06,750 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:20:06,758 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:20:06,758 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:20:06,758 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:20:06,758 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:20:07,648 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:20:09,531 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:20:11,033 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:20:11,033 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:20:11,035 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-11-03 20:20:11,036 - app - INFO - AfyaBot handlers and message processor initialized.
2025-11-03 20:20:11,036 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:20:11,719 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:20:13,136 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:20:13,136 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:20:13,136 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:20:13,365 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:20:13,376 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:20:13,376 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:20:13,658 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:20:13,677 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:20:13,677 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:20:13,679 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:20:13,679 - services.payment_service - INFO - PaymentService initialized
2025-11-03 20:20:13,681 - app - INFO - WebhookHandler initialized with message processor.
2025-11-03 20:20:13,741 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-11-03 20:20:13,741 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-03 20:23:01,076 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-11-03 20:23:01,077 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-11-03 20:23:01,077 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-11-03 20:23:01,077 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-11-03 20:23:01,078 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:23:01,081 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-11-03 20:23:02,337 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGQTA3OTM1OUEyQ0E5MEUzNgA='}]}
2025-11-03 20:23:02,339 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjRGQTA3OTM1OUEyQ0E5MEUzNgA='}]}
2025-11-03 20:23:02,339 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:23:02] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:23:05,424 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:23:05] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:24:07,219 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-11-03 20:24:13,697 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:24:14,647 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:24:16,278 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:24:16,278 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:24:16,278 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:24:16,527 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:24:16,547 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:24:16,547 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:24:16,788 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:24:16,796 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:24:16,798 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:24:16,798 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:24:16,798 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-11-03 20:24:16,811 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:24:16,811 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:24:16,813 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:24:16,814 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:24:17,533 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:24:19,294 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:24:20,728 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:24:20,733 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:24:20,738 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:24:20,738 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:24:20,738 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:24:20,741 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:24:21,542 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:24:23,088 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:24:24,505 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:24:24,505 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:24:24,505 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-11-03 20:24:24,508 - app - INFO - AfyaBot handlers and message processor initialized.
2025-11-03 20:24:24,508 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:24:25,326 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:24:26,930 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:24:26,933 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:24:26,933 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:24:27,231 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:24:27,235 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:24:27,235 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:24:27,497 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:24:27,516 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:24:27,516 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:24:27,518 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:24:27,518 - services.payment_service - INFO - PaymentService initialized
2025-11-03 20:24:27,518 - app - INFO - WebhookHandler initialized with message processor.
2025-11-03 20:24:27,543 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-11-03 20:24:27,543 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-03 20:24:42,653 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Test'}
2025-11-03 20:24:42,654 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-11-03 20:24:42,655 - message_processor - INFO - Session 2348055614455: New session detected. Starting AI chat.
2025-11-03 20:24:42,656 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Test'.
2025-11-03 20:24:42,658 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:24:42,659 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-11-03 20:24:43,707 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwODc3NjQ3ODNEMUI0MkEwMAA='}]}
2025-11-03 20:24:43,710 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkEwODc3NjQ3ODNEMUI0MkEwMAA='}]}
2025-11-03 20:24:43,713 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:24:43] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:24:44,451 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:24:44] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:26:05,397 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-11-03 20:26:11,638 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:26:12,599 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:26:14,217 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:26:14,219 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:26:14,219 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:26:14,482 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:26:14,497 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:26:14,497 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:26:14,755 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:26:14,768 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:26:14,774 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:26:14,777 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 838417836017240
2025-11-03 20:26:14,781 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-11-03 20:26:14,809 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:26:14,810 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:26:14,812 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:26:14,812 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:26:15,511 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:26:17,003 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:26:18,398 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:26:18,398 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:26:18,408 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:26:18,408 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:26:18,408 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:26:18,408 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:26:19,077 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:26:20,439 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:26:22,195 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:26:22,196 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:26:22,196 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-11-03 20:26:22,196 - app - INFO - AfyaBot handlers and message processor initialized.
2025-11-03 20:26:22,198 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:26:23,005 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:26:24,475 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:26:24,478 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:26:24,478 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:26:24,736 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:26:24,746 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:26:24,748 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:26:25,018 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:26:25,036 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:26:25,038 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:26:25,038 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 838417836017240
2025-11-03 20:26:25,038 - services.payment_service - INFO - PaymentService initialized
2025-11-03 20:26:25,040 - app - INFO - WebhookHandler initialized with message processor.
2025-11-03 20:26:25,078 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-11-03 20:26:25,078 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-03 20:26:30,709 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-11-03 20:26:30,710 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-11-03 20:26:30,711 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-11-03 20:26:30,711 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-11-03 20:26:30,715 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:26:30,715 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-11-03 20:26:31,649 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/838417836017240/messages - Response: {"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AtMoNI-59rNYfbwDOtPey58"}}
2025-11-03 20:26:31,653 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:26:31] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:26:34,042 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': '+1 555 647 0258'}
2025-11-03 20:26:34,042 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-11-03 20:26:34,042 - handlers.ai_handler - INFO - Processing question for 2348055614455: +1 555 647 0258
2025-11-03 20:26:34,042 - handlers.ai_handler - INFO - Calling AI service for message: +1 555 647 0258
2025-11-03 20:26:34,045 - services.ai_service - INFO - Generating medical response for: +1 555 647 0258
2025-11-03 20:26:36,308 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 20:26:38,003 - services.ai_service - INFO - Generated response: I'm here to help with questions about gynecology and women's reproductive health. If you have a spec
2025-11-03 20:26:38,054 - handlers.ai_handler - INFO - AI response generated: I'm here to help with questions about gynecology and women's reproductive health. If you have a spec
2025-11-03 20:26:38,054 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:26:38,857 - services.whatsapp_service - ERROR - HTTP error sending WhatsApp message: 400 Client Error: Bad Request for url: https://graph.facebook.com/v17.0/838417836017240/messages - Response: {"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"Ayhvx3r2j4xVSgNpjfQAoQe"}}
2025-11-03 20:26:38,859 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:26:38] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:27:48,297 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-11-03 20:27:48,298 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-11-03 20:27:48,299 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-11-03 20:27:48,301 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:27:48,302 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-11-03 20:27:49,835 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg4REY2NkUzNTVERUU1OEY1RgA='}]}
2025-11-03 20:27:49,838 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjg4REY2NkUzNTVERUU1OEY1RgA='}]}
2025-11-03 20:27:49,838 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:27:49] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:27:51,817 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:27:51] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:28:16,648 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-11-03 20:28:24,216 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:28:25,205 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:28:27,791 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:28:27,791 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:28:27,793 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:28:28,037 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:28:28,045 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:28:28,045 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:28:28,291 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:28:28,298 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:28:28,298 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:28:28,298 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 838417836017240
2025-11-03 20:28:28,301 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-11-03 20:28:28,309 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:28:28,309 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:28:28,313 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:28:28,314 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:28:29,055 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:28:30,836 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:28:32,525 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:28:32,525 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:28:32,531 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:28:32,531 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:28:32,531 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:28:32,533 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:28:33,306 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:28:34,841 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:28:36,428 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:28:36,428 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:28:36,428 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-11-03 20:28:36,430 - app - INFO - AfyaBot handlers and message processor initialized.
2025-11-03 20:28:36,430 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:28:37,208 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:28:38,553 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:28:38,555 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:28:38,556 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:28:38,816 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:28:38,836 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:28:38,838 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:28:39,133 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:28:39,134 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:28:39,135 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:28:39,135 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 838417836017240
2025-11-03 20:28:39,135 - services.payment_service - INFO - PaymentService initialized
2025-11-03 20:28:39,135 - app - INFO - WebhookHandler initialized with message processor.
2025-11-03 20:28:39,165 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-11-03 20:28:39,168 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-03 20:30:20,559 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-11-03 20:30:20,560 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-11-03 20:30:20,562 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-11-03 20:30:20,563 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-11-03 20:30:20,568 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:30:20,570 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-11-03 20:30:21,785 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExREZGQ0JFQ0ZENkJFOTU5OQA='}]}
2025-11-03 20:30:21,836 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkExREZGQ0JFQ0ZENkJFOTU5OQA='}]}
2025-11-03 20:30:21,840 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:21] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:30:23,507 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:23] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:30:23,647 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:23] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:30:23,930 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:23] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:30:37,532 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'How do you deliver kits'}
2025-11-03 20:30:37,532 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-11-03 20:30:37,533 - handlers.ai_handler - INFO - Processing question for 2348055614455: How do you deliver kits
2025-11-03 20:30:37,533 - handlers.ai_handler - INFO - Calling AI service for message: How do you deliver kits
2025-11-03 20:30:37,537 - services.ai_service - INFO - Generating medical response for: How do you deliver kits
2025-11-03 20:30:43,650 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 20:30:43,786 - services.ai_service - INFO - Generated response: I don't have specific information about that in my knowledge base. Please consult a qualified health
2025-11-03 20:30:43,786 - handlers.ai_handler - INFO - AI response generated: I don't have specific information about that in my knowledge base. Please consult a qualified health
2025-11-03 20:30:43,786 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:30:43,786 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "I don't have specific information about that in my knowledge base. Please consult a qualified healthcare professional or the appropriate channels for details on kit delivery."}}
2025-11-03 20:30:44,638 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3MzQ5MTBCNzBGNEQyRENBMQA='}]}
2025-11-03 20:30:44,641 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEjc3MzQ5MTBCNzBGNEQyRENBMQA='}]}
2025-11-03 20:30:44,641 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:44] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:30:45,696 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:45] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:30:45,978 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:45] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:30:46,696 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:30:46] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:10,772 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Do fo I gets the kits?'}
2025-11-03 20:31:10,774 - handlers.ai_handler - INFO - AIHandler: Processing AI chat message for session 2348055614455
2025-11-03 20:31:10,775 - handlers.ai_handler - INFO - Processing question for 2348055614455: Do fo I gets the kits?
2025-11-03 20:31:10,775 - handlers.ai_handler - INFO - Calling AI service for message: Do fo I gets the kits?
2025-11-03 20:31:10,780 - services.ai_service - INFO - Prompting for missing kit request info: ['your area or county'] for phone_number=2348055614455
2025-11-03 20:31:10,829 - handlers.ai_handler - INFO - Transitioning to kit_request_collection state for 2348055614455
2025-11-03 20:31:10,829 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:31:11,856 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRDMkYyRTk3MjRENThEOTM5MAA='}]}
2025-11-03 20:31:11,857 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkRDMkYyRTk3MjRENThEOTM5MAA='}]}
2025-11-03 20:31:11,859 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:11] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:12,879 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:12] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:13,380 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:13] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:13,383 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:13] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:20,704 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Lagos, Nigeura'}
2025-11-03 20:31:20,705 - handlers.ai_handler - INFO - Handling kit request collection for session 2348055614455: location=None, name=Ziga
2025-11-03 20:31:20,705 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:31:20,705 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Please provide your area or county to complete your screening kit request.'}}
2025-11-03 20:31:21,618 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwOTBFREI2N0Q5NzdCMUQ3MgA='}]}
2025-11-03 20:31:21,620 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkIwOTBFREI2N0Q5NzdCMUQ3MgA='}]}
2025-11-03 20:31:21,620 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:21] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:22,679 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:22] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:22,960 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:22] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:23,021 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:23] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:37,935 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': "I'm in Lagos Nigeria"}
2025-11-03 20:31:37,935 - handlers.ai_handler - INFO - Handling kit request collection for session 2348055614455: location=None, name=Ziga
2025-11-03 20:31:37,935 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:31:37,938 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': 'Please provide your area or county to complete your screening kit request.'}}
2025-11-03 20:31:39,015 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUyQjgwQ0MxRkVCMzYzQURDMgA='}]}
2025-11-03 20:31:39,015 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkUyQjgwQ0MxRkVCMzYzQURDMgA='}]}
2025-11-03 20:31:39,018 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:39] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:40,204 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:40] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:40,525 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:40] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:31:40,530 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:31:40] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:42:36,910 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2025-11-03 20:42:44,011 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:42:44,763 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:42:46,365 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:42:46,367 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:42:46,369 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:42:46,671 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:42:46,674 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:42:46,674 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:42:46,916 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:42:46,933 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:42:46,933 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:42:46,935 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:42:46,936 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2025-11-03 20:42:46,950 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:42:46,950 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:42:46,950 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:42:46,950 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:42:47,598 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:42:48,876 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:42:50,213 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:42:50,216 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:42:50,218 - services.ai_service - INFO - Configuration check - Supabase URL: set
2025-11-03 20:42:50,221 - services.ai_service - INFO - Configuration check - Supabase Key: set
2025-11-03 20:42:50,221 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2025-11-03 20:42:50,221 - services.ai_service - INFO - AI Enabled: True
2025-11-03 20:42:50,876 - services.ai_service - INFO - Supabase client initialized successfully
2025-11-03 20:42:52,407 - services.ai_service - INFO - Vector store initialized successfully
2025-11-03 20:42:53,806 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2025-11-03 20:42:53,808 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2025-11-03 20:42:53,808 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2025-11-03 20:42:53,808 - app - INFO - AfyaBot handlers and message processor initialized.
2025-11-03 20:42:53,808 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2025-11-03 20:42:54,476 - utils.data_manager - INFO - Supabase client initialized successfully
2025-11-03 20:42:55,685 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/kit_requests?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:42:55,689 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.kit_requests' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:42:55,689 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:42:55,934 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/test_results?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:42:55,956 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.test_results' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:42:55,956 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2025-11-03 20:42:56,239 - httpx - INFO - HTTP Request: GET https://syoesccpepohqjmkougg.supabase.co/rest/v1/conversations?select=id&limit=0 "HTTP/2 404 Not Found"
2025-11-03 20:42:56,257 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: {'code': 'PGRST205', 'details': None, 'hint': None, 'message': "Could not find the table 'public.conversations' in the schema cache"}. Please create it in the Supabase dashboard.
2025-11-03 20:42:56,257 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2025-11-03 20:42:56,257 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2025-11-03 20:42:56,260 - services.payment_service - INFO - PaymentService initialized
2025-11-03 20:42:56,260 - app - INFO - WebhookHandler initialized with message processor.
2025-11-03 20:42:56,332 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2025-11-03 20:42:56,334 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-03 20:43:25,775 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:43:25] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:43:25,898 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:43:25] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:43:32,594 - handlers.webhook_handler - INFO - Processing message from 2348055614455 (User: Ziga): {'type': 'text', 'text': 'Hello'}
2025-11-03 20:43:32,595 - utils.session_manager - INFO - New session 2348055614455 initialized.
2025-11-03 20:43:32,595 - message_processor - INFO - Session 2348055614455: Global command 'hello' detected. Going to AI chat.
2025-11-03 20:43:32,597 - message_processor - INFO - Session 2348055614455: Starting AI chat for user 'Ziga' with message 'Hello'.
2025-11-03 20:43:32,600 - services.whatsapp_service - DEBUG - Created text message payload for 2348055614455
2025-11-03 20:43:32,600 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348055614455: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348055614455', 'type': 'text', 'text': {'body': "Hi Ziga! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-11-03 20:43:33,617 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1REJBMUNBREM5Q0I1MjM1MQA='}]}
2025-11-03 20:43:33,617 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348055614455', 'wa_id': '2348055614455'}], 'messages': [{'id': 'wamid.HBgNMjM0ODA1NTYxNDQ1NRUCABEYEkY1REJBMUNBREM5Q0I1MjM1MQA='}]}
2025-11-03 20:43:33,620 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:43:33] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:43:34,729 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:43:34] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:43:35,019 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:43:35] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:49:39,969 - handlers.webhook_handler - INFO - Processing message from 2348163738250 (User: Kelechi Chima): {'type': 'text', 'text': 'Hello'}
2025-11-03 20:49:39,969 - utils.session_manager - INFO - New session 2348163738250 initialized.
2025-11-03 20:49:39,971 - message_processor - INFO - Session 2348163738250: Global command 'hello' detected. Going to AI chat.
2025-11-03 20:49:39,971 - message_processor - INFO - Session 2348163738250: Starting AI chat for user 'Kelechi Chima' with message 'Hello'.
2025-11-03 20:49:39,972 - services.whatsapp_service - DEBUG - Created text message payload for 2348163738250
2025-11-03 20:49:39,972 - services.whatsapp_service - INFO - Sending WhatsApp payload to 2348163738250: {'messaging_product': 'whatsapp', 'recipient_type': 'individual', 'to': '2348163738250', 'type': 'text', 'text': {'body': "Hi Kelechi Chima! I'm AfyaBot, your gynecology medical assistant.\n\nI'm here to help with:\n- Cervical screening information\n- Finding Community Health Workers\n- Ordering screening kits\n- Questions about women's reproductive health\n\nWhat would you like to know or do today?"}}
2025-11-03 20:49:41,126 - services.whatsapp_service - INFO - WhatsApp API response: 200 - {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348163738250', 'wa_id': '2348163738250'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE2MzczODI1MBUCABEYEjg5Rjk0NEY0NTM5OUJGMjA5NwA='}]}
2025-11-03 20:49:41,132 - services.whatsapp_service - ERROR - Missing required fields in payload: ['to', 'type'] - Payload: {'messaging_product': 'whatsapp', 'contacts': [{'input': '2348163738250', 'wa_id': '2348163738250'}], 'messages': [{'id': 'wamid.HBgNMjM0ODE2MzczODI1MBUCABEYEjg5Rjk0NEY0NTM5OUJGMjA5NwA='}]}
2025-11-03 20:49:41,136 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:49:41] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:49:44,438 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:49:44] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:49:45,224 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:49:45] "POST /webhook HTTP/1.1" 200 -
2025-11-03 20:49:45,230 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 20:49:45] "POST /webhook HTTP/1.1" 200 -
2025-11-03 21:10:54,441 - handlers.webhook_handler - WARNING - No valid message data extracted for 2347086490203. Message type: reaction
2025-11-03 21:10:54,442 - werkzeug - INFO - 127.0.0.1 - - [03/Nov/2025 21:10:54] "POST /webhook HTTP/1.1" 200 -
2026-01-17 13:56:06,147 - __main__ - INFO - Starting Wallpaper.ng AI Assistant server...
2026-01-17 13:56:15,007 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2026-01-17 13:56:15,586 - utils.data_manager - INFO - Supabase client initialized successfully
2026-01-17 13:56:16,073 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: [Errno 11001] getaddrinfo failed. Please create it in the Supabase dashboard.
2026-01-17 13:56:16,073 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2026-01-17 13:56:16,073 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: [Errno 11001] getaddrinfo failed. Please create it in the Supabase dashboard.
2026-01-17 13:56:16,073 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2026-01-17 13:56:16,073 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: [Errno 11001] getaddrinfo failed. Please create it in the Supabase dashboard.
2026-01-17 13:56:16,073 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2026-01-17 13:56:16,073 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2026-01-17 13:56:16,073 - app - INFO - Core services initialized for AfyaBot (Gynecology Medical AI)
2026-01-17 13:56:16,089 - services.ai_service - INFO - Configuration check - Supabase URL: set
2026-01-17 13:56:16,089 - services.ai_service - INFO - Configuration check - Supabase Key: set
2026-01-17 13:56:16,089 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2026-01-17 13:56:16,089 - services.ai_service - INFO - AI Enabled: True
2026-01-17 13:56:16,451 - services.ai_service - INFO - Supabase client initialized successfully
2026-01-17 13:56:17,169 - services.ai_service - INFO - Vector store initialized successfully
2026-01-17 13:56:18,078 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2026-01-17 13:56:18,078 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2026-01-17 13:56:18,078 - services.ai_service - INFO - Configuration check - Supabase URL: set
2026-01-17 13:56:18,078 - services.ai_service - INFO - Configuration check - Supabase Key: set
2026-01-17 13:56:18,078 - services.ai_service - INFO - Configuration check - OpenAI API Key: set
2026-01-17 13:56:18,078 - services.ai_service - INFO - AI Enabled: True
2026-01-17 13:56:18,490 - services.ai_service - INFO - Supabase client initialized successfully
2026-01-17 13:56:19,300 - services.ai_service - INFO - Vector store initialized successfully
2026-01-17 13:56:20,133 - services.ai_service - INFO - RAG pipeline initialized successfully for Gynecology Medical AI.
2026-01-17 13:56:20,133 - handlers.ai_handler - INFO - AIHandler: AIService successfully initialized for Gynecology Medical AI.
2026-01-17 13:56:20,133 - message_processor - INFO - MessageProcessor initialized for Gynecology Medical AI (AfyaBot).
2026-01-17 13:56:20,134 - app - INFO - AfyaBot handlers and message processor initialized.
2026-01-17 13:56:20,134 - utils.session_manager - INFO - SessionManager initialized. Default timeouts: Unpaid=3000s, Paid=12000s
2026-01-17 13:56:20,562 - utils.data_manager - INFO - Supabase client initialized successfully
2026-01-17 13:56:20,997 - utils.data_manager - WARNING - Table kit_requests may not exist or is inaccessible: [Errno 11001] getaddrinfo failed. Please create it in the Supabase dashboard.
2026-01-17 13:56:20,997 - utils.data_manager - INFO - Required schema for kit_requests: 
                CREATE TABLE kit_requests (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    name VARCHAR(100),
                    location VARCHAR(100),
                    request_details TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2026-01-17 13:56:20,997 - utils.data_manager - WARNING - Table test_results may not exist or is inaccessible: [Errno 11001] getaddrinfo failed. Please create it in the Supabase dashboard.
2026-01-17 13:56:20,997 - utils.data_manager - INFO - Required schema for test_results: 
                CREATE TABLE test_results (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) UNIQUE NOT NULL,
                    result TEXT,
                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
            
2026-01-17 13:56:20,997 - utils.data_manager - WARNING - Table conversations may not exist or is inaccessible: [Errno 11001] getaddrinfo failed. Please create it in the Supabase dashboard.
2026-01-17 13:56:20,997 - utils.data_manager - INFO - Required schema for conversations: 
                CREATE TABLE conversations (
                    id SERIAL PRIMARY KEY,
                    phone_number VARCHAR(20) NOT NULL,
                    session_id VARCHAR(100),
                    user_message TEXT,
                    assistant_response TEXT,
                    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                );
                CREATE INDEX idx_conversations_phone_number ON conversations(phone_number);
                CREATE INDEX idx_conversations_timestamp ON conversations(timestamp);
            
2026-01-17 13:56:20,997 - services.whatsapp_service - DEBUG - WhatsAppService initialized with phone_number_id: 846412388549528
2026-01-17 13:56:20,997 - services.payment_service - INFO - PaymentService initialized
2026-01-17 13:56:20,997 - app - INFO - WebhookHandler initialized with message processor.
2026-01-17 13:56:21,036 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:8000
2026-01-17 13:56:21,036 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
